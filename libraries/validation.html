

<!DOCTYPE html>
<html class="writer-html4" lang="zh-CN" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>验证类 &mdash; CodeIgniter 4.0.0 中文手册|用户手册|用户指南|中文文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/citheme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/js/citheme.js"></script>
        <script type="text/javascript" src="../_static/js/carbon.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="辅助函数" href="../helpers/index.html" />
    <link rel="prev" title="User Agent Class" href="user_agent.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #DD4814" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/ci-logo-text.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">欢迎使用 CodeIgniter4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/index.html">欢迎使用 CodeIgniter4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/requirements.html">服务器安装要求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/credits.html">发展历程与贡献者</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/psr.html">PSR 规范</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">安装</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation/installing_manual.html">手动安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/installing_composer.html">通过Composer安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/running.html">运行你的应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/upgrading.html">从老版本升级</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/troubleshooting.html">故障排除</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/repositories.html">CodeIgniter 仓库</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">构建你的第一个应用</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/static_pages.html">加载静态页</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/news_section.html">新闻展示功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/create_news_items.html">创建新闻项目</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/conclusion.html">结束语</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">CodeIgniter4 概览</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/structure.html">应用结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/mvc.html">模型，视图和控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/autoloader.html">自动加载文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/services.html">服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/http.html">处理 HTTP 请求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/security.html">安全指南</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general/index.html">常规主题</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../general/configuration.html">利用配置文件开始工作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/urls.html">CodeIgniter URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/helpers.html">辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/common_functions.html">公共函数和全局常量</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/logging.html">记录日志信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/errors.html">错误处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/caching.html">网页缓存</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/ajax.html">AJAX请求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/modules.html">代码模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/managing_apps.html">管理多个应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/environments.html">处理多环境</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../incoming/index.html">控制器和路由</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../incoming/controllers.html">控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/routing.html">URI 路由</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/filters.html">控制器过滤器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/message.html">HTTP 消息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/request.html">Request 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/incomingrequest.html">IncomingRequest 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/content_negotiation.html">内容协商</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/methodspoofing.html">HTTP类型伪装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/restful.html">处理RESTful请求资源</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../outgoing/index.html">构建响应</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/views.html">视图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_cells.html">子视图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_renderer.html">视图渲染器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_layouts.html">视图布局</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_parser.html">View Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/table.html">HTML Table Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/response.html">HTTP 响应</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/api_responses.html">API 响应特性</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/localization.html">本地化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/alternative_php.html">在视图文件中使用PHP替代语法</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../database/index.html">数据库参考</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/examples.html">数据库快速入门：示例代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/configuration.html">数据库配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/connecting.html">连接数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/queries.html">执行查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/results.html">生成查询结果</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/helpers.html">查询辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/query_builder.html">查询构造器类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/transactions.html">事务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/metadata.html">获取元数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/call_function.html">自定义函数调用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/events.html">数据库事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/utilities.html">数据库工具</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/index.html">数据建模</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/model.html">使用 CodeIgniter 的模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/entities.html">使用实体类</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dbmgmt/index.html">管理数据库</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/forge.html">使用 Database Forge 维护数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/migration.html">数据库迁移</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/seeds.html">数据库填充</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">类库参考</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="caching.html">缓存驱动器</a></li>
<li class="toctree-l2"><a class="reference internal" href="curlrequest.html">CURLRequest类</a></li>
<li class="toctree-l2"><a class="reference internal" href="email.html">Email Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="encryption.html">加密服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="files.html">使用文件类</a></li>
<li class="toctree-l2"><a class="reference internal" href="honeypot.html">Honeypot Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="images.html">图像处理类</a></li>
<li class="toctree-l2"><a class="reference internal" href="pagination.html">分页类</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">安全类</a></li>
<li class="toctree-l2"><a class="reference internal" href="sessions.html">Session 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="throttler.html">限流类</a></li>
<li class="toctree-l2"><a class="reference internal" href="time.html">日期与时间类</a></li>
<li class="toctree-l2"><a class="reference internal" href="typography.html">Typography 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="uploaded_files.html">使用文件上传类</a></li>
<li class="toctree-l2"><a class="reference internal" href="uri.html">使用 URI 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_agent.html">User Agent Class</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">验证类</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../helpers/index.html">辅助函数</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../helpers/array_helper.html">Array Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/cookie_helper.html">Cookie 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/date_helper.html">Date Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/filesystem_helper.html">文件系统辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/form_helper.html">表单辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/html_helper.html">HTML 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/inflector_helper.html">偏转辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/number_helper.html">数字辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/security_helper.html">安全辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/text_helper.html">文本辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/url_helper.html">URL 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/xml_helper.html">XML辅助函数</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">测试</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing/overview.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/database.html">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/controllers.html">Controller Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/feature.html">HTTP Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/benchmark.html">基准测试类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/debugging.html">调试你的应用</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">命令行用法</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli.html">通过CLI方式运行</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_commands.html">自定义 CLI 命令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_library.html">CLI Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_request.html">CLIRequest Class</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">扩展 CodeIgniter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../extending/core_classes.html">创建核心系统类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/common.html">替换通用函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/events.html">事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/basecontroller.html">扩展 Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/authentication.html">鉴权</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/contributing.html">贡献给 CodeIgniter</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CodeIgniter</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">类库参考</a> &raquo;</li>
        
      <li>验证类</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>验证类<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>CodeIgniter 提供了全面的数据验证类，最大程度减少你需要编写的代码量。</p>
<div class="contents local topic" id="id2">
<ul class="simple">
<li><a class="reference internal" href="#id3" id="id33">概述</a></li>
<li><a class="reference internal" href="#id4" id="id34">表单验证教程</a><ul>
<li><a class="reference internal" href="#id5" id="id35">表单</a></li>
<li><a class="reference internal" href="#id6" id="id36">成功页</a></li>
<li><a class="reference internal" href="#id7" id="id37">控制器</a></li>
<li><a class="reference internal" href="#id8" id="id38">试一试!</a></li>
<li><a class="reference internal" href="#id9" id="id39">说明</a></li>
<li><a class="reference internal" href="#validation" id="id40">加载 validation 库</a></li>
<li><a class="reference internal" href="#id10" id="id41">设置验证规则</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11" id="id42">处理 Validation</a><ul>
<li><a class="reference internal" href="#id12" id="id43">验证数组的键</a></li>
<li><a class="reference internal" href="#id13" id="id44">验证单个值</a></li>
<li><a class="reference internal" href="#id14" id="id45">将验证规则集合保存到配置文件</a></li>
<li><a class="reference internal" href="#id17" id="id46">运行多个 Validation</a></li>
<li><a class="reference internal" href="#id18" id="id47">Validation 占位符</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id19" id="id48">处理错误</a><ul>
<li><a class="reference internal" href="#validation-custom-errors" id="id49">设置自定义错误消息</a></li>
<li><a class="reference internal" href="#id21" id="id50">消息和验证标签的翻译</a></li>
<li><a class="reference internal" href="#id22" id="id51">获取所有错误</a></li>
<li><a class="reference internal" href="#id23" id="id52">获取单个错误</a></li>
<li><a class="reference internal" href="#id24" id="id53">检查是否存在错误</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id25" id="id54">自定义错误显示</a><ul>
<li><a class="reference internal" href="#id26" id="id55">创建视图</a></li>
<li><a class="reference internal" href="#id27" id="id56">配置</a></li>
<li><a class="reference internal" href="#id28" id="id57">指定模板</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id29" id="id58">创建自定义规则</a><ul>
<li><a class="reference internal" href="#id30" id="id59">允许参数</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id31" id="id60">可用规则</a><ul>
<li><a class="reference internal" href="#id32" id="id61">文件上传规则</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id33">概述</a><a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>在解释 CodeIgniter 的数据验证之前，我们先介绍理想的状况：</p>
<ol class="arabic simple">
<li>显示一个表单。</li>
<li>你填写并提交。</li>
<li>如果你提交的表单数据无效，或者丢失了必填项，将重新显示包含了你的数据和错误消息的表单。</li>
<li>这个过长将一直持续到你提交的表单数据有效为止。</li>
</ol>
<p>在接收端，脚本必须：</p>
<ol class="arabic simple">
<li>检查需要的数据。</li>
<li>验证数据的类型是否正确，并且符合要求的标准。例如，如果提交了用户名，则必须仅包含允许的字符。
它必须大于最小长度，小于最大长度。用户名不能是系统中已经存在的用户名，甚至是保留的关键词。
等等。</li>
<li>处理数据以保证安全。</li>
<li>如果有必要，对数据进行格式化 (是否需要裁剪数据 ? HTML 编码? 等等。)</li>
<li>准备要插入数据库的数据。</li>
</ol>
<p>尽管上述过程没有什么非常复杂的，但是通常需要编写大量的代码，并且显示各种错误消息，在 HTML 表单中
放置各种控制结构。表单验证虽然容易创建，但是通常十分混乱，实现起来很繁琐。</p>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id34">表单验证教程</a><a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>以下是实现 CodeIgniter 表单验证的“动手”教程。</p>
<p>为了实现表单验证，你需要做三件事：</p>
<ol class="arabic simple">
<li>一个包含表单的 <a class="reference internal" href="../outgoing/views.html"><span class="doc">View</span></a> 文件。</li>
<li>一个提交成功后显示 “success” 的 View 文件。</li>
<li>一个 <a class="reference internal" href="../incoming/controllers.html"><span class="doc">controller</span></a> 方法用来接收和处理提交的数据。</li>
</ol>
<p>让我们以会员注册表单为例来做这三件事。</p>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id35">表单</a><a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p>使用编辑器创建一个名为 <strong>Signup.php</strong> 的视图文件，将代码复制到文件中，并保存到 <strong>app/Views/</strong> 文件夹：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">My</span> <span class="nx">Form</span><span class="o">&lt;/</span><span class="nx">title</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>

    <span class="o">&lt;?=</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">listErrors</span><span class="p">()</span> <span class="cp">?&gt;</span>

    <span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">form_open</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>

    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>Username<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;50&quot;</span> <span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>Password<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;50&quot;</span> <span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>Password Confirm<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;passconf&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;50&quot;</span> <span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>Email Address<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;50&quot;</span> <span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Submit&quot;</span> <span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id36">成功页</a><a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<p>使用编辑器创建一个名为 <strong>Success.php</strong> 的视图文件，将代码复制到文件中，并保存到 <strong>app/Views/</strong> 文件夹：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">My</span> <span class="nx">Form</span><span class="o">&lt;/</span><span class="nx">title</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Your</span> <span class="nx">form</span> <span class="nx">was</span> <span class="nx">successfully</span> <span class="nx">submitted</span><span class="o">!&lt;/</span><span class="nx">h3</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;?=</span> <span class="nx">anchor</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="s1">&#39;Try it again!&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id37">控制器</a><a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p>使用编辑器创建一个名为 <strong>Form.php</strong>  的控制器文件，将代码复制到文件中，并保存到 <strong>app/Controllers/</strong> 文件夹：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">namespace</span> <span class="nx">App\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">CodeIgniter\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Form</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">helper</span><span class="p">([</span><span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">]);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([]))</span>
        <span class="p">{</span>
            <span class="k">echo</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;Signup&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;validation&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span>
            <span class="p">]);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">echo</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;Success&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id38">试一试!</a><a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>要尝试使用表单，请使用与此网址相似的网址访问你的网站</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nx">example</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">index</span><span class="o">.</span><span class="nx">php</span><span class="o">/</span><span class="nx">form</span><span class="o">/</span>
</pre></div>
</div>
<p>如果你提交表单，则应该只看到表单重新加载。那是因为你没有设置任何验证规则。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">由于你没有告诉 <strong>Validation 类</strong> 进行任何验证, 它在 <strong>默认情况</strong> 下 <strong>返回 false</strong> (boolean false)。 <code class="docutils literal notranslate"><span class="pre">validate()</span></code>
方法仅在验证你设置的 <strong>所有规则</strong> 并且没有 <strong>任何失败</strong> 的情况下返回 true 。</p>
</div>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id39">说明</a><a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>你会注意到上述页面的几件事情：</p>
<p>表单 (Signup.php) 是一个标准的 web 表单，但有一些例外：</p>
<ol class="arabic">
<li><p class="first">它使用表单辅助类来创建表单。从技术上讲这没必要，你可以使用标准的 HTML 代码来创建表单。
但是，使用表单辅助类可以根据配置文件中的 URL 来生成表单的 action URL。当你的网址发生
更改时，则你的程序更容易进行移植。</p>
</li>
<li><p class="first">在表单的顶部，你会注意到调用了以下函数：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?=</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">listErrors</span><span class="p">()</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>该函数将返回 validator 发送的所有错误消息。如果没有消息，则返回一个空字符串。</p>
</li>
</ol>
<p>控制器 (Form.php) 拥有一个方法： <code class="docutils literal notranslate"><span class="pre">index()</span></code>。这个方法使用控制器提供的 validate 方法，
并加载表单辅助类和 URL 辅助类。它还运行验证程序，根据验证程序是否验证成功，它将显示表单或成功页。</p>
</div>
<div class="section" id="validation">
<h3><a class="toc-backref" href="#id40">加载 validation 库</a><a class="headerlink" href="#validation" title="永久链接至标题">¶</a></h3>
<p>该库通过名叫 <strong>validation</strong> 的服务进行加载：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span> <span class="o">=</span>  <span class="nx">\Config\Services</span><span class="o">::</span><span class="na">validation</span><span class="p">();</span>
</pre></div>
</div>
<p>这将自动加载 <code class="docutils literal notranslate"><span class="pre">Config\Validation</span></code> 文件，文件中包含了多个规则类，以及便于重用的规则集合。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">你可用永远都不会使用该方法，因为 <a class="reference internal" href="../incoming/controllers.html"><span class="doc">Controller</span></a> 和
<a class="reference internal" href="../models/model.html"><span class="doc">Model</span></a> 中都提供了更简便的验证方法。</p>
</div>
</div>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id41">设置验证规则</a><a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p>CodeIgniter 允许你为给定字段设置多个验证规则，并按顺序执行它们。要设置验证规则，你将使用
<code class="docutils literal notranslate"><span class="pre">setRule()</span></code>，<code class="docutils literal notranslate"><span class="pre">setRules()</span></code> 方法。</p>
<div class="section" id="setrule">
<h4>setRule()<a class="headerlink" href="#setrule" title="永久链接至标题">¶</a></h4>
<p>该方法设置单个规则，它使用 <strong>字段名称</strong> 作为第一个参数，第二个参数是一个可选的标签，第三个参数是以竖线
分隔的规则列表的字符串：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRule</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>字段名称</strong> 必须与需要验证的任何数据数组的键匹配。如果直接从 $_POST 获取数组，则它必须与表单的 input name 完全匹配。</p>
</div>
<div class="section" id="setrules">
<h4>setRules()<a class="headerlink" href="#setrules" title="永久链接至标题">¶</a></h4>
<p>与 <code class="docutils literal notranslate"><span class="pre">setRule()</span></code> 类似，但其接受字段名称与其规则所组成的数组：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>想设置带标签的错误消息，你可以像这样设置：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="s1">&#39;rules&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">],</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Password&#39;</span><span class="p">,</span> <span class="s1">&#39;rules&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="withrequest">
<h4>withRequest()<a class="headerlink" href="#withrequest" title="永久链接至标题">¶</a></h4>
<p>使用验证库最常见的场景之一是验证从 HTTP 请求输入的数据。如果需要，你可以传递当前的 Request 对象的实例，
它将接收所有输入数据，并将其设置为待验证的数据：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">withRequest</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">)</span>
           <span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id42">处理 Validation</a><a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id43">验证数组的键</a><a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h3>
<p>如果需要验证的数据在嵌套的关联数组中，则可以使用 “点数组语法” 轻松验证数据：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// The data to test:</span>
<span class="s1">&#39;contacts&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Joe Smith&#39;</span><span class="p">,</span>
    <span class="s1">&#39;friends&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fred Flinstone&#39;</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Wilma&#39;</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">]</span>

<span class="c1">// Joe Smith</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;contacts.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span>
<span class="p">]);</span>

<span class="c1">// Fred Flintsone &amp; Wilma</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;contacts.friends.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>你可以使用通配符 “*” 来匹配数组的任何一个层级：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// Fred Flintsone &amp; Wilma</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;contacts.*.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>“点数组语法” 也通常用于一维数组。例如，多选下拉列表返回的数据：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// The data to test:</span>
<span class="s1">&#39;user_ids&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">,</span>
    <span class="mi">3</span>
<span class="p">]</span>
<span class="c1">// Rule</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;user_ids.*&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id44">验证单个值</a><a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h3>
<p>根据规则验证单个值：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">check</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h3><a class="toc-backref" href="#id45">将验证规则集合保存到配置文件</a><a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h3>
<p>Validation 类一个好的功能是，它允许你将整个程序的验证规则存储在配置文件中。将规则组合成一个 “group”
，可以在运行验证时指定不同的组。</p>
<div class="section" id="validation-array">
<span id="id15"></span><h4>如何保存你的规则<a class="headerlink" href="#validation-array" title="永久链接至标题">¶</a></h4>
<p>要存储你的验证规则，只需在 <code class="docutils literal notranslate"><span class="pre">Config\Validation</span></code> 类中使用 group 名创建一个新的公共属性，
该元素将包含你的验证规则数组。验证规则数组的原型如下所示：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Validation</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$signup</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;username&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pass_confirm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|matches[password]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email&#39;</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>你可以在调用 <code class="docutils literal notranslate"><span class="pre">run()</span></code> 方法时指定要使用的组：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s1">&#39;signup&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>你也可以将自定义错误消息存储在配置文件中，属性名称与组名相同并添加 <code class="docutils literal notranslate"><span class="pre">_errors</span></code>。
当使用该组时，默认的错误消息将被替换：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Validation</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$signup</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;username&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pass_confirm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|matches[password]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email&#39;</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="nv">$signup_errors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;required&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;You must choose a username.&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">&#39;email&#39;</span>    <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;valid_email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please check the Email field. It does not appear to be valid.&#39;</span>
        <span class="p">]</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>或者在组中传递所有的设置：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Validation</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$signup</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
            <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;You must choose a Username.&#39;</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="s1">&#39;email&#39;</span>    <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email&#39;</span><span class="p">,</span>
            <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;valid_email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please check the Email field. It does not appear to be valid.&#39;</span>
            <span class="p">]</span>
        <span class="p">],</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>有关数组格式的详细信息请查看下文。</p>
</div>
<div class="section" id="id16">
<h4>获取与设置规则组<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h4>
<p><strong>获取规则组</strong></p>
<p>该方法从验证配置中获取规则组：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">getRuleGroup</span><span class="p">(</span><span class="s1">&#39;signup&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>设置规则组</strong></p>
<p>该方法设置将规则组从验证配置设置到验证服务：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRuleGroup</span><span class="p">(</span><span class="s1">&#39;signup&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id17">
<h3><a class="toc-backref" href="#id46">运行多个 Validation</a><a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">run()</span></code> 方法不会重置错误状态。如果上次运行失败，<code class="docutils literal notranslate"><span class="pre">run()</span></code> 方法将始终返回 false ，
<code class="docutils literal notranslate"><span class="pre">getErrors()</span></code> 方法将始终返回上次的所有错误，直至状态被显式重置。</p>
</div>
<p>如果需要运行多个验证，例如在不同的数据集上运行或者一个接一个的运行不同的规则，你应该在每次运行前
调用 <code class="docutils literal notranslate"><span class="pre">$validation-&gt;reset()</span></code> 清除上次运行产生的错误。需要注意的是 <code class="docutils literal notranslate"><span class="pre">reset()</span></code> 将重置之前的所有数据、规则
或是自定义错误消息。所以需要重复 <code class="docutils literal notranslate"><span class="pre">setRules()</span></code>，<code class="docutils literal notranslate"><span class="pre">setRuleGroup()</span></code> 等方法：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="nv">$userAccounts</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">reset</span><span class="p">();</span>
    <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">(</span><span class="nv">$userAccountRules</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="nv">$user</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// handle validation errors</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h3><a class="toc-backref" href="#id47">Validation 占位符</a><a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h3>
<p>Validation 类提供了一个简单的方法，可以根据传入的数据替换部分规则。这听起来十分晦涩，但在使用 <code class="docutils literal notranslate"><span class="pre">is_unique</span></code> 进行验证时
十分方便。 占位符是字段的名称（或数组的键），该字段名称（或数组的键）将用花括号包起来作为 $data 传入。它将被替换为匹配的
传入字段的 <strong>值</strong>。 以下例子可以解释这些：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email|is_unique[users.email,id,{id}]&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>在这组规则中，它声明 email 在数据库中是唯一的，除了具有与占位符匹配的 id 信息，
假设表单 POST 数据中有以下内容：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$_POST</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo@example.com&#39;</span>
<span class="p">];</span>
</pre></div>
</div>
<p>那么占位符 <code class="docutils literal notranslate"><span class="pre">{id}</span></code> 将被修改为数字 <strong>4</strong>，以下是修改后的规则：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email|is_unique[users.email,id,4]&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>因此，在验证 email 唯一时，将忽略数据库中 <code class="docutils literal notranslate"><span class="pre">id=4</span></code> 的行。</p>
<p>这也可以用于在运行时动态创建更多的规则，只要你确保传入的任何动态键都不会与表单
数据产生冲突。</p>
</div>
</div>
<div class="section" id="id19">
<h2><a class="toc-backref" href="#id48">处理错误</a><a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h2>
<p>Validation 库提供了几种方法帮助你设置错误消息，提供自定义错误消息，以及显示一个
或多个错误消息。</p>
<p>默认情况下，错误消息来自 <code class="docutils literal notranslate"><span class="pre">system/Language/en/Validation.php</span></code> 中的语言字符串，
其中每个规则都有一个条目。</p>
<div class="section" id="validation-custom-errors">
<span id="id20"></span><h3><a class="toc-backref" href="#id49">设置自定义错误消息</a><a class="headerlink" href="#validation-custom-errors" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">setRule()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">setRules()</span></code> 允许自定义错误消息数据作为最后一个参数传入。每一个错误的
错误消息都是定制的，这将带来愉快的用户体验。如果没有设置自定义错误消息，则提供默认值。</p>
<p>这是两种设置错误消息的方式。</p>
<p>作为最后一个参数：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|is_unique[users.username]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span>
    <span class="p">],</span>
    <span class="p">[</span>   <span class="c1">// Errors</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;All accounts must have usernames provided&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;min_length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Your password is too short. You want to get hacked?&#39;</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>或者作为标签样式：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;label&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Username&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required|is_unique[users.username]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;All accounts must have {field} provided&#39;</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;label&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;min_length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Your {field} is too short. You want to get hacked?&#39;</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>如果你希望包含字段的“human”名称，或者某些规则允许的可选参数 (比如 max_length)，或当前参与验证的值，
则可以分别将 <code class="docutils literal notranslate"><span class="pre">{field}</span></code>，<code class="docutils literal notranslate"><span class="pre">{param}</span></code>，<code class="docutils literal notranslate"><span class="pre">{value}</span></code> 标记添加到你的消息中：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;min_length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Supplied value ({value}) for {field} must have at least {param} characters.&#39;</span>
</pre></div>
</div>
<p>在一个用户名字段为 Username ，验证规则为 min_length[6] ，字段值为 “Pizza” 的验证中，将显示错误消息
“Supplied value (Pizza) for Username must have at least 6 characters”</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">如果你传递最后一个参数，则标签样式的错误信息将被忽略。</p>
</div>
</div>
<div class="section" id="id21">
<h3><a class="toc-backref" href="#id50">消息和验证标签的翻译</a><a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h3>
<p>要使用语言文件中的翻译字符串，可以简单的使用点语法。假设我们有一个包含翻译的文件位
于 <code class="docutils literal notranslate"><span class="pre">app/Languages/en/Rules.php</span></code>。我们可以简单的使用定义在文件中的语言行，如下：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;label&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Rules.username&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required|is_unique[users.username]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Rules.username.required&#39;</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;label&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Rules.password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;min_length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Rules.password.min_length&#39;</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id22">
<h3><a class="toc-backref" href="#id51">获取所有错误</a><a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h3>
<p>如果你需要检索所有验证失败字段的错误消息，你可以使用 <code class="docutils literal notranslate"><span class="pre">getErrors()</span></code> 方法：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$errors</span> <span class="o">=</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">getErrors</span><span class="p">();</span>

<span class="c1">// Returns:</span>
<span class="p">[</span>
    <span class="s1">&#39;field1&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;error message&#39;</span><span class="p">,</span>
    <span class="s1">&#39;field2&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;error message&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>如果没有错误，则返回空数组。</p>
</div>
<div class="section" id="id23">
<h3><a class="toc-backref" href="#id52">获取单个错误</a><a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h3>
<p>你可以使用 <code class="docutils literal notranslate"><span class="pre">getError()</span></code> 方法检索单个字段的错误消息。参数名是唯一的参数：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$error</span> <span class="o">=</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">getError</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>如果没有错误，则返回空字符串。</p>
</div>
<div class="section" id="id24">
<h3><a class="toc-backref" href="#id53">检查是否存在错误</a><a class="headerlink" href="#id24" title="永久链接至标题">¶</a></h3>
<p>你可以使用 <code class="docutils literal notranslate"><span class="pre">hasError()</span></code> 方法检查字段是否存在错误。字段名是唯一的参数：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">hasError</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">))</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">getError</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id25">
<h2><a class="toc-backref" href="#id54">自定义错误显示</a><a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h2>
<p>当你调用 <code class="docutils literal notranslate"><span class="pre">$validation-&gt;listErrors()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">$validation-&gt;showError()</span></code> ，它将在后台加载一个视图文件，
该文件确定错误的显示方法。默认情况下，它在经过包装的 div 上显示 <code class="docutils literal notranslate"><span class="pre">errors</span></code> 。你可以轻松的创建视图并在整个程序
中使用它。</p>
<div class="section" id="id26">
<h3><a class="toc-backref" href="#id55">创建视图</a><a class="headerlink" href="#id26" title="永久链接至标题">¶</a></h3>
<p>第一步是创建视图文件，它可以放在 <code class="docutils literal notranslate"><span class="pre">view()</span></code> 方法可以加载的任何地方。这意味着标准的 View 目录，或者任何命名空间
下的 View 目录都可以正常工作。例如，可以在  <strong>/app/Views/_errors_list.php</strong> 创建新的视图文件：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span> <span class="nx">role</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
    <span class="o">&lt;?</span><span class="nx">php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$errors</span> <span class="k">as</span> <span class="nv">$error</span><span class="p">)</span> <span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">esc</span><span class="p">(</span><span class="nv">$error</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endforeach</span> <span class="cp">?&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">$errors</span></code> 数组可以在包含错误列表的视图中使用，其中键是发生错误的字段名，值是错误消息，如下所示：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$errors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The username field must be unique.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;You must provide a valid email address.&#39;</span>
<span class="p">];</span>
</pre></div>
</div>
<p>实际上可以创建两种类型的视图文件。第一种包含所有错误消息，这就是我们刚才看到的。另一种更简单，只包含一个错误消息变量 <code class="docutils literal notranslate"><span class="pre">$error</span></code>。
它与指定字段名的 <code class="docutils literal notranslate"><span class="pre">showError()</span></code> 方法一起使用。</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">span</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;help-block&quot;</span><span class="o">&gt;&lt;?=</span> <span class="nx">esc</span><span class="p">(</span><span class="nv">$error</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id27">
<h3><a class="toc-backref" href="#id56">配置</a><a class="headerlink" href="#id27" title="永久链接至标题">¶</a></h3>
<p>创建视图后，需要让 Validation 库知道它们。 打开 <code class="docutils literal notranslate"><span class="pre">Config/Validation.php</span></code>，在里面找到 <code class="docutils literal notranslate"><span class="pre">$templates</span></code> 属性。
你可以在其中列出任意多个自定义视图，并提供一个可以引用他们的短别名。我们将添加上边的示例文件，它看起来像：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nv">$templates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;list&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;CodeIgniter\Validation\Views\list&#39;</span><span class="p">,</span>
    <span class="s1">&#39;single&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;CodeIgniter\Validation\Views\single&#39;</span><span class="p">,</span>
    <span class="s1">&#39;my_list&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;_errors_list&#39;</span>
<span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="id28">
<h3><a class="toc-backref" href="#id57">指定模板</a><a class="headerlink" href="#id28" title="永久链接至标题">¶</a></h3>
<p>通过将别名作为 <code class="docutils literal notranslate"><span class="pre">listErrors</span></code> 方法的第一个参数，来指定要使用的模板：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?=</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">listErrors</span><span class="p">(</span><span class="s1">&#39;my_list&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>当显示特定字段错误时，你可以将别名作为第二个参数传递给 <code class="docutils literal notranslate"><span class="pre">showError</span></code> 方法，别名参数应该在字段名称之后：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?=</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">showError</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;my_single&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id29">
<h2><a class="toc-backref" href="#id58">创建自定义规则</a><a class="headerlink" href="#id29" title="永久链接至标题">¶</a></h2>
<p>规则简单的存储在命名空间类中。只要自动加载器能找到它们，你可将他们存储到任何位置。这些文件称作规则集。要添加新的规则集，
请编辑 <strong>Config/Validation.php</strong> 并将新文件添加到 <code class="docutils literal notranslate"><span class="pre">$ruleSets</span></code> 数组：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nv">$ruleSets</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">\CodeIgniter\Validation\Rules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\CodeIgniter\Validation\FileRules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\CodeIgniter\Validation\CreditCardRules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>
</div>
<p>你可以将其添加为具有完全限定类的简单字符串，或者使用 <code class="docutils literal notranslate"><span class="pre">::class</span></code> 后缀进行添加。如上所示，这里的好处是，它在更高级的 IED
中提供了额外的一些导航功能。</p>
<p>在文件中，每一个方法都是一个规则，它必须接受字符串作为第一个字符串，并且必须返回布尔值 true 或 false 。如果通过测试则返回
true ，否则返回 false 。</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyRules</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">even</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$str</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$str</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>默认情况下，系统将在 <code class="docutils literal notranslate"><span class="pre">CodeIgniter\Language\en\Validation.php</span></code> 中查找错误要使用语言字符串。在自定义规则中，你可以通过第二个参数 $error 的引用来
提供错误消息：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">even</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$str</span><span class="p">,</span> <span class="nx">string</span> <span class="o">&amp;</span><span class="nv">$error</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">int</span><span class="p">)</span><span class="nv">$str</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nx">lang</span><span class="p">(</span><span class="s1">&#39;myerrors.evenError&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>现在你可像其他规则一样使用新的自定义规则：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|even&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<div class="section" id="id30">
<h3><a class="toc-backref" href="#id59">允许参数</a><a class="headerlink" href="#id30" title="永久链接至标题">¶</a></h3>
<p>如果你的方法需要使用参数，则该函数至少需要三个参数：要验证的字符串、参数字符串以及包含提交表单所有数据的数组。
$data 数组对于像 require_with 这样需要检查另一个提交字段的值作为其结果基础的规则来说十分方便：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">required_with</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$fields</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$data</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
<span class="p">{</span>
    <span class="nv">$fields</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$fields</span><span class="p">);</span>

    <span class="c1">// If the field is present we can safely assume that</span>
    <span class="c1">// the field is here, no matter whether the corresponding</span>
    <span class="c1">// search field is present or not.</span>
    <span class="nv">$present</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">required</span><span class="p">(</span><span class="nv">$str</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$present</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Still here? Then we fail this test if</span>
    <span class="c1">// any of the fields are present in $data</span>
    <span class="c1">// as $fields is the lis</span>
    <span class="nv">$requiredFields</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$fields</span> <span class="k">as</span> <span class="nv">$field</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$field</span><span class="p">,</span> <span class="nv">$data</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nv">$requiredFields</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$field</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Remove any keys with empty values since, that means they</span>
    <span class="c1">// weren&#39;t truly there, as far as this is concerned.</span>
    <span class="nv">$requiredFields</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$requiredFields</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$item</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="nv">$item</span><span class="p">]);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$requiredFields</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>自定义错误可以通过第四个参数传递，如上所述。</p>
</div>
</div>
<div class="section" id="id31">
<h2><a class="toc-backref" href="#id60">可用规则</a><a class="headerlink" href="#id31" title="永久链接至标题">¶</a></h2>
<p>以下是可供使用的所有本地规则的列表：</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">规则是一个字符串；参数之间 <strong>不能有空格</strong>，尤其是 <code class="docutils literal notranslate"><span class="pre">is_unique</span></code> 规则。
<code class="docutils literal notranslate"><span class="pre">ignore_value</span></code> 前后不能有空格。</p>
</div>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// is_unique[table.field,ignore_field,ignore_value]</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;is_unique[supplier.name,uuid, </span><span class="si">$uuid</span><span class="s2">]&quot;</span><span class="p">,</span>  <span class="c1">// is not ok</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;is_unique[supplier.name,uuid,</span><span class="si">$uuid</span><span class="s2"> ]&quot;</span><span class="p">,</span>  <span class="c1">// is not ok</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;is_unique[supplier.name,uuid,</span><span class="si">$uuid</span><span class="s2">]&quot;</span><span class="p">,</span>   <span class="c1">// is ok</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;is_unique[supplier.name,uuid,{uuid}]&quot;</span><span class="p">,</span>  <span class="c1">// is ok - see &quot;Validation Placeholders&quot;</span>
<span class="p">]);</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="6%" />
<col width="52%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Rule</th>
<th class="head">Parameter</th>
<th class="head">Description</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>alpha</td>
<td>No</td>
<td>Fails if field has anything other than alphabetic characters.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>alpha_space</td>
<td>No</td>
<td>Fails if field contains anything other than alphabetic characters or spaces.</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>alpha_dash</td>
<td>No</td>
<td>Fails if field contains anything other than alphanumeric characters, underscores or dashes.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>alpha_numeric</td>
<td>No</td>
<td>Fails if field contains anything other than alphanumeric characters.</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>alpha_numeric_space</td>
<td>No</td>
<td>Fails if field contains anything other than alphanumeric or space characters.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>alpha_numeric_punct</td>
<td>No</td>
<td>Fails if field contains anything other than alphanumeric, space, or this limited set of
punctuation characters: ~ (tilde), ! (exclamation), # (number), $ (dollar), % (percent),
&amp; (ampersand), * (asterisk), - (dash), _ (underscore), + (plus), = (equals),
| (vertical bar), : (colon), . (period).</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>decimal</td>
<td>No</td>
<td>Fails if field contains anything other than a decimal number.
Also accepts a + or  - sign for the number.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>differs</td>
<td>Yes</td>
<td>Fails if field does not differ from the one in the parameter.</td>
<td>differs[field_name]</td>
</tr>
<tr class="row-even"><td>exact_length</td>
<td>Yes</td>
<td>Fails if field is not exactly the parameter value. One or more comma-separated values.</td>
<td>exact_length[5] or exact_length[5,8,12]</td>
</tr>
<tr class="row-odd"><td>greater_than</td>
<td>Yes</td>
<td>Fails if field is less than or equal to the parameter value or not numeric.</td>
<td>greater_than[8]</td>
</tr>
<tr class="row-even"><td>greater_than_equal_to</td>
<td>Yes</td>
<td>Fails if field is less than the parameter value, or not numeric.</td>
<td>greater_than_equal_to[5]</td>
</tr>
<tr class="row-odd"><td>hex</td>
<td>No</td>
<td>Fails if field contains anything other than hexadecimal characters.</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>if_exist</td>
<td>No</td>
<td>If this rule is present, validation will only return possible errors if the field key exists,
regardless of its value.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>in_list</td>
<td>Yes</td>
<td>Fails if field is not within a predetermined list.</td>
<td>in_list[red,blue,green]</td>
</tr>
<tr class="row-even"><td>integer</td>
<td>No</td>
<td>Fails if field contains anything other than an integer.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>is_natural</td>
<td>No</td>
<td>Fails if field contains anything other than a natural number: 0, 1, 2, 3, etc.</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>is_natural_no_zero</td>
<td>No</td>
<td>Fails if field contains anything other than a natural number, except zero: 1, 2, 3, etc.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>is_not_unique</td>
<td>Yes</td>
<td>Checks the database to see if the given value exist. Can ignore records by field/value to
filter (currently accept only one filter).</td>
<td>is_not_unique[table.field,where_field,where_value]</td>
</tr>
<tr class="row-even"><td>is_unique</td>
<td>Yes</td>
<td>Checks if this field value exists in the database. Optionally set a
column and value to ignore, useful when updating records to ignore itself.</td>
<td>is_unique[table.field,ignore_field,ignore_value]</td>
</tr>
<tr class="row-odd"><td>less_than</td>
<td>Yes</td>
<td>Fails if field is greater than or equal to the parameter value or not numeric.</td>
<td>less_than[8]</td>
</tr>
<tr class="row-even"><td>less_than_equal_to</td>
<td>Yes</td>
<td>Fails if field is greater than the parameter value or not numeric.</td>
<td>less_than_equal_to[8]</td>
</tr>
<tr class="row-odd"><td>matches</td>
<td>Yes</td>
<td>The value must match the value of the field in the parameter.</td>
<td>matches[field]</td>
</tr>
<tr class="row-even"><td>max_length</td>
<td>Yes</td>
<td>Fails if field is longer than the parameter value.</td>
<td>max_length[8]</td>
</tr>
<tr class="row-odd"><td>min_length</td>
<td>Yes</td>
<td>Fails if field is shorter than the parameter value.</td>
<td>min_length[3]</td>
</tr>
<tr class="row-even"><td>numeric</td>
<td>No</td>
<td>Fails if field contains anything other than numeric characters.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>regex_match</td>
<td>Yes</td>
<td>Fails if field does not match the regular expression.</td>
<td>regex_match[/regex/]</td>
</tr>
<tr class="row-even"><td>permit_empty</td>
<td>No</td>
<td>Allows the field to receive an empty array, empty string, null or false.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>required</td>
<td>No</td>
<td>Fails if the field is an empty array, empty string, null or false.</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>required_with</td>
<td>Yes</td>
<td>The field is required when any of the other required fields are present in the data.</td>
<td>required_with[field1,field2]</td>
</tr>
<tr class="row-odd"><td>required_without</td>
<td>Yes</td>
<td>The field is required when all of the other fields are present in the data but not required.</td>
<td>required_without[field1,field2]</td>
</tr>
<tr class="row-even"><td>string</td>
<td>No</td>
<td>A generic alternative to the alpha* rules that confirms the element is a string</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>timezone</td>
<td>No</td>
<td>Fails if field does match a timezone per <code class="docutils literal notranslate"><span class="pre">timezone_identifiers_list</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>valid_base64</td>
<td>No</td>
<td>Fails if field contains anything other than valid Base64 characters.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>valid_json</td>
<td>No</td>
<td>Fails if field does not contain a valid JSON string.</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>valid_email</td>
<td>No</td>
<td>Fails if field does not contain a valid email address.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>valid_emails</td>
<td>No</td>
<td>Fails if any value provided in a comma separated list is not a valid email.</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>valid_ip</td>
<td>No</td>
<td>Fails if the supplied IP is not valid. Accepts an optional parameter of ‘ipv4’ or
‘ipv6’ to specify an IP format.</td>
<td>valid_ip[ipv6]</td>
</tr>
<tr class="row-odd"><td>valid_url</td>
<td>No</td>
<td>Fails if field does not contain a valid URL.</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>valid_date</td>
<td>No</td>
<td>Fails if field does not contain a valid date. Accepts an optional parameter
to matches a date format.</td>
<td>valid_date[d/m/Y]</td>
</tr>
<tr class="row-odd"><td>valid_cc_number</td>
<td>Yes</td>
<td>Verifies that the credit card number matches the format used by the specified provider.
Current supported providers are: American Express (amex), China Unionpay (unionpay),
Diners Club CarteBlance (carteblanche), Diners Club (dinersclub), Discover Card (discover),
Interpayment (interpayment), JCB (jcb), Maestro (maestro), Dankort (dankort), NSPK MIR (mir),
Troy (troy), MasterCard (mastercard), Visa (visa), UATP (uatp), Verve (verve),
CIBC Convenience Card (cibc), Royal Bank of Canada Client Card (rbc),
TD Canada Trust Access Card (tdtrust), Scotiabank Scotia Card (scotia), BMO ABM Card (bmoabm),
HSBC Canada Card (hsbc)</td>
<td>valid_cc_number[amex]</td>
</tr>
</tbody>
</table>
<div class="section" id="id32">
<h3><a class="toc-backref" href="#id61">文件上传规则</a><a class="headerlink" href="#id32" title="永久链接至标题">¶</a></h3>
<p>这些验证规则可以让你进行基本的检查，验证上传的文件是否满足你的业务需求。
由于文件上传字段在 HTML 字段中不存在，并且存储在 $_FILES 全局变量中，
因此字段名需要输入两次，第一个用于指定验证的字段，像其他规则一样，第二次
作为所有文件上传规则的第一个参数：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// In the HTML</span>
<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;file&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;avatar&quot;</span><span class="o">&gt;</span>

<span class="c1">// In the controller</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
    <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;uploaded[avatar]|max_size[avatar,1024]&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="7%" />
<col width="56%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Rule</th>
<th class="head">Parameter</th>
<th class="head">Description</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>uploaded</td>
<td>Yes</td>
<td>Fails if the name of the parameter does not match the name of any uploaded files.</td>
<td>uploaded[field_name]</td>
</tr>
<tr class="row-odd"><td>max_size</td>
<td>Yes</td>
<td>Fails if the uploaded file named in the parameter is larger than the second parameter in
kilobytes (kb).</td>
<td>max_size[field_name,2048]</td>
</tr>
<tr class="row-even"><td>max_dims</td>
<td>Yes</td>
<td>Fails if the maximum width and height of an uploaded image exceed values. The first parameter
is the field name. The second is the width, and the third is the height. Will also fail if
the file cannot be determined to be an image.</td>
<td>max_dims[field_name,300,150]</td>
</tr>
<tr class="row-odd"><td>mime_in</td>
<td>Yes</td>
<td>Fails if the file’s mime type is not one listed in the parameters.</td>
<td>mime_in[field_name,image/png,image/jpg]</td>
</tr>
<tr class="row-even"><td>ext_in</td>
<td>Yes</td>
<td>Fails if the file’s extension is not one listed in the parameters.</td>
<td>ext_in[field_name,png,jpg,gif]</td>
</tr>
<tr class="row-odd"><td>is_image</td>
<td>Yes</td>
<td>Fails if the file cannot be determined to be an image based on the mime type.</td>
<td>is_image[field_name]</td>
</tr>
</tbody>
</table>
<p>文件验证规则适用于单个和多个文件上传。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">你也可以使用任何最多允许两个参数的本地 PHP 函数，
其中至少需要一个参数（传递字段数据）。</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../helpers/index.html" class="btn btn-neutral float-right" title="辅助函数" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="user_agent.html" class="btn btn-neutral float-left" title="User Agent Class" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> 上一页</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 版权所有 2019-2020 CodeIgniter 基金会
      <span class="lastupdated">
        最后更新于 2020-11-21.
      </span>

    </p>
  </div>
    
    
    
    利用 <a href="http://sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
  <p></p>
  <p>由 <a href="https://codeigniter.org.cn">CodeIgniter 中国开发者社区</a>翻译并制作</p>
  <p>
    <a href="https://github.com/CodeIgniter-Chinese/codeigniter4-user-guide" target="_blank">Github 简体中文翻译</a>
    ·
    <a href="https://codeigniter-chinese.github.io/codeigniter4-user-guide/codeigniter_user_guide.zip">离线版压缩包下载</a>
    ·
    <a href="https://codeigniter-chinese.github.io/codeigniter4-user-guide/CodeIgniter.pdf">PDF 版下载</a>
    <!--·
    <a href="https://codeigniter-chinese.github.io/codeigniter4-user-guide/CodeIgniter4.epub">EPUB 版下载</a>-->
  </p>


</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>