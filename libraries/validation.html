<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>验证 &mdash; CodeIgniter 4.3.6 文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/citheme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/citheme_dark.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
        <script src="../_static/js/citheme.js"></script>
        <script src="../_static/js/carbon.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="辅助函数" href="../helpers/index.html" />
    <link rel="prev" title="用户代理类" href="user_agent.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/ci-logo-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">欢迎使用 CodeIgniter4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/index.html">欢迎使用 CodeIgniter4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/requirements.html">服务器需求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/credits.html">致谢</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/psr.html">PSR 兼容性</a></li>
<li class="toctree-l2"><a class="reference internal" href="../license.html">许可协议</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">安装</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation/installing_composer.html">Composer 安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/installing_manual.html">手动安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/running.html">运行你的应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/troubleshooting.html">故障排除</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelogs/index.html">变更记录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/upgrading.html">从前一版本升级</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/repositories.html">CodeIgniter 仓库</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">构建你的第一个应用程序</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/static_pages.html">静态页面</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/news_section.html">新闻部分</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/create_news_items.html">创建新闻</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/conclusion.html">结束语</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">CodeIgniter4 概览</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/structure.html">应用程序结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/mvc.html">模型、视图和控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/autoloader.html">自动加载文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/services.html">服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/factories.html">工厂</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/http.html">处理 HTTP 请求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/security.html">安全指南</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general/index.html">常规主题</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../general/configuration.html">配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/urls.html">CodeIgniter URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/helpers.html">辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/common_functions.html">全局函数和常量</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/logging.html">记录信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/errors.html">错误处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/caching.html">网页缓存</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/ajax.html">AJAX 请求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/modules.html">代码模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/managing_apps.html">管理应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/environments.html">处理多个环境</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../incoming/index.html">控制器和路由</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../incoming/routing.html">URI 路由</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/controllers.html">控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/filters.html">控制器过滤器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/message.html">HTTP 消息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/request.html">请求类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/incomingrequest.html">IncomingRequest 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/content_negotiation.html">内容协商</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/methodspoofing.html">HTTP 方法欺骗</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/restful.html">RESTful 资源处理</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../outgoing/index.html">构建响应</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/views.html">视图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_cells.html">视图单元格</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_renderer.html">视图渲染器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_layouts.html">视图布局</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_parser.html">视图解析器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_decorators.html">视图装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/table.html">HTML 表格类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/response.html">HTTP 响应</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/api_responses.html">API 响应特性</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/localization.html">本地化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/alternative_php.html">在视图文件中使用 PHP 替代语法</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../database/index.html">使用数据库</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/examples.html">快速入门:使用示例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/configuration.html">数据库配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/connecting.html">连接数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/queries.html">运行查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/results.html">生成查询结果</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/helpers.html">查询辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/query_builder.html">查询构建器类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/transactions.html">事务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/metadata.html">获取元数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/call_function.html">自定义函数调用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/events.html">数据库事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/utilities.html">数据库实用工具</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/index.html">数据建模</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/model.html">使用 CodeIgniter 的 Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/entities.html">使用实体类</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dbmgmt/index.html">管理数据库</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/forge.html">使用数据库 Forge 维护数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/migration.html">数据库迁移</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/seeds.html">数据库填充</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/db_commands.html">数据库命令</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">类库参考</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="caching.html">缓存驱动</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookies.html">Cookie</a></li>
<li class="toctree-l2"><a class="reference internal" href="curlrequest.html">CURLRequest 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="email.html">Email 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="encryption.html">Encryption 服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="files.html">处理文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_collections.html">文件集合</a></li>
<li class="toctree-l2"><a class="reference internal" href="honeypot.html">Honeypot 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="images.html">图像处理类</a></li>
<li class="toctree-l2"><a class="reference internal" href="pagination.html">分页</a></li>
<li class="toctree-l2"><a class="reference internal" href="publisher.html">Publisher</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">安全性</a></li>
<li class="toctree-l2"><a class="reference internal" href="sessions.html">Session 库</a></li>
<li class="toctree-l2"><a class="reference internal" href="throttler.html">限速器</a></li>
<li class="toctree-l2"><a class="reference internal" href="time.html">时间和日期</a></li>
<li class="toctree-l2"><a class="reference internal" href="typography.html">排版</a></li>
<li class="toctree-l2"><a class="reference internal" href="uploaded_files.html">处理上传的文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="uri.html">使用 URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_agent.html">用户代理类</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">验证</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../helpers/index.html">辅助函数</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../helpers/array_helper.html">Array 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/cookie_helper.html">Cookie 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/date_helper.html">Date 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/filesystem_helper.html">文件系统辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/form_helper.html">表单辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/html_helper.html">HTML 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/inflector_helper.html">Inflector 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/number_helper.html">数字辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/security_helper.html">安全辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/test_helper.html">测试辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/text_helper.html">文本辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/url_helper.html">URL 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/xml_helper.html">XML 辅助函数</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">测试</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing/overview.html">入门指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/database.html">数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/fabricator.html">生成数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/controllers.html">测试控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/feature.html">HTTP 测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/response.html">测试响应</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/benchmark.html">基准测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/debugging.html">调试应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/mocking.html">模拟</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">命令行使用</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_overview.html">CLI 概览</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_controllers.html">通过 CLI 运行控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/spark_commands.html">Spark 命令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_commands.html">创建 Spark 命令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_generators.html">CLI 生成器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_library.html">CLI 库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_request.html">CLIRequest 类</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">扩展 CodeIgniter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../extending/core_classes.html">创建核心系统类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/common.html">替换通用函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/events.html">事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/basecontroller.html">扩展控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/authentication.html">认证</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/contributing.html">为 CodeIgniter 做贡献</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="official_packages.html">官方包</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CodeIgniter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">类库参考</a></li>
      <li class="breadcrumb-item active">验证</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="validation">
<span id="id1"></span><h1>验证<a class="headerlink" href="#validation" title="永久链接至标题"></a></h1>
<p>CodeIgniter 提供了一个全面的数据验证类,可以帮助 minimizing 你编写的代码量。</p>
<div class="contents local topic" id="id2">
<ul class="simple">
<li><p><a class="reference internal" href="#id3" id="id53">概览</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id54">表单验证教程</a></p>
<ul>
<li><p><a class="reference internal" href="#id5" id="id55">表单</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id56">成功页面</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id57">控制器</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id58">路由</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id59">试一试!</a></p></li>
<li><p><a class="reference internal" href="#id10" id="id60">解释</a></p></li>
<li><p><a class="reference internal" href="#id11" id="id61">添加验证规则</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id12" id="id62">验证配置</a></p>
<ul>
<li><p><a class="reference internal" href="#validation-traditional-and-strict-rules" id="id63">传统规则和严格规则</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id17" id="id64">加载库</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id65">设置验证规则</a></p>
<ul>
<li><p><a class="reference internal" href="#id19" id="id66">设置单个规则</a></p></li>
<li><p><a class="reference internal" href="#id20" id="id67">设置多个规则</a></p></li>
<li><p><a class="reference internal" href="#validation-withrequest" id="id68">为数组数据设置规则</a></p></li>
<li><p><a class="reference internal" href="#withrequest" id="id69">withRequest()</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id22" id="id70">使用验证</a></p>
<ul>
<li><p><a class="reference internal" href="#id23" id="id71">运行验证</a></p></li>
<li><p><a class="reference internal" href="#id24" id="id72">运行多个验证</a></p></li>
<li><p><a class="reference internal" href="#id25" id="id73">验证单个值</a></p></li>
<li><p><a class="reference internal" href="#id26" id="id74">将一组验证规则保存到配置文件</a></p></li>
<li><p><a class="reference internal" href="#validation-placeholders" id="id75">验证占位符</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id32" id="id76">处理错误</a></p>
<ul>
<li><p><a class="reference internal" href="#validation-custom-errors" id="id77">设置自定义错误消息</a></p></li>
<li><p><a class="reference internal" href="#id34" id="id78">翻译消息和验证标签</a></p></li>
<li><p><a class="reference internal" href="#validation-getting-all-errors" id="id79">获取所有错误</a></p></li>
<li><p><a class="reference internal" href="#id36" id="id80">获取单个错误</a></p></li>
<li><p><a class="reference internal" href="#id37" id="id81">检查错误是否存在</a></p></li>
<li><p><a class="reference internal" href="#validation-redirect-and-validation-errors" id="id82">重定向和验证错误</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#validation-customizing-error-display" id="id83">自定义错误显示</a></p>
<ul>
<li><p><a class="reference internal" href="#id40" id="id84">创建视图</a></p></li>
<li><p><a class="reference internal" href="#id41" id="id85">配置</a></p></li>
<li><p><a class="reference internal" href="#id42" id="id86">指定模板</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id43" id="id87">创建自定义规则</a></p>
<ul>
<li><p><a class="reference internal" href="#validation-using-rule-classes" id="id88">使用规则类</a></p></li>
<li><p><a class="reference internal" href="#validation-using-closure-rule" id="id89">使用闭包规则</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id50" id="id90">可用规则</a></p>
<ul>
<li><p><a class="reference internal" href="#id51" id="id91">常规规则</a></p></li>
<li><p><a class="reference internal" href="#rules-for-file-uploads" id="id92">文件上传规则</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="id3">
<h2><a class="toc-backref" href="#id53">概览</a><a class="headerlink" href="#id3" title="永久链接至标题"></a></h2>
<p>在解释 CodeIgniter 的数据验证方法之前,让我们描述一下理想的场景:</p>
<ol class="arabic simple">
<li><p>显示一个表单。</p></li>
<li><p>你填写表单并提交。</p></li>
<li><p>如果你提交了无效的或缺少必需项的数据,表单会重新显示,并包含你的数据和描述问题的错误信息。</p></li>
<li><p>这个过程会继续,直到你提交了一个有效的表单。</p></li>
</ol>
<p>接收端必须:</p>
<ol class="arabic simple">
<li><p>检查必需的数据。</p></li>
<li><p>验证数据类型正确,并满足正确的标准。例如,如果提交了用户名,必须验证它只包含允许的字符。它必须有最小长度,并且不超过最大长度。用户名不能是其他人已存在的用户名,或者可能是保留字等。</p></li>
<li><p>为安全起见对数据进行 sanitize。</p></li>
<li><p>如果需要的话预格式化数据。</p></li>
<li><p>准备数据以便插入数据库。</p></li>
</ol>
<p>尽管上述过程没有非常复杂的地方,但通常需要大量的代码,为了显示错误信息,各种控制结构通常放在表单 HTML 中。表单验证虽简单但一般实现起来既混乱又乏味。</p>
</section>
<section id="id4">
<h2><a class="toc-backref" href="#id54">表单验证教程</a><a class="headerlink" href="#id4" title="永久链接至标题"></a></h2>
<p>以下是实现 CodeIgniter 表单验证的“动手”教程。</p>
<p>为了实现表单验证,你需要三件事:</p>
<ol class="arabic simple">
<li><p>包含表单的 <a class="reference internal" href="../outgoing/views.html"><span class="doc">视图</span></a> 文件。</p></li>
<li><p>包含成功提交的“成功”消息的视图文件。</p></li>
<li><p><a class="reference internal" href="../incoming/controllers.html"><span class="doc">控制器</span></a> 方法来接收和处理提交的数据。</p></li>
</ol>
<p>让我们创建这三件事,以会员注册表单为例。</p>
<section id="id5">
<h3><a class="toc-backref" href="#id55">表单</a><a class="headerlink" href="#id5" title="永久链接至标题"></a></h3>
<p>使用文本编辑器,创建一个名为 <strong>signup.php</strong> 的表单。在其中放入以下代码并保存到你的 <strong>app/Views/</strong> 文件夹:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">我的表单</span><span class="o">&lt;/</span><span class="nx">title</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>

    <span class="o">&lt;?=</span> <span class="nx">validation_list_errors</span><span class="p">()</span> <span class="cp">?&gt;</span>

    <span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">form_open</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>

        <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>用户名<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">set_value</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;50&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>密码<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">set_value</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;50&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>确认密码<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;passconf&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">set_value</span><span class="p">(</span><span class="s1">&#39;passconf&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;50&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>电子邮件地址<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">set_value</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;50&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;提交&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">form_close</span><span class="p">()</span> <span class="cp">?&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="id6">
<h3><a class="toc-backref" href="#id56">成功页面</a><a class="headerlink" href="#id6" title="永久链接至标题"></a></h3>
<p>使用文本编辑器,创建一个名为 <strong>success.php</strong> 的页面。在其中放入以下代码,并保存到你的 <strong>app/Views/</strong> 文件夹:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">我的表单</span><span class="o">&lt;/</span><span class="nx">title</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">你的表单已成功提交</span><span class="o">!&lt;/</span><span class="nx">h3</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;?=</span> <span class="nx">anchor</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="s1">&#39;再试一次!&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="id7">
<h3><a class="toc-backref" href="#id57">控制器</a><a class="headerlink" href="#id7" title="永久链接至标题"></a></h3>
<p>使用文本编辑器,创建一个名为 <strong>Form.php</strong> 的控制器。在其中放入以下代码,并保存到你的 <strong>app/Controllers/</strong> 文件夹:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Config\Services</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Form</span> <span class="k">extends</span> <span class="nx">BaseController</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$helpers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">is</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;signup&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$rules</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span><span class="nv">$rules</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;signup&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>从 v4.3.0 开始,可以使用 <a class="reference internal" href="../incoming/incomingrequest.html#incomingrequest-is"><span class="std std-ref">$this-&gt;request-&gt;is()</span></a> 方法。
在早期版本中,需要使用 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(strtolower($this-&gt;request-&gt;getMethod())</span> <span class="pre">!==</span> <span class="pre">'post')</span></code>。</p>
</div>
</section>
<section id="id8">
<h3><a class="toc-backref" href="#id58">路由</a><a class="headerlink" href="#id8" title="永久链接至标题"></a></h3>
<p>然后在 <strong>app/Config/Routes.php</strong> 中为控制器添加路由:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// ...</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="s1">&#39;Form::index&#39;</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="s1">&#39;Form::index&#39;</span><span class="p">);</span>

<span class="c1">// ...</span>
</pre></div>
</div>
</section>
<section id="id9">
<h3><a class="toc-backref" href="#id59">试一试!</a><a class="headerlink" href="#id9" title="永久链接至标题"></a></h3>
<p>要测试你的表单,使用类似这样的 URL 访问你的网站:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nx">example</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">index</span><span class="o">.</span><span class="nx">php</span><span class="o">/</span><span class="nx">form</span><span class="o">/</span>
</pre></div>
</div>
<p>如果提交表单,你应该只是简单地看到表单重新加载。这是因为你还没有在 <code class="docutils literal notranslate"><span class="pre">$this-&gt;validate()</span></code> 中设置任何验证规则。</p>
<p><code class="docutils literal notranslate"><span class="pre">validate()</span></code> 方法是控制器中的一个方法。它使用内部的 <strong>验证类</strong>。参见 <a class="reference internal" href="../incoming/controllers.html#controllers-validating-data"><span class="std std-ref">验证数据</span></a>。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>由于你还没有告诉 <code class="docutils literal notranslate"><span class="pre">validate()</span></code> 方法要验证任何内容,它**默认返回 false**(布尔值 false)。只有在成功应用你的规则且没有失败时,``validate()`` 方法才会返回 true。</p>
</div>
</section>
<section id="id10">
<h3><a class="toc-backref" href="#id60">解释</a><a class="headerlink" href="#id10" title="永久链接至标题"></a></h3>
<p>你会注意到上面的页面有几件事。</p>
<section id="signup-php">
<h4>signup.php<a class="headerlink" href="#signup-php" title="永久链接至标题"></a></h4>
<p>表单(<strong>signup.php</strong>)是一个标准的网页表单,有一些例外:</p>
<ol class="arabic">
<li><p>它使用 <a class="reference internal" href="../helpers/form_helper.html"><span class="doc">表单助手</span></a> 来创建表单的开标签和闭标签。从技术上讲,这不是必需的。你可以使用标准 HTML 来创建表单。
但是,使用助手的好处是它会根据你的配置文件中的 URL 为你生成 action URL。这使得在 URL 变更的情况下你的应用更具可移植性。</p></li>
<li><p>在表单顶部,你会注意到以下函数调用:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?=</span> <span class="nx">validation_list_errors</span><span class="p">()</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>这个函数将返回验证器发送回的任何错误消息。如果没有消息,它会返回一个空字符串。</p>
</li>
</ol>
</section>
<section id="form-php">
<h4>Form.php<a class="headerlink" href="#form-php" title="永久链接至标题"></a></h4>
<p>控制器(<strong>Form.php</strong>)有一个属性:<code class="docutils literal notranslate"><span class="pre">$helpers</span></code>。
它加载了视图文件使用的表单助手。</p>
<p>控制器有一个方法:<code class="docutils literal notranslate"><span class="pre">index()</span></code>。这个方法在收到非 POST 请求时返回 <strong>signup</strong> 视图以显示表单。否则,它使用控制器提供的 <code class="docutils literal notranslate"><span class="pre">validate()</span></code> 方法。它还运行验证例程。
根据验证是否成功,它要么显示表单,要么显示成功页面。</p>
</section>
</section>
<section id="id11">
<h3><a class="toc-backref" href="#id61">添加验证规则</a><a class="headerlink" href="#id11" title="永久链接至标题"></a></h3>
<p>然后在控制器中添加验证规则(<strong>Form.php</strong>):</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// ...</span>

<span class="nv">$rules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span><span class="p">,</span>
    <span class="s1">&#39;passconf&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|matches[password]&#39;</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email&#39;</span><span class="p">,</span>
<span class="p">];</span>

<span class="c1">// ...</span>
</pre></div>
</div>
<p>如果提交表单,你应该看到成功页面或带错误消息的表单。</p>
</section>
</section>
<section id="id12">
<h2><a class="toc-backref" href="#id62">验证配置</a><a class="headerlink" href="#id12" title="永久链接至标题"></a></h2>
<section id="validation-traditional-and-strict-rules">
<span id="id13"></span><h3><a class="toc-backref" href="#id63">传统规则和严格规则</a><a class="headerlink" href="#validation-traditional-and-strict-rules" title="永久链接至标题"></a></h3>
<p>CodeIgniter 4 有两种验证规则类。
传统规则类(<strong>传统规则</strong>)命名空间为 <code class="docutils literal notranslate"><span class="pre">CodeIgniter\Validation</span></code>,
新的类(<strong>严格规则</strong>)命名空间为 <code class="docutils literal notranslate"><span class="pre">CodeIgniter\Validation\StrictRules</span></code>,提供严格验证。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>从 v4.3.0 开始,默认使用 <strong>严格规则</strong> 以获得更好的安全性。</p>
</div>
<section id="id14">
<h4>传统规则<a class="headerlink" href="#id14" title="永久链接至标题"></a></h4>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>在验证包含非字符串值的数据时,比如 JSON 数据,推荐使用 <strong>严格规则</strong>。</p>
</div>
<p><strong>传统规则</strong> 隐式地假设正在验证字符串值,输入值可能会隐式转换为字符串值。
它适用于大多数基本情况,如验证 POST 数据。</p>
<p>但是,例如,如果你使用 JSON 输入数据,它可能是 bool/null/array 类型。
当你使用传统规则类验证布尔值 <code class="docutils literal notranslate"><span class="pre">true</span></code> 时,它会被转换为字符串 <code class="docutils literal notranslate"><span class="pre">'1'</span></code>。
如果使用 <code class="docutils literal notranslate"><span class="pre">integer</span></code> 规则对其进行验证,``’1’`` 可以通过验证。</p>
</section>
<section id="id15">
<h4>严格规则<a class="headerlink" href="#id15" title="永久链接至标题"></a></h4>
<div class="versionadded">
<p><span class="versionmodified added">4.2.0 新版功能.</span></p>
</div>
<p><strong>严格规则</strong> 不使用隐式类型转换。</p>
</section>
<section id="id16">
<h4>使用传统规则<a class="headerlink" href="#id16" title="永久链接至标题"></a></h4>
<p>如果你想使用传统规则,需要在 <strong>app/Config/Validation.php</strong> 中更改规则类:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Config</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Validation</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">array</span> <span class="nv">$ruleSets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">\CodeIgniter\Validation\CreditCardRules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\CodeIgniter\Validation\FileRules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\CodeIgniter\Validation\FormatRules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">\CodeIgniter\Validation\Rules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="id17">
<h2><a class="toc-backref" href="#id64">加载库</a><a class="headerlink" href="#id17" title="永久链接至标题"></a></h2>
<p>该库以名为 <strong>validation</strong> 的服务加载:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span> <span class="o">=</span> <span class="nx">\Config\Services</span><span class="o">::</span><span class="na">validation</span><span class="p">();</span>
</pre></div>
</div>
<p>这会自动加载 <code class="docutils literal notranslate"><span class="pre">Config\Validation</span></code> 文件,其中包含用于包含多个 Rulesets 的设置,以及可以轻松重用的规则集合。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>你可能永远不需要使用这个方法,因为 <a class="reference internal" href="../incoming/controllers.html"><span class="doc">控制器</span></a> 和
<a class="reference internal" href="../models/model.html"><span class="doc">模型</span></a> 都提供了使验证更容易的方法。</p>
</div>
</section>
<section id="id18">
<h2><a class="toc-backref" href="#id65">设置验证规则</a><a class="headerlink" href="#id18" title="永久链接至标题"></a></h2>
<p>CodeIgniter 允许你根据需要为一个字段设置尽可能多的验证规则,级联地指定它们。要设置验证规则,
你将使用 <code class="docutils literal notranslate"><span class="pre">setRule()</span></code>、<code class="docutils literal notranslate"><span class="pre">setRules()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">withRequest()</span></code> 方法。</p>
<section id="id19">
<h3><a class="toc-backref" href="#id66">设置单个规则</a><a class="headerlink" href="#id19" title="永久链接至标题"></a></h3>
<section id="setrule">
<h4>setRule()<a class="headerlink" href="#setrule" title="永久链接至标题"></a></h4>
<p>这个方法设置一个规则。它具有如下方法签名:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nx">setRule</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$field</span><span class="p">,</span> <span class="o">?</span><span class="nx">string</span> <span class="nv">$label</span><span class="p">,</span> <span class="k">array</span><span class="o">|</span><span class="nx">string</span> <span class="nv">$rules</span><span class="p">[,</span> <span class="k">array</span> <span class="nv">$errors</span> <span class="o">=</span> <span class="p">[]])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">$rules</span></code> 可以接收管道分隔的规则列表,或者规则数组:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRule</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="s1">&#39;required|min_length[3]&#39;</span><span class="p">);</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRule</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;Password&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;min_length[8]&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_numeric_punct&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>你传递给 <code class="docutils literal notranslate"><span class="pre">$field</span></code> 的值必须匹配传入数据数组的键。如果数据直接来自 <code class="docutils literal notranslate"><span class="pre">$_POST</span></code>,那么它必须与表单输入名称完全匹配。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>在 v4.2.0 之前,这个方法的第三个参数 <code class="docutils literal notranslate"><span class="pre">$rules</span></code> 的类型提示是接收 <code class="docutils literal notranslate"><span class="pre">string</span></code>。在 v4.2.0 及以后,类型提示被删除以允许数组。为避免在扩展类中覆盖此方法时违反 LSP,子类的方法也应修改为删除类型提示。</p>
</div>
</section>
</section>
<section id="id20">
<h3><a class="toc-backref" href="#id67">设置多个规则</a><a class="headerlink" href="#id20" title="永久链接至标题"></a></h3>
<section id="setrules">
<h4>setRules()<a class="headerlink" href="#setrules" title="永久链接至标题"></a></h4>
<p>像 <code class="docutils literal notranslate"><span class="pre">setRule()</span></code> 一样,但接受字段名称及其规则的数组:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span><span class="p">,</span>
<span class="p">]);</span>
<span class="c1">// or</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;min_length[10]&#39;</span><span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>要给出带标签的错误消息,可以设置如下:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="s1">&#39;rules&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">],</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Password&#39;</span><span class="p">,</span> <span class="s1">&#39;rules&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span><span class="p">],</span>
<span class="p">]);</span>
<span class="c1">// or</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="s1">&#39;rules&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">],</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Password&#39;</span><span class="p">,</span> <span class="s1">&#39;rules&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;min_length[10]&#39;</span><span class="p">]],</span>
<span class="p">]);</span>
</pre></div>
</div>
</section>
</section>
<section id="validation-withrequest">
<span id="id21"></span><h3><a class="toc-backref" href="#id68">为数组数据设置规则</a><a class="headerlink" href="#validation-withrequest" title="永久链接至标题"></a></h3>
<p>如果你的数据在嵌套的关联数组中,你可以使用“点数组语法”来轻松验证数据:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="cm">/*</span>
<span class="cm"> * The data to test:</span>
<span class="cm"> * [</span>
<span class="cm"> *     &#39;contacts&#39; =&gt; [</span>
<span class="cm"> *        &#39;name&#39; =&gt; &#39;Joe Smith&#39;,</span>
<span class="cm"> *         &#39;friends&#39; =&gt; [</span>
<span class="cm"> *             [</span>
<span class="cm"> *                 &#39;name&#39; =&gt; &#39;Fred Flinstone&#39;,</span>
<span class="cm"> *             ],</span>
<span class="cm"> *             [</span>
<span class="cm"> *                 &#39;name&#39; =&gt; &#39;Wilma&#39;,</span>
<span class="cm"> *             ],</span>
<span class="cm"> *         ]</span>
<span class="cm"> *     ]</span>
<span class="cm"> * ]</span>
<span class="cm"> */</span>

<span class="c1">// Joe Smith</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;contacts.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="c1">// Fred Flintsone &amp; Wilma</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;contacts.friends.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>你可以使用通配符 <code class="docutils literal notranslate"><span class="pre">*</span></code> 符号匹配任意一层数组:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Fred Flintsone &amp; Wilma</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;contacts.*.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>当你有单维数组数据时,”点数组语法”也很有用。
例如,下拉多选返回的数据:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="cm">/*</span>
<span class="cm"> * The data to test:</span>
<span class="cm"> * [</span>
<span class="cm"> *     &#39;user_ids&#39; =&gt; [</span>
<span class="cm"> *         1,</span>
<span class="cm"> *         2,</span>
<span class="cm"> *         3,</span>
<span class="cm"> *     ]</span>
<span class="cm"> * ]</span>
<span class="cm"> */</span>

<span class="c1">// Rule</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;user_ids.*&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>
</div>
</section>
<section id="withrequest">
<h3><a class="toc-backref" href="#id69">withRequest()</a><a class="headerlink" href="#withrequest" title="永久链接至标题"></a></h3>
<p>当验证从 HTTP 请求输入的数据时,你会最常使用验证库。如果需要的话,你可以传入当前请求对象的实例,它会获取所有输入数据并将其设置为要验证的数据:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">withRequest</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>这个方法会从
<a class="reference internal" href="../incoming/incomingrequest.html#incomingrequest-getting-json-data"><span class="std std-ref">$request-&gt;getJSON()</span></a>
获取 JSON 数据,当请求是 JSON 请求时(<code class="docutils literal notranslate"><span class="pre">Content-Type:</span> <span class="pre">application/json</span></code>),
或者从
<a class="reference internal" href="../incoming/incomingrequest.html#incomingrequest-retrieving-raw-data"><span class="std std-ref">$request-&gt;getRawInput()</span></a>
获取原始数据,当请求是 PUT、PATCH、DELETE 请求且不是 HTML 表单 POST 时(<code class="docutils literal notranslate"><span class="pre">Content-Type:</span> <span class="pre">multipart/form-data</span></code>),
或者从 <a class="reference internal" href="../incoming/incomingrequest.html#incomingrequest-getting-data"><span class="std std-ref">$request-&gt;getVar()</span></a> 获取数据。</p>
</div>
</section>
</section>
<section id="id22">
<h2><a class="toc-backref" href="#id70">使用验证</a><a class="headerlink" href="#id22" title="永久链接至标题"></a></h2>
<section id="id23">
<h3><a class="toc-backref" href="#id71">运行验证</a><a class="headerlink" href="#id23" title="永久链接至标题"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">run()</span></code> 方法运行验证。它有如下方法签名:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nx">run</span><span class="p">(</span><span class="o">?</span><span class="k">array</span> <span class="nv">$data</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="o">?</span><span class="nx">string</span> <span class="nv">$group</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="o">?</span><span class="nx">string</span> <span class="nv">$dbGroup</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">$data</span></code> 是要验证的数据数组。可选的第二个参数
<code class="docutils literal notranslate"><span class="pre">$group</span></code> 是要应用的 <a class="reference internal" href="#validation-array"><span class="std std-ref">预定义规则组</span></a>。
可选的第三个参数 <code class="docutils literal notranslate"><span class="pre">$dbGroup</span></code> 是要使用的数据库组。</p>
<p>如果验证成功,该方法返回 true。</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// handle validation errors</span>
<span class="p">}</span>
<span class="c1">// or</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s1">&#39;signup&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// handle validation errors</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id24">
<h3><a class="toc-backref" href="#id72">运行多个验证</a><a class="headerlink" href="#id24" title="永久链接至标题"></a></h3>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><code class="docutils literal notranslate"><span class="pre">run()</span></code> 方法不会重置错误状态。如果前一次运行失败,``run()`` 将总是返回 false,``getErrors()`` 将返回所有先前的错误,直到明确重置。</p>
</div>
<p>如果你打算运行多个验证,例如对不同的数据集或之后的规则,你可能需要在每次运行之前调用 <code class="docutils literal notranslate"><span class="pre">$validation-&gt;reset()</span></code> 来清除之前运行的错误。要注意 <code class="docutils literal notranslate"><span class="pre">reset()</span></code> 会使任何数据、规则或自定义错误无效,所以 <code class="docutils literal notranslate"><span class="pre">setRules()</span></code>、<code class="docutils literal notranslate"><span class="pre">setRuleGroup()</span></code> 等需要重复:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$userAccounts</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">reset</span><span class="p">();</span>
    <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">(</span><span class="nv">$userAccountRules</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="nv">$user</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// handle validation errors</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id25">
<h3><a class="toc-backref" href="#id73">验证单个值</a><a class="headerlink" href="#id25" title="永久链接至标题"></a></h3>
<p>对一个值针对一个规则进行验证:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">check</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id26">
<h3><a class="toc-backref" href="#id74">将一组验证规则保存到配置文件</a><a class="headerlink" href="#id26" title="永久链接至标题"></a></h3>
<p>验证类的一个很好的特性是它允许你将所有验证规则存储在配置文件中。你可以按“组”组织规则。每次运行验证时,你都可以指定不同的组。</p>
<section id="validation-array">
<span id="id27"></span><h4>如何保存规则<a class="headerlink" href="#validation-array" title="永久链接至标题"></a></h4>
<p>要存储验证规则,只需在 <code class="docutils literal notranslate"><span class="pre">Config\Validation</span></code> 类中创建一个新的公共属性,名称为你的组名。这个元素将持有一个包含你的验证规则的数组。如前所示,验证数组的原型如下:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Config</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Validation</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$signup</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;username&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pass_confirm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|matches[password]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id28">
<h4>如何指定规则组<a class="headerlink" href="#id28" title="永久链接至标题"></a></h4>
<p>当调用 <code class="docutils literal notranslate"><span class="pre">run()</span></code> 方法时,你可以在第一个参数中指定要使用的组:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s1">&#39;signup&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id29">
<h4>如何保存错误消息<a class="headerlink" href="#id29" title="永久链接至标题"></a></h4>
<p>你也可以在此配置文件中存储自定义错误消息,方法是命名与组相同的属性,并追加 <code class="docutils literal notranslate"><span class="pre">_errors</span></code>。这些将在使用该组时自动用于任何错误:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Config</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Validation</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$signup</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;username&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pass_confirm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|matches[password]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="nv">$signup_errors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;You must choose a username.&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;valid_email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please check the Email field. It does not appear to be valid.&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">];</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>或者以数组形式传入所有设置:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Config</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Validation</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$signup</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
            <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;You must choose a Username.&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">],</span>
        <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email&#39;</span><span class="p">,</span>
            <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;valid_email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Please check the Email field. It does not appear to be valid.&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">],</span>
    <span class="p">];</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>参见 <a class="reference internal" href="#validation-custom-errors"><span class="std std-ref">设置自定义错误消息</span></a> 了解数组格式的细节。</p>
</section>
<section id="id30">
<h4>获取和设置规则组<a class="headerlink" href="#id30" title="永久链接至标题"></a></h4>
<p><strong>获取规则组</strong></p>
<p>此方法从验证配置中获取规则组:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">getRuleGroup</span><span class="p">(</span><span class="s1">&#39;signup&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>设置规则组</strong></p>
<p>此方法将验证配置中的规则组设置到验证服务中:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRuleGroup</span><span class="p">(</span><span class="s1">&#39;signup&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="validation-placeholders">
<span id="id31"></span><h3><a class="toc-backref" href="#id75">验证占位符</a><a class="headerlink" href="#validation-placeholders" title="永久链接至标题"></a></h3>
<p>验证类提供了一种简单的方法,基于传入的数据替换规则的一部分。这听起来比较模糊,但在使用 <code class="docutils literal notranslate"><span class="pre">is_unique</span></code> 验证规则时特别有用。占位符 einfach si 由大括弧括起来的传入数据的字段名称(或数组键)。它将被匹配的传入字段的值**值**替换。下面的示例应该可以阐明这一点:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;id&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;is_natural_no_zero&#39;</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email|is_unique[users.email,id,{id}]&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>从 v4.3.5 开始,你必须为占位符字段(<code class="docutils literal notranslate"><span class="pre">id</span></code>)设置验证规则。</p>
</div>
<p>在这组规则中,它说明电子邮件地址在数据库中应该是唯一的,除了具有与占位符的值匹配的 id 的行。假设表单 POST 数据如下:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$_POST</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;id&#39;</span>    <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo@example.com&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>
</div>
<p>然后 <code class="docutils literal notranslate"><span class="pre">{id}</span></code> 占位符会被替换为数字 <strong>4</strong>,得到这条修改后的规则:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;id&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;is_natural_no_zero&#39;</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|valid_email|is_unique[users.email,id,4]&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>所以在验证电子邮件唯一性时,它会忽略数据库中 <code class="docutils literal notranslate"><span class="pre">id=4</span></code> 的行。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>从 v4.3.5 开始,如果占位符(<code class="docutils literal notranslate"><span class="pre">id</span></code>)的值未通过验证,占位符不会被替换。</p>
</div>
<p>只要传入的动态键不与表单数据冲突,这也可以在运行时用于创建更动态的规则。</p>
</section>
</section>
<section id="id32">
<h2><a class="toc-backref" href="#id76">处理错误</a><a class="headerlink" href="#id32" title="永久链接至标题"></a></h2>
<p>验证库提供了几种方法来帮助你设置错误消息、提供自定义错误消息以及检索一个或多个错误以显示。</p>
<p>默认情况下,错误消息来自 <strong>system/Language/en/Validation.php</strong> 中的语言字符串,其中每个规则都有一个条目。</p>
<section id="validation-custom-errors">
<span id="id33"></span><h3><a class="toc-backref" href="#id77">设置自定义错误消息</a><a class="headerlink" href="#validation-custom-errors" title="永久链接至标题"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">setRule()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">setRules()</span></code> 方法的最后一个参数都可以接受自定义消息数组,它将用于每个字段的特定错误。这允许对用户来说是非常愉快的体验,因为错误是针对每个实例定制的。如果没有提供自定义错误消息,将使用默认值。</p>
<p>有两种方式可以提供自定义错误消息。</p>
<p>作为最后一个参数:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|is_unique[users.username]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>   <span class="c1">// Errors</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;All accounts must have usernames provided&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;min_length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Your password is too short. You want to get hacked?&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>或者以标签样式:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;label&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Username&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required|is_unique[users.username]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;All accounts must have {field} provided&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;label&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Password&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;min_length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Your {field} is too short. You want to get hacked?&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>如果你想要包含字段的“人类”名称,或某些规则允许的可选参数(如 max_length),或者被验证的值,你可以分别在消息中添加 <code class="docutils literal notranslate"><span class="pre">{field}</span></code>、<code class="docutils literal notranslate"><span class="pre">{param}</span></code> 和 <code class="docutils literal notranslate"><span class="pre">{value}</span></code> 标签:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;min_length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;提供的 {field} 值 ({value}) 必须至少有 {param} 个字符。&#39;</span>
</pre></div>
</div>
<p>对一个人类名称为 Username、规则为 <code class="docutils literal notranslate"><span class="pre">min_length[6]</span></code>、值为 “Pizza” 的字段,错误会显示:”提供的 Username 值 (Pizza) 必须至少有 6 个字符。”</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>如果使用 <code class="docutils literal notranslate"><span class="pre">getErrors()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">getError()</span></code> 获取错误消息,消息不会被 HTML 转义。如果使用像 <code class="docutils literal notranslate"><span class="pre">({value})</span></code> 这样的用户输入数据来制作错误消息,它可能包含 HTML 标签。如果你在显示之前不转义消息,可能存在 XSS 攻击。</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>当使用标签样式的错误消息时,如果你向 <code class="docutils literal notranslate"><span class="pre">setRules()</span></code> 传递第二个参数,它将被第一个参数的值覆盖。</p>
</div>
</section>
<section id="id34">
<h3><a class="toc-backref" href="#id78">翻译消息和验证标签</a><a class="headerlink" href="#id34" title="永久链接至标题"></a></h3>
<p>要使用语言文件中的翻译字符串,我们可以简单地使用点语法。
假设我们有一个位于这里的翻译文件:<strong>app/Languages/en/Rules.php</strong>。
我们可以简单地使用这个文件中定义的语言行,像这样:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;label&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Rules.username&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required|is_unique[users.username]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Rules.username.required&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;label&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Rules.password&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rules&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;required|min_length[10]&#39;</span><span class="p">,</span>
        <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;min_length&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Rules.password.min_length&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</div>
</section>
<section id="validation-getting-all-errors">
<span id="id35"></span><h3><a class="toc-backref" href="#id79">获取所有错误</a><a class="headerlink" href="#validation-getting-all-errors" title="永久链接至标题"></a></h3>
<p>如果你需要检索所有失败字段的错误消息,可以使用 <code class="docutils literal notranslate"><span class="pre">getErrors()</span></code> 方法:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$errors</span> <span class="o">=</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">getErrors</span><span class="p">();</span>
<span class="cm">/*</span>
<span class="cm"> * Produces:</span>
<span class="cm"> * [</span>
<span class="cm"> *     &#39;field1&#39; =&gt; &#39;error message&#39;,</span>
<span class="cm"> *     &#39;field2&#39; =&gt; &#39;error message&#39;,</span>
<span class="cm"> * ]</span>
<span class="cm"> */</span>
</pre></div>
</div>
<p>如果没有错误,将返回一个空数组。</p>
<p>当使用通配符时,错误将指向特定的字段,用适当的键替换通配符:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// 对于数据</span>
<span class="s1">&#39;contacts&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;friends&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fred Flinstone&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">]</span>
<span class="p">]</span>

<span class="c1">// 规则</span>
<span class="s1">&#39;contacts.*.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span>

<span class="c1">// 错误将是</span>
<span class="s1">&#39;contacts.friends.1.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;contacts.*.name 字段是必需的。&#39;</span>
</pre></div>
</div>
</section>
<section id="id36">
<h3><a class="toc-backref" href="#id80">获取单个错误</a><a class="headerlink" href="#id36" title="永久链接至标题"></a></h3>
<p>你可以使用 <code class="docutils literal notranslate"><span class="pre">getError()</span></code> 方法检索单个字段的错误。唯一的参数是字段名称:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$error</span> <span class="o">=</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">getError</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>如果没有错误,将返回一个空字符串。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>当使用通配符时,所有匹配通配符的找到的错误将组合成一行,以 EOL 字符分隔。</p>
</div>
</section>
<section id="id37">
<h3><a class="toc-backref" href="#id81">检查错误是否存在</a><a class="headerlink" href="#id37" title="永久链接至标题"></a></h3>
<p>你可以使用 <code class="docutils literal notranslate"><span class="pre">hasError()</span></code> 方法检查是否存在错误。唯一的参数是字段名称:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">hasError</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">getError</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>当指定使用通配符的字段时,将检查匹配通配符的所有错误:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="cm">/*</span>
<span class="cm"> * For errors:</span>
<span class="cm"> * [</span>
<span class="cm"> *     &#39;foo.0.bar&#39;   =&gt; &#39;Error&#39;,</span>
<span class="cm"> *     &#39;foo.baz.bar&#39; =&gt; &#39;Error&#39;,</span>
<span class="cm"> * ]</span>
<span class="cm"> */</span>

<span class="c1">// returns true</span>
<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">hasError</span><span class="p">(</span><span class="s1">&#39;foo.*.bar&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="validation-redirect-and-validation-errors">
<span id="id38"></span><h3><a class="toc-backref" href="#id82">重定向和验证错误</a><a class="headerlink" href="#validation-redirect-and-validation-errors" title="永久链接至标题"></a></h3>
<p>PHP 请求之间不共享任何内容。所以在验证失败时重定向,重定向的请求中将没有验证错误,因为验证是在前一个请求中运行的。</p>
<p>在这种情况下,你需要使用表单助手函数 <a class="reference internal" href="../helpers/form_helper.html#validation_errors" title="validation_errors"><code class="xref php php-func docutils literal notranslate"><span class="pre">validation_errors()</span></code></a>、<a class="reference internal" href="../helpers/form_helper.html#validation_list_errors" title="validation_list_errors"><code class="xref php php-func docutils literal notranslate"><span class="pre">validation_list_errors()</span></code></a> 和 <a class="reference internal" href="../helpers/form_helper.html#validation_show_error" title="validation_show_error"><code class="xref php php-func docutils literal notranslate"><span class="pre">validation_show_error()</span></code></a>。
这些函数检查存储在会话中的验证错误。</p>
<p>要在会话中存储验证错误,你需要在 <a class="reference internal" href="../general/common_functions.html#redirect" title="redirect"><code class="xref php php-func docutils literal notranslate"><span class="pre">redirect()</span></code></a> 中使用 <code class="docutils literal notranslate"><span class="pre">withInput()</span></code>:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// In Controller.</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validateData</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$rules</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">withInput</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="validation-customizing-error-display">
<span id="id39"></span><h2><a class="toc-backref" href="#id83">自定义错误显示</a><a class="headerlink" href="#validation-customizing-error-display" title="永久链接至标题"></a></h2>
<p>当你调用 <code class="docutils literal notranslate"><span class="pre">$validation-&gt;listErrors()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">$validation-&gt;showError()</span></code> 时,它会在后台加载一个视图文件,该文件确定如何显示错误。默认情况下,它们显示在一个 class 为 <code class="docutils literal notranslate"><span class="pre">errors</span></code> 的 div 中。你可以轻松地创建新视图并在整个应用中使用它们。</p>
<section id="id40">
<h3><a class="toc-backref" href="#id84">创建视图</a><a class="headerlink" href="#id40" title="永久链接至标题"></a></h3>
<p>第一步是创建自定义视图。可以将这些视图放在 <code class="docutils literal notranslate"><span class="pre">view()</span></code> 方法可以找到的任何位置,这意味着标准的视图目录或任何命名空间视图文件夹都可以工作。例如,你可以在 <strong>app/Views/_errors_list.php</strong> 创建一个新视图:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$errors</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert alert-danger&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$errors</span> <span class="k">as</span> <span class="nv">$error</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">esc</span><span class="p">(</span><span class="nv">$error</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">endforeach</span> <span class="cp">?&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endif</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>在视图内可以使用名为 <code class="docutils literal notranslate"><span class="pre">$errors</span></code> 的数组,它包含错误列表,其中键是有错误的字段名称,值是错误消息,像这样:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$errors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The username field must be unique.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;You must provide a valid email address.&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>
</div>
<p>实际上有两种类型的视图你可以创建。第一种具有所有错误的数组,这就是我们刚才看到的。另一种更简单,只包含一个名为 <code class="docutils literal notranslate"><span class="pre">$error</span></code> 的变量,其中包含错误消息。这在使用 <code class="docutils literal notranslate"><span class="pre">showError()</span></code> 方法时使用,该方法必须指定错误属于的字段:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">span</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;help-block&quot;</span><span class="o">&gt;&lt;?=</span> <span class="nx">esc</span><span class="p">(</span><span class="nv">$error</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="id41">
<h3><a class="toc-backref" href="#id85">配置</a><a class="headerlink" href="#id41" title="永久链接至标题"></a></h3>
<p>一旦你创建了视图,就需要让 Validation 库知道它们。打开 <strong>app/Config/Validation.php</strong>。
在里面,你会找到 <code class="docutils literal notranslate"><span class="pre">$templates</span></code> 属性,你可以在其中列出尽可能多的自定义视图,并提供一个它们可以通过的简短别名。如果我们要添加上面例子中的文件,它会是这样:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Config</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Validation</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$templates</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;list&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;CodeIgniter\Validation\Views\list&#39;</span><span class="p">,</span>
        <span class="s1">&#39;single&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;CodeIgniter\Validation\Views\single&#39;</span><span class="p">,</span>
        <span class="s1">&#39;my_list&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;_errors_list&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id42">
<h3><a class="toc-backref" href="#id86">指定模板</a><a class="headerlink" href="#id42" title="永久链接至标题"></a></h3>
<p>你可以通过在 <code class="docutils literal notranslate"><span class="pre">listErrors()</span></code> 中作为第一个参数传递其别名来指定要使用的模板:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?=</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">listErrors</span><span class="p">(</span><span class="s1">&#39;my_list&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>当显示特定字段的错误时,可以将别名作为 <code class="docutils literal notranslate"><span class="pre">showError()</span></code> 方法的第二个参数传递,紧跟着错误所属字段的名称:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?=</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">showError</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;my_single&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="id43">
<h2><a class="toc-backref" href="#id87">创建自定义规则</a><a class="headerlink" href="#id43" title="永久链接至标题"></a></h2>
<section id="validation-using-rule-classes">
<span id="id44"></span><h3><a class="toc-backref" href="#id88">使用规则类</a><a class="headerlink" href="#validation-using-rule-classes" title="永久链接至标题"></a></h3>
<p>规则存储在简单的命名空间类中。可以将它们存储在自动加载程序可以找到的任何位置。这些文件称为规则集。</p>
<section id="id45">
<h4>添加规则集<a class="headerlink" href="#id45" title="永久链接至标题"></a></h4>
<p>要添加新的规则集,请编辑 <strong>app/Config/Validation.php</strong> 并将新文件添加到 <code class="docutils literal notranslate"><span class="pre">$ruleSets</span></code> 数组中:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Config</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">CodeIgniter\Validation\CreditCardRules</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">CodeIgniter\Validation\FileRules</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">CodeIgniter\Validation\FormatRules</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">CodeIgniter\Validation\Rules</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Validation</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">array</span> <span class="nv">$ruleSets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">Rules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">FormatRules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">FileRules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="nx">CreditCardRules</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>你可以像上面显示的那样添加完整限定的类名的简单字符串,或使用 <code class="docutils literal notranslate"><span class="pre">::class</span></code> 后缀。这里的主要好处是在更高级的 IDE 中提供了一些额外的导航功能。</p>
</section>
<section id="id46">
<h4>创建规则类<a class="headerlink" href="#id46" title="永久链接至标题"></a></h4>
<p>在文件本身中,每个方法都是一条规则,必须接受要验证的值作为第一个参数,并返回一个布尔真或假值,表示如果通过测试则为真,否则为假:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">MyRules</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">even</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>默认情况下,系统将在 <strong>system/Language/en/Validation.php</strong> 中查找错误消息中使用的语言字符串。在自定义规则中,你可以通过第二个参数引用 <code class="docutils literal notranslate"><span class="pre">&amp;$error</span></code> 来提供错误消息:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">MyRules</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">even</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="o">?</span><span class="nx">string</span> <span class="o">&amp;</span><span class="nv">$error</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$error</span> <span class="o">=</span> <span class="nx">lang</span><span class="p">(</span><span class="s1">&#39;myerrors.evenError&#39;</span><span class="p">);</span>

            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id47">
<h4>使用自定义规则<a class="headerlink" href="#id47" title="永久链接至标题"></a></h4>
<p>你的新自定义规则现在可以像任何其他规则一样使用了:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|even&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>
</div>
</section>
<section id="id48">
<h4>允许参数<a class="headerlink" href="#id48" title="永久链接至标题"></a></h4>
<p>如果你的方法需要使用参数,函数需要至少三个参数:</p>
<ol class="arabic simple">
<li><p>要验证的值(<code class="docutils literal notranslate"><span class="pre">$value</span></code>)</p></li>
<li><p>参数字符串(<code class="docutils literal notranslate"><span class="pre">$params</span></code>)</p></li>
<li><p>提交表单的所有数据的数组(<code class="docutils literal notranslate"><span class="pre">$data</span></code>)</p></li>
<li><p>(可选)自定义错误字符串(<code class="docutils literal notranslate"><span class="pre">&amp;$error</span></code>),如上所述</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p><code class="docutils literal notranslate"><span class="pre">$data</span></code> 中的值是未验证的(或可能无效的)。使用未验证的输入数据是漏洞的源头。你必须在自定义规则内对 <code class="docutils literal notranslate"><span class="pre">$data</span></code> 中的数据执行必要的验证,然后再使用它。</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">$data</span></code> 数组对需要检查提交的其他字段的值来确定结果的规则特别有用,比如 <code class="docutils literal notranslate"><span class="pre">required_with</span></code> :</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">MyRules</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">required_with</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$params</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$data</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="nv">$params</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>

        <span class="c1">// If the field is present we can safely assume that</span>
        <span class="c1">// the field is here, no matter whether the corresponding</span>
        <span class="c1">// search field is present or not.</span>
        <span class="nv">$present</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">required</span><span class="p">(</span><span class="nv">$value</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$present</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Still here? Then we fail this test if</span>
        <span class="c1">// any of the fields are present in $data</span>
        <span class="c1">// as $fields is the lis</span>
        <span class="nv">$requiredFields</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$params</span> <span class="k">as</span> <span class="nv">$field</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$field</span><span class="p">,</span> <span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$requiredFields</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$field</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Remove any keys with empty values since, that means they</span>
        <span class="c1">// weren&#39;t truly there, as far as this is concerned.</span>
        <span class="nv">$requiredFields</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$requiredFields</span><span class="p">,</span> <span class="k">static</span> <span class="nx">fn</span> <span class="p">(</span><span class="nv">$item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="nv">$item</span><span class="p">]));</span>

        <span class="k">return</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$requiredFields</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="validation-using-closure-rule">
<span id="id49"></span><h3><a class="toc-backref" href="#id89">使用闭包规则</a><a class="headerlink" href="#validation-using-closure-rule" title="永久链接至标题"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">4.3.0 新版功能.</span></p>
</div>
<p>如果你的应用中只需要自定义规则的功能一次,你可以使用闭包 instead of 规则类。</p>
<p>你需要为验证规则使用数组:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;required&#39;</span><span class="p">,</span>
            <span class="k">static</span> <span class="nx">fn</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="c1">// Errors</span>
        <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="c1">// Specify the array key for the closure rule.</span>
            <span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;The value is not even.&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// handle validation errors</span>
<span class="p">}</span>
</pre></div>
</div>
<p>你必须为闭包规则设置错误消息。
设置错误消息时,请为闭包规则设置数组键。
在上面的代码中,``required`` 规则的键为 <code class="docutils literal notranslate"><span class="pre">0</span></code>,闭包的键为 <code class="docutils literal notranslate"><span class="pre">1</span></code>。</p>
<p>或者可以使用以下参数:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$error</span><span class="p">,</span> <span class="nv">$field</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$error</span> <span class="o">=</span> <span class="s1">&#39;The value is not even.&#39;</span><span class="p">;</span>

            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">},</span>
    <span class="p">],</span>
<span class="p">]);</span>
</pre></div>
</div>
</section>
</section>
<section id="id50">
<h2><a class="toc-backref" href="#id90">可用规则</a><a class="headerlink" href="#id50" title="永久链接至标题"></a></h2>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>规则是一个字符串;参数之间绝不能有**空格**,特别是 <code class="docutils literal notranslate"><span class="pre">is_unique</span></code> 规则。
<code class="docutils literal notranslate"><span class="pre">ignore_value</span></code> 前后不能有空格。</p>
</div>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// is_unique[table.field,ignore_field,ignore_value]</span>

<span class="nv">$validation</span><span class="o">-&gt;</span><span class="na">setRules</span><span class="p">([</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;is_unique[supplier.name,uuid, </span><span class="si">{</span><span class="nv">$uuid</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span>  <span class="c1">// is not ok</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;is_unique[supplier.name,uuid,</span><span class="si">{</span><span class="nv">$uuid</span><span class="si">}</span><span class="s2"> ]&quot;</span><span class="p">,</span>  <span class="c1">// is not ok</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;is_unique[supplier.name,uuid,</span><span class="si">{</span><span class="nv">$uuid</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span>   <span class="c1">// is ok</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;is_unique[supplier.name,uuid,{uuid}]&#39;</span><span class="p">,</span>    <span class="c1">// is ok - see &quot;Validation Placeholders&quot;</span>
<span class="p">]);</span>
<span class="c1">// Warning: If `$uuid` is a user input, be sure to validate the format of the value before using it.</span>
<span class="c1">// Otherwise, it is vulnerable.</span>
</pre></div>
</div>
<section id="id51">
<h3><a class="toc-backref" href="#id91">常规规则</a><a class="headerlink" href="#id51" title="永久链接至标题"></a></h3>
<p>以下是可用的所有原生规则列表:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 7%" />
<col style="width: 44%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>规则</p></th>
<th class="head"><p>参数</p></th>
<th class="head"><p>描述</p></th>
<th class="head"><p>示例</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>alpha</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除字母字符之外的任何内容,则失败。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>alpha_space</p></td>
<td><p>无</p></td>
<td><p>如果字段包含空格和字母字符之外的任何内容,则失败。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>alpha_dash</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除字母数字字符、下划线或破折号之外的任何内容,则失败。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>alpha_numeric</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除字母数字字符之外的任何内容,则失败。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>alpha_numeric_space</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除字母数字和空格字符之外的任何内容,则失败。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>alpha_numeric_punct</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除字母数字、空格和这组有限标点之外的任何内容,
则失败:<code class="docutils literal notranslate"><span class="pre">~</span></code> (波浪号)、
<code class="docutils literal notranslate"><span class="pre">!</span></code> (感叹号)、<code class="docutils literal notranslate"><span class="pre">#</span></code> (数字)、
<code class="docutils literal notranslate"><span class="pre">$</span></code> (美元符号), <code class="docutils literal notranslate"><span class="pre">%</span> <span class="pre">(百分号),</span> <span class="pre">&amp;</span> <span class="pre">(和号),</span>
<span class="pre">``*</span></code> (星号), <code class="docutils literal notranslate"><span class="pre">-</span></code> (破折号),
<code class="docutils literal notranslate"><span class="pre">_</span></code> (下划线), <code class="docutils literal notranslate"><span class="pre">+</span></code> (加号),
<code class="docutils literal notranslate"><span class="pre">=</span></code> (等号), <code class="docutils literal notranslate"><span class="pre">|</span></code> (竖线),
<code class="docutils literal notranslate"><span class="pre">:</span></code> (冒号), <code class="docutils literal notranslate"><span class="pre">.</span></code> (句点)。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>decimal</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除十进制数字外的任何内容,则失败。
也接受数字前的 <code class="docutils literal notranslate"><span class="pre">+</span></code> 或 <code class="docutils literal notranslate"><span class="pre">-</span></code> 号。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>differs</p></td>
<td><p>是</p></td>
<td><p>如果字段与参数中字段的值不不同,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">differs[field_name]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>exact_length</p></td>
<td><p>是</p></td>
<td><p>如果字段的长度不完全等于参数值,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exact_length[5]</span></code> 或 <code class="docutils literal notranslate"><span class="pre">exact_length[5,8,12]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>greater_than</p></td>
<td><p>是</p></td>
<td><p>如果字段小于或等于参数值,或不是数字,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">greater_than[8]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>greater_than_equal_to</p></td>
<td><p>是</p></td>
<td><p>如果字段小于参数值,或不是数字,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">greater_than_equal_to[5]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>hex</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除十六进制字符之外的任何内容,则失败。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>if_exist</p></td>
<td><p>无</p></td>
<td><p>如果存在此规则,验证将仅在要验证的数据中存在字段键时检查该字段。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>in_list</p></td>
<td><p>是</p></td>
<td><p>如果字段不在预定列表中,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">in_list[red,blue,green]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>integer</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除整数之外的任何内容,则失败。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>is_natural</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除自然数之外的任何内容,则失败:0, 1, 2, 3等。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>is_natural_no_zero</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除自然数和零之外的任何内容,则失败:1, 2, 3等。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>is_not_unique</p></td>
<td><p>是</p></td>
<td><p>检查数据库中是否存在给定的值。
可以通过字段/值过滤器忽略记录(当前只接受一个过滤器)。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>is_unique</p></td>
<td><p>是</p></td>
<td><p>检查字段值是否存在于数据库中。可以可选地设置要忽略的列和值,
在更新记录时很有用,忽略它本身。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>less_than</p></td>
<td><p>是</p></td>
<td><p>如果字段大于或等于参数值,或不是数字,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">less_than[8]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>less_than_equal_to</p></td>
<td><p>是</p></td>
<td><p>如果字段大于参数值,或不是数字,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">less_than_equal_to[8]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>matches</p></td>
<td><p>是</p></td>
<td><p>值必须匹配参数中字段的值。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">matches[field]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>max_length</p></td>
<td><p>是</p></td>
<td><p>如果字段长于参数值,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">max_length[8]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>min_length</p></td>
<td><p>是</p></td>
<td><p>如果字段短于参数值,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">min_length[3]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>not_in_list</p></td>
<td><p>是</p></td>
<td><p>如果字段在预定列表中,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">not_in_list[red,blue,green]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>numeric</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除数字外的任何内容,则失败。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>regex_match</p></td>
<td><p>是</p></td>
<td><p>如果字段不匹配正则表达式,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">regex_match[/regex/]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>permit_empty</p></td>
<td><p>无</p></td>
<td><p>允许字段接收空数组、空字符串、null 或 false。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>required</p></td>
<td><p>无</p></td>
<td><p>如果字段为空数组、空字符串、null 或 false,则失败。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>required_with</p></td>
<td><p>是</p></td>
<td><p>当数据中任何其他字段不为空时,该字段是必需的。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">required_with[field1,field2]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>required_without</p></td>
<td><p>是</p></td>
<td><p>当数据中任何其他字段为空时,该字段是必需的。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">required_without[field1,field2]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>string</p></td>
<td><p>无</p></td>
<td><p>alpha* 规则的通用替代,确认元素是一个字符串。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>timezone</p></td>
<td><p>无</p></td>
<td><p>如果字段不匹配 <a class="reference external" href="https://www.php.net/manual/en/function.timezone-identifiers-list.php">timezone_identifiers_list()</a> 中的时区,则失败。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>valid_base64</p></td>
<td><p>无</p></td>
<td><p>如果字段包含除有效的 Base64 字符之外的任何内容,则失败。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>valid_json</p></td>
<td><p>无</p></td>
<td><p>如果字段不包含有效的 JSON 字符串,则失败。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>valid_email</p></td>
<td><p>无</p></td>
<td><p>如果字段不包含有效的电子邮件地址,则失败。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>valid_emails</p></td>
<td><p>无</p></td>
<td><p>如果任何以逗号分隔提供的值不是有效的电子邮件,则失败。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>valid_ip</p></td>
<td><p>是</p></td>
<td><p>如果提供的 IP 无效,则失败。
可选参数为 <code class="docutils literal notranslate"><span class="pre">ipv4</span></code> 或 <code class="docutils literal notranslate"><span class="pre">valid_ip[ipv6]</span></code>
<code class="docutils literal notranslate"><span class="pre">ipv6</span></code> 以指定 IP 格式。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>valid_url</p></td>
<td><p>无</p></td>
<td><p>如果字段不包含(宽松的)URL,则失败。
包括可能是主机名的简单字符串,
如“codeigniter”。<strong>通常,应使用 ``valid_url_strict``。</strong></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>valid_url_strict</p></td>
<td><p>是</p></td>
<td><p>如果字段不包含有效的 URL,则失败。你可以可选地指定
有效 schema 的列表。如果未指定,``http,https``
有效。此规则使用 PHP 的 <code class="docutils literal notranslate"><span class="pre">FILTER_VALIDATE_URL</span></code>。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">valid_url_strict[https]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>valid_date</p></td>
<td><p>是</p></td>
<td><p>如果字段不包含有效日期,则失败。任何 <a class="reference external" href="https://www.php.net/manual/en/function.strtotime.php">strtotime()</a>
接受的字符串如果不指定可选参数以匹配日期格式都是
有效的。<strong>所以通常有必要指定参数。</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">valid_date[d/m/Y]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>valid_cc_number</p></td>
<td><p>是</p></td>
<td><p>验证信用卡号是否与指定提供程序使用的格式匹配。
当前支持的提供程序有:
美国运通 (<code class="docutils literal notranslate"><span class="pre">amex</span></code>)、
中国银联 (<code class="docutils literal notranslate"><span class="pre">unionpay</span></code>)、
Diners Club CarteBlance (<code class="docutils literal notranslate"><span class="pre">carteblanche</span></code>)、
Diners Club (<code class="docutils literal notranslate"><span class="pre">dinersclub</span></code>)、
Discover Card (<code class="docutils literal notranslate"><span class="pre">discover</span></code>)、
Interpayment (<code class="docutils literal notranslate"><span class="pre">interpayment</span></code>)、
JCB (<code class="docutils literal notranslate"><span class="pre">jcb</span></code>)、 Maestro (<code class="docutils literal notranslate"><span class="pre">maestro</span></code>)、
丹麦银行的 Dankort (<code class="docutils literal notranslate"><span class="pre">dankort</span></code>)、 NSPK MIR (<code class="docutils literal notranslate"><span class="pre">mir</span></code>)、
Troy (<code class="docutils literal notranslate"><span class="pre">troy</span></code>)、 MasterCard (<code class="docutils literal notranslate"><span class="pre">mastercard</span></code>)、
Visa (<code class="docutils literal notranslate"><span class="pre">visa</span></code>)、 UATP (<code class="docutils literal notranslate"><span class="pre">uatp</span></code>)、
Verve (<code class="docutils literal notranslate"><span class="pre">verve</span></code>)、
CIBC 便利卡 (<code class="docutils literal notranslate"><span class="pre">cibc</span></code>)、
罗伊银行客户卡 (<code class="docutils literal notranslate"><span class="pre">rbc</span></code>)、
TD Canada Trust 访问卡 (<code class="docutils literal notranslate"><span class="pre">tdtrust</span></code>)、
Scotiabank 圣哥伦布卡 (<code class="docutils literal notranslate"><span class="pre">scotia</span></code>)、
BMO 自动柜员机卡 (<code class="docutils literal notranslate"><span class="pre">bmoabm</span></code>)、
HSBC 加拿大卡 (<code class="docutils literal notranslate"><span class="pre">hsbc</span></code>)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">valid_cc_number[amex]</span></code></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>你也可以使用任何返回布尔值且至少接受一个要验证的数据的参数的原生 PHP 函数。
验证库**从不改变**要验证的数据。</p>
</div>
</section>
<section id="rules-for-file-uploads">
<span id="id52"></span><h3><a class="toc-backref" href="#id92">文件上传规则</a><a class="headerlink" href="#rules-for-file-uploads" title="永久链接至标题"></a></h3>
<p>这些验证规则使你可以执行验证上传的文件以满足业务需求的基本检查。
由于文件上传 HTML 字段的值不存在,而是存储在 <code class="docutils literal notranslate"><span class="pre">$_FILES</span></code> 全局变量中,所以需要两次使用输入字段的名称。一次是像其他规则一样指定字段名称,另一次是作为所有与文件上传相关规则的第一个参数:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// 在 HTML 中</span>
<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;file&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;avatar&quot;</span><span class="o">&gt;</span>

<span class="c1">// 在控制器中</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
    <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;uploaded[avatar]|max_size[avatar,1024]&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 7%" />
<col style="width: 42%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>规则</p></th>
<th class="head"><p>参数</p></th>
<th class="head"><p>描述</p></th>
<th class="head"><p>示例</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>uploaded</p></td>
<td><p>是</p></td>
<td><p>如果参数的名称与任何上传的文件的名称不匹配,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uploaded[field_name]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>max_size</p></td>
<td><p>是</p></td>
<td><p>如果名为参数的上传文件大于第二个参数的千字节(kb),则失败。
或者如果文件大于 php.ini 配置文件中声明的
最大大小 - <code class="docutils literal notranslate"><span class="pre">upload_max_filesize</span></code> 指令。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>max_dims</p></td>
<td><p>是</p></td>
<td><p>如果上传图像的最大宽度和高度超过值,则失败。
第一个参数是字段名称。
第二个是宽度,第三个是高度。如果无法确定文件是图像,也会失败。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>mime_in</p></td>
<td><p>是</p></td>
<td><p>如果文件的 mime 类型不在参数中列出,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mime_in[field_name,image/png,image/jpeg]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>ext_in</p></td>
<td><p>是</p></td>
<td><p>如果文件扩展名不在参数中列出,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ext_in[field_name,png,jpg,gif]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>is_image</p></td>
<td><p>是</p></td>
<td><p>如果根据 mime 类型无法确定文件是图像,则失败。</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">is_image[field_name]</span></code></p></td>
</tr>
</tbody>
</table>
<p>文件验证规则适用于单个和多个文件上传。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="user_agent.html" class="btn btn-neutral float-left" title="用户代理类" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../helpers/index.html" class="btn btn-neutral float-right" title="辅助函数" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2019-2023 CodeIgniter 基金会.
      <span class="lastupdated">最后更新于 2023-07-22.
      </span></p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
  
<jinja2.runtime.BlockReference object at 0x7f9844b66a50>

<div style="margin-top: 16px;">
  <p>由 <a href="https://codeigniter.org.cn">CodeIgniter 中国开发者社区</a>翻译并制作</p>
  <p style="margin-bottom: 0;">
    <a href="https://github.com/CodeIgniter-Chinese/codeigniter4-user-guide" target="_blank">Github 简体中文翻译</a>
    ·
    <a href="https://codeigniter-chinese.github.io/codeigniter4-user-guide/codeigniter_user_guide.zip">离线版压缩包下载</a>
    ·
    <a href="https://codeigniter-chinese.github.io/codeigniter4-user-guide/CodeIgniter.pdf">PDF 版下载</a>
  </p>
</div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>