

<!DOCTYPE html>
<html class="writer-html4" lang="zh-CN" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CURLRequest类 &mdash; CodeIgniter 4.0.0 中文手册|用户手册|用户指南|中文文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/citheme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/js/citheme.js"></script>
        <script type="text/javascript" src="../_static/js/carbon.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Email Class" href="email.html" />
    <link rel="prev" title="缓存驱动器" href="caching.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #DD4814" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/ci-logo-text.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">欢迎使用 CodeIgniter4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/index.html">欢迎使用 CodeIgniter4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/requirements.html">服务器安装要求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/credits.html">发展历程与贡献者</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/psr.html">PSR 规范</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">安装</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation/installing_manual.html">手动安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/installing_composer.html">通过Composer安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/running.html">运行你的应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/upgrading.html">从老版本升级</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/troubleshooting.html">故障排除</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/repositories.html">CodeIgniter 仓库</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">构建你的第一个应用</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/static_pages.html">加载静态页</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/news_section.html">新闻展示功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/create_news_items.html">创建新闻项目</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/conclusion.html">结束语</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">CodeIgniter4 概览</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/structure.html">应用结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/mvc.html">模型，视图和控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/autoloader.html">自动加载文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/services.html">服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/http.html">处理 HTTP 请求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/security.html">安全指南</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general/index.html">常规主题</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../general/configuration.html">利用配置文件开始工作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/urls.html">CodeIgniter URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/helpers.html">辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/common_functions.html">公共函数和全局常量</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/logging.html">记录日志信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/errors.html">错误处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/caching.html">网页缓存</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/ajax.html">AJAX请求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/modules.html">代码模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/managing_apps.html">管理多个应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/environments.html">处理多环境</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../incoming/index.html">控制器和路由</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../incoming/controllers.html">控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/routing.html">URI 路由</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/filters.html">控制器过滤器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/message.html">HTTP 消息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/request.html">Request 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/incomingrequest.html">IncomingRequest 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/content_negotiation.html">内容协商</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/methodspoofing.html">HTTP类型伪装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incoming/restful.html">处理RESTful请求资源</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../outgoing/index.html">构建响应</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/views.html">视图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_cells.html">子视图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_renderer.html">视图渲染器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_layouts.html">视图布局</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_parser.html">View Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/table.html">HTML Table Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/response.html">HTTP 响应</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/api_responses.html">API 响应特性</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/localization.html">本地化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/alternative_php.html">在视图文件中使用PHP替代语法</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../database/index.html">数据库参考</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/examples.html">数据库快速入门：示例代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/configuration.html">数据库配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/connecting.html">连接数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/queries.html">执行查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/results.html">生成查询结果</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/helpers.html">查询辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/query_builder.html">查询构造器类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/transactions.html">事务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/metadata.html">获取元数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/call_function.html">自定义函数调用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/events.html">数据库事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/utilities.html">数据库工具</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/index.html">数据建模</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/model.html">使用 CodeIgniter 的模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/entities.html">使用实体类</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dbmgmt/index.html">管理数据库</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/forge.html">使用 Database Forge 维护数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/migration.html">数据库迁移</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/seeds.html">数据库填充</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">类库参考</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="caching.html">缓存驱动器</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">CURLRequest类</a></li>
<li class="toctree-l2"><a class="reference internal" href="email.html">Email Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="encryption.html">加密服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="files.html">使用文件类</a></li>
<li class="toctree-l2"><a class="reference internal" href="honeypot.html">Honeypot Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="images.html">图像处理类</a></li>
<li class="toctree-l2"><a class="reference internal" href="pagination.html">分页类</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">安全类</a></li>
<li class="toctree-l2"><a class="reference internal" href="sessions.html">Session 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="throttler.html">限流类</a></li>
<li class="toctree-l2"><a class="reference internal" href="time.html">日期与时间类</a></li>
<li class="toctree-l2"><a class="reference internal" href="typography.html">Typography 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="uploaded_files.html">使用文件上传类</a></li>
<li class="toctree-l2"><a class="reference internal" href="uri.html">使用 URI 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_agent.html">User Agent Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="validation.html">Validation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../helpers/index.html">辅助函数</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../helpers/array_helper.html">Array Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/cookie_helper.html">Cookie 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/date_helper.html">Date Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/filesystem_helper.html">文件系统辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/form_helper.html">表单辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/html_helper.html">HTML 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/inflector_helper.html">偏转辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/number_helper.html">数字辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/security_helper.html">安全辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/text_helper.html">文本辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/url_helper.html">URL 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/xml_helper.html">XML辅助函数</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">测试</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing/overview.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/database.html">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/controllers.html">Controller Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/feature.html">HTTP Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/benchmark.html">基准测试类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/debugging.html">调试你的应用</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">命令行用法</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli.html">通过CLI方式运行</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_commands.html">自定义 CLI 命令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_library.html">CLI Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_request.html">CLIRequest Class</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">扩展 CodeIgniter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../extending/core_classes.html">创建核心系统类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/common.html">替换通用函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/events.html">事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/basecontroller.html">扩展 Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/authentication.html">鉴权</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/contributing.html">贡献给 CodeIgniter</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CodeIgniter</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">类库参考</a> &raquo;</li>
        
      <li>CURLRequest类</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="curlrequest">
<h1>CURLRequest类<a class="headerlink" href="#curlrequest" title="永久链接至标题">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">CURLRequest</span></code> 类是一个轻量级的基于 CURL 的 HTTP 客户端，用于同其他网站和服务器进行沟通。该类可用于获取谷歌搜索的内容，抓取一个网站页面或一个图片，
或者是用来同 API 进行信息传递等诸多功能。</p>
<div class="contents local topic" id="id1">
<ul class="simple">
<li><a class="reference internal" href="#id2" id="id7">加载该类库</a></li>
<li><a class="reference internal" href="#id3" id="id8">使用该类库</a><ul>
<li><a class="reference internal" href="#id4" id="id9">发送请求</a></li>
<li><a class="reference internal" href="#id5" id="id10">使用响应</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6" id="id11">请求选项</a><ul>
<li><a class="reference internal" href="#allow-redirects" id="id12">allow_redirects （运行重定向）</a></li>
<li><a class="reference internal" href="#auth" id="id13">auth （认证）</a></li>
<li><a class="reference internal" href="#body" id="id14">body （请求体）</a></li>
<li><a class="reference internal" href="#cert" id="id15">cert (证书）</a></li>
<li><a class="reference internal" href="#connect-timeout" id="id16">connect_timeout （连接超时）</a></li>
<li><a class="reference internal" href="#cookie" id="id17">cookie</a></li>
<li><a class="reference internal" href="#debug-bug" id="id18">debug （调试bug）</a></li>
<li><a class="reference internal" href="#delay" id="id19">delay （延时）</a></li>
<li><a class="reference internal" href="#form-params" id="id20">form_params （表单参数）</a></li>
<li><a class="reference internal" href="#headers" id="id21">headers （请求头）</a></li>
<li><a class="reference internal" href="#http-errors-http" id="id22">http_errors （http错误）</a></li>
<li><a class="reference internal" href="#json" id="id23">json</a></li>
<li><a class="reference internal" href="#multipart" id="id24">multipart</a></li>
<li><a class="reference internal" href="#query" id="id25">query （查询语句）</a></li>
<li><a class="reference internal" href="#timeout" id="id26">timeout（超时）</a></li>
<li><a class="reference internal" href="#verify" id="id27">verify（鉴权）</a></li>
<li><a class="reference internal" href="#version" id="id28">version（版本）</a></li>
</ul>
</li>
</ul>
</div>
<p>该类模仿了 <a class="reference external" href="http://docs.guzzlephp.org/en/latest/">Guzzle HTTP Client</a> 库，因为该库被广泛应用于多方面。
我们尽可能地与 Guzzle 保持语法一致，不过如果你需要一些额外的功能的话（比如该类并未提供的功能之类的），可能需要稍微更改一下语法来使用 Guzzle 库。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">该类需要安装你的 PHP 版本的 <a class="reference external" href="https://www.php.net/manual/en/book.curl.php">cURL 库</a> 。该库是一个在大多数情况下都广泛被使用的库，但不是所有服务器都安装了它。
因此请检查你的服务器上安装了该库以解决依赖问题。</p>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id7">加载该类库</a><a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>该类库可以通过手动加载或者通过 <a class="reference internal" href="../concepts/services.html"><span class="doc">服务类</span></a> 加载。</p>
<p>通过服务类来加载 <code class="docutils literal notranslate"><span class="pre">curlrequest()</span></code> 方法:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span> <span class="o">=</span> <span class="nx">\Config\Services</span><span class="o">::</span><span class="na">curlrequest</span><span class="p">();</span>
</pre></div>
</div>
<p>你可以将一个默认选项数组作为参数传递给该方法作为第一个参数，用于修改 cURL 处理请求的方式。选项描述如下:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;base_uri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://example.com/api/v1/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;timeout&#39;</span>  <span class="o">=&gt;</span> <span class="mi">3</span>
<span class="p">];</span>
<span class="nv">$client</span> <span class="o">=</span> <span class="nx">\Config\Services</span><span class="o">::</span><span class="na">curlrequest</span><span class="p">(</span><span class="nv">$options</span><span class="p">);</span>
</pre></div>
</div>
<p>当手动创建类实例时，你需要传递一些依赖。第一个参数是 <code class="docutils literal notranslate"><span class="pre">Config\App</span></code> 类的实例。第二个参数是一个 URI 实例。第三个参数是一个 Response 类的对象。
第四个参数是一个可选的 <code class="docutils literal notranslate"><span class="pre">$options</span></code> 数组:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\CodeIgniter\HTTP\CURLRequest</span><span class="p">(</span>
        <span class="k">new</span> <span class="nx">\Config\App</span><span class="p">(),</span>
        <span class="k">new</span> <span class="nx">\CodeIgniter\HTTP\URI</span><span class="p">(),</span>
        <span class="k">new</span> <span class="nx">\CodeIgniter\HTTP\Response</span><span class="p">(</span><span class="k">new</span> <span class="nx">\Config\App</span><span class="p">()),</span>
        <span class="nv">$options</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id8">使用该类库</a><a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>处理 CURL 请求基本上只是创建一个 Request 请求并获取 <a class="reference internal" href="../outgoing/response.html"><span class="doc">Response 对象</span></a> 的过程。这一过程就是用来处理数据交换的。
这一过程后，你可以对获得的信息进行完全自定义的处理.</p>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id9">发送请求</a><a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>大多数交流会话是通过 <code class="docutils literal notranslate"><span class="pre">request()</span></code> 方法进行的，该方法触发请求并返回一个 Response 实例。该方法将 HTTP 动词， URL 信息和选项数组作为请求参数。:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span> <span class="o">=</span> <span class="nx">\Config\Services</span><span class="o">::</span><span class="na">curlrequest</span><span class="p">();</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://api.github.com/user&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;auth&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>由于该响应是 <code class="docutils literal notranslate"><span class="pre">CodeIgniter\HTTP\Response</span></code> 类的一个实例对象，故而可以通过调用该类的对应方法:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">echo</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">();</span>
<span class="k">echo</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>
<span class="k">echo</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">);</span>
<span class="nv">$language</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">negotiateLanguage</span><span class="p">([</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="s1">&#39;fr&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>尽管 <code class="docutils literal notranslate"><span class="pre">request()</span></code> 方法非常灵活，你也可以使用以下的简称方法。
这些方法将 URL 作为第一个参数并将选项数组作为第二个参数:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">);</span>
<span class="o">*</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">);</span>
<span class="o">*</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">head</span><span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">);</span>
<span class="o">*</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">options</span><span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">);</span>
<span class="o">*</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">patch</span><span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">);</span>
<span class="o">*</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">);</span>
<span class="o">*</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="base-uri-uri">
<h4>base_uri （基础 URI ）<a class="headerlink" href="#base-uri-uri" title="永久链接至标题">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">base_uri</span></code> 可以在该类实例化时作为一个选项进行设置。
该参数使得你可以设置一个基础 URI ，并在该实例对象进行请求时使用相对 URL 路径。这一操作在和 API 通信时特别管用:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span> <span class="o">=</span> <span class="nx">\Config\Services</span><span class="o">::</span><span class="na">curlrequest</span><span class="p">([</span>
        <span class="s1">&#39;base_uri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://example.com/api/v1/&#39;</span>
<span class="p">]);</span>

<span class="c1">// GET http:example.com/api/v1/photos</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">);</span>

<span class="c1">// GET http:example.com/api/v1/photos/13</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;photos/13&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>当 <code class="docutils literal notranslate"><span class="pre">request()</span></code> 方法或者其他简称方法接受相对 URI 作为参数时，就会将 base_uri 和该相对 URI 根据 <a class="reference external" href="https://tools.ietf.org/html/rfc3986#section-5.2">RFC 2986, section 2</a> 进行组合
以下是一些组合的例子</p>
<blockquote>
<div></div></blockquote>
</div>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id10">使用响应</a><a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p>每个 <code class="docutils literal notranslate"><span class="pre">request()</span></code> 函数调用都会返回一个包含有许多有用信息和方法的 Response 实例对象。最通用的方法使得你可以定制化地处理响应对象本身。</p>
<p>你可以获取响应的状态码以及状态原因:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$code</span>   <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">();</span>    <span class="c1">// 200</span>
<span class="nv">$reason</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getReason</span><span class="p">();</span>      <span class="c1">// OK</span>
</pre></div>
</div>
<p>你可以获取响应头:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// 获取一个响应头的内容</span>
<span class="k">echo</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeaderLine</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">);</span>

<span class="c1">// 获取所有响应头</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeaders</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$name</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$name</span> <span class="o">.</span><span class="s1">&#39;: &#39;</span><span class="o">.</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeaderLine</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>响应体可以通过 <code class="docutils literal notranslate"><span class="pre">getBody()</span></code> 方法来获取:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$body</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>
</pre></div>
</div>
<p>响应体是远端服务器提供的原生响应内容。如果内容类型需要格式化的话，你需要保证在代码中这样处理:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeader</span><span class="p">(</span><span class="s1">&#39;content-type&#39;</span><span class="p">),</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span>
<span class="p">{</span>
        <span class="nv">$body</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id11">请求选项</a><a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>本节描述了在构造函数， <code class="docutils literal notranslate"><span class="pre">request()</span></code> 方法以及所有简称方法中可以传递的所有可用选项。</p>
<div class="section" id="allow-redirects">
<h3><a class="toc-backref" href="#id12">allow_redirects （运行重定向）</a><a class="headerlink" href="#allow-redirects" title="永久链接至标题">¶</a></h3>
<p>默认情况下， CURL 会遵循远端服务器返回的所有的 “Location:” 响应头规则。 <code class="docutils literal notranslate"><span class="pre">allow_redirects</span></code> 选项使得你可以修改这一执行过程。</p>
<p>如果该值被设为 <code class="docutils literal notranslate"><span class="pre">false</span></code> ，就不会执行任何的重定向规则。</p>
<blockquote>
<div>$client-&gt;request(‘GET’, ‘<a class="reference external" href="http://example.com">http://example.com</a>’, [‘allow_redirects’ =&gt; false]);</div></blockquote>
<p>设为 <code class="docutils literal notranslate"><span class="pre">true</span></code> 时就会执行请求的默认设置:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;allow_redirects&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>

<span class="c1">// 设置以下默认选项:</span>
<span class="s1">&#39;max&#39;</span>       <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="c1">// 终止前最多的重定向次数</span>
<span class="s1">&#39;strict&#39;</span>    <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="c1">// 在重定向过程中确保发送的 POST 请求始终保持为 POST （译注：某些服务器会在重定向时修改请求方法，例如 304 重定向时修改请求方式为 GET)</span>
<span class="s1">&#39;protocols&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">]</span> <span class="c1">// 限制重定向使用一个或多个协议</span>
</pre></div>
</div>
<p>你可以为 <code class="docutils literal notranslate"><span class="pre">allow_redirects</span></code> 选项传递一个选项数组用于重定向时使用新的设置，而不是默认设置:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;allow_redirects&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;max&#39;</span>       <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s1">&#39;protocols&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;https&#39;</span><span class="p">]</span> <span class="c1">// Force HTTPS domains only.</span>
<span class="p">]]);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">当 PHP 在 safe_mode 或者 open_basedir 选项开启时，不会进行重定向。</p>
</div>
</div>
<div class="section" id="auth">
<h3><a class="toc-backref" href="#id13">auth （认证）</a><a class="headerlink" href="#auth" title="永久链接至标题">¶</a></h3>
<p>使得你可以为 <a class="reference external" href="https://www.ietf.org/rfc/rfc2069.txt">HTTP Basic</a> 和 <a class="reference external" href="https://www.ietf.org/rfc/rfc2069.txt">Digest</a> 和认证过程提供细节信息。
你的脚本文件需要执行额外操作以支持诊断认证——只需要在访问时传递用户名和密码。第三个参数是认证的类型，可以是 <code class="docutils literal notranslate"><span class="pre">basic</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">digest</span></code>:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;auth&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;digest&#39;</span><span class="p">]]);</span>
</pre></div>
</div>
</div>
<div class="section" id="body">
<h3><a class="toc-backref" href="#id14">body （请求体）</a><a class="headerlink" href="#body" title="永久链接至标题">¶</a></h3>
<p>对于支持请求体的方法，例如 PUT 或者是 POST 来说，有两种方法来设置请求体。
第一种是使用 <code class="docutils literal notranslate"><span class="pre">setBody()</span></code> 方法:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="nv">$body</span><span class="p">)</span>
       <span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;put&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>第二种方法是通过传递一个 <code class="docutils literal notranslate"><span class="pre">body</span></code> 选项。该方式是为了与 Guzzle 兼容起见的，并提供了和上述方式一样的功能。该值必须是一个字符串:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;put&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="nv">$body</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="cert">
<h3><a class="toc-backref" href="#id15">cert (证书）</a><a class="headerlink" href="#cert" title="永久链接至标题">¶</a></h3>
<p>指定一个 PEM 格式的客户端证书的位置，通过为 <code class="docutils literal notranslate"><span class="pre">cert</span></code> 选项来传递绝对路径的方式来实现。
如果需要密码的话，为该选项数组的第一个元素的值为路径，第二个元素的值设为密码:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cert&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;/path/getServer.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="connect-timeout">
<h3><a class="toc-backref" href="#id16">connect_timeout （连接超时）</a><a class="headerlink" href="#connect-timeout" title="永久链接至标题">¶</a></h3>
<p>默认情况下， CodeIgniter 并未对 cURL 尝试连接一个网站的时间进行限制。
如果你需要修改这个值，可以通过为 <code class="docutils literal notranslate"><span class="pre">connect_timeout</span></code> 选项提供时间秒数值的方式来进行。传值为0时，无限等待:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;connect_timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="cookie">
<h3><a class="toc-backref" href="#id17">cookie</a><a class="headerlink" href="#cookie" title="永久链接至标题">¶</a></h3>
<p>该选项指定了 CURL 用于存取 cookie 值的文件名。这一过程通过使用 CURL_COOKIEJAR 和 CURL_COOKIEFILE 选项来实现。
例如:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cookie&#39;</span> <span class="o">=&gt;</span> <span class="nx">WRITEPATH</span> <span class="o">.</span> <span class="s1">&#39;CookieSaver.txt&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="debug-bug">
<h3><a class="toc-backref" href="#id18">debug （调试bug）</a><a class="headerlink" href="#debug-bug" title="永久链接至标题">¶</a></h3>
<p>当 <code class="docutils literal notranslate"><span class="pre">debug</span></code> 被传递并设为 <code class="docutils literal notranslate"><span class="pre">true</span></code> 时，就会启动额外的调试模式并在脚本执行时输出标准错误流信息( STDERR )。
该操作是通过传递 CURLOPT_VERBOSE 并返回输出来实现的。
因此当你需要利用 <code class="docutils literal notranslate"><span class="pre">spark</span> <span class="pre">serve</span></code> 运行一个内置服务器时，将会看到命令行中的输出内容。否则输出就会被写入到服务器的错误日志中:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;debug&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
</pre></div>
</div>
<p>可以通过将文件名作为参数传入的方式，将输出写入到文件中:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;debug&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/local/curl_log.txt&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="delay">
<h3><a class="toc-backref" href="#id19">delay （延时）</a><a class="headerlink" href="#delay" title="永久链接至标题">¶</a></h3>
<p>使得你可以在发送请求前延迟指定的毫秒时间:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// 延时2秒</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;delay&#39;</span> <span class="o">=&gt;</span> <span class="mi">2000</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="form-params">
<h3><a class="toc-backref" href="#id20">form_params （表单参数）</a><a class="headerlink" href="#form-params" title="永久链接至标题">¶</a></h3>
<p>你可以通过为 <code class="docutils literal notranslate"><span class="pre">form_params</span></code> 选项传递关联数组的方式，在一个 application/x-www-form-urlencoded POST 请求里发送表单数据。
该操作会将 <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> 请求头强制设为 <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code></p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/post&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;form_params&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
                <span class="s1">&#39;baz&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;hi&#39;</span><span class="p">,</span> <span class="s1">&#39;there&#39;</span><span class="p">]</span>
        <span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">form_params</span></code> 不能和 <code class="docutils literal notranslate"><span class="pre">multipart</span></code> 选项一起使用。你可以非此即彼地使用这两个选项。<code class="docutils literal notranslate"><span class="pre">form_params</span></code> 用于 <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> 请求，而 <code class="docutils literal notranslate"><span class="pre">multipart</span></code> 用于 <code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code> 请求。</p>
</div>
</div>
<div class="section" id="headers">
<h3><a class="toc-backref" href="#id21">headers （请求头）</a><a class="headerlink" href="#headers" title="永久链接至标题">¶</a></h3>
<p>尽管你可以通过 <code class="docutils literal notranslate"><span class="pre">setHeader()</span></code> 方法来传递任何请求头，你也可以通过为选项传递关联数组作为参数的方式来实现自定义请求头。
该关联数组中每个键都是请求头的名字，而值就是一个字符串或者是一个字符串数组，包括着请求头字段的值:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;headers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;User-Agent&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;testing/1.0&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Accept&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
                <span class="s1">&#39;X-Foo&#39;</span>      <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Bar&#39;</span><span class="p">,</span> <span class="s1">&#39;Baz&#39;</span><span class="p">]</span>
        <span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>如果请求头在构造函数中被传入时，就会被设为默认选项。而默认选项会被后续设置的选项或者 <code class="docutils literal notranslate"><span class="pre">setHeader()</span></code> 的调用所覆盖。</p>
</div>
<div class="section" id="http-errors-http">
<h3><a class="toc-backref" href="#id22">http_errors （http错误）</a><a class="headerlink" href="#http-errors-http" title="永久链接至标题">¶</a></h3>
<p>默认情况下，CURLRequest 类会在 HTTP 状态码大于等于400时结束请求并报错。
你可以通过将 <code class="docutils literal notranslate"><span class="pre">http_errors</span></code> 选项设为 <code class="docutils literal notranslate"><span class="pre">false</span></code> 的方式来返回内容:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/status/500&#39;</span><span class="p">);</span>
<span class="c1">// 自动失败报错</span>

<span class="nv">$res</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/status/500&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;http_errors&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]);</span>
<span class="k">echo</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">();</span>
<span class="c1">// 500</span>
</pre></div>
</div>
</div>
<div class="section" id="json">
<h3><a class="toc-backref" href="#id23">json</a><a class="headerlink" href="#json" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">json</span></code> 选项用于上传 JSON 编码的数据作为请求体。同时会在请求头上加入 Content-Type 为 <code class="docutils literal notranslate"><span class="pre">application/json</span></code> 。
并覆盖先前设置的 Content-Type 请求头。传递给该选项的参数可以是任何 <code class="docutils literal notranslate"><span class="pre">json_encode()</span></code> 函数所接受的参数:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;/put&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;json&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]]);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">该选项不允许对 <code class="docutils literal notranslate"><span class="pre">json_encode()</span></code> 和 Content-Type 请求头进行自定义地修改。如果你需要这一功能，
就需要手动编码数据并将其传递给 CURLRequest 类的 <code class="docutils literal notranslate"><span class="pre">setBody()</span></code> 方法，并通过 <code class="docutils literal notranslate"><span class="pre">setHeader()</span></code> 方法来设置 Content-Header 请求头。</p>
</div>
</div>
<div class="section" id="multipart">
<h3><a class="toc-backref" href="#id24">multipart</a><a class="headerlink" href="#multipart" title="永久链接至标题">¶</a></h3>
<p>如果你想通过 POST 请求来发送文件或者其他数据时，可以使用 <code class="docutils literal notranslate"><span class="pre">multipart</span></code> 选项和 <a class="reference external" href="https://www.php.net/manual/en/class.curlfile.php">CURLFile 类</a> 。
该选项的值应当是一个需要关联数组，包含有需要发送的数据。为了安全起见，上传文件时在前缀上加上 <cite>&#64;</cite> 的遗留方法已被禁止。你所需要发送的文件应当以 CURLFile 类的实例的方式传递:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$post_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;foo&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
        <span class="s1">&#39;userfile&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\CURLFile</span><span class="p">(</span><span class="s1">&#39;/path/to/file.txt&#39;</span><span class="p">)</span>
<span class="p">];</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">multipart</span></code> 不能和 <code class="docutils literal notranslate"><span class="pre">form_params</span></code> 选项一起使用。你可以非此即彼地使用这两个选项。
<code class="docutils literal notranslate"><span class="pre">form_params</span></code> 用于 <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> 请求，而 <code class="docutils literal notranslate"><span class="pre">multipart</span></code> 用于 <code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code> 请求。</p>
</div>
</div>
<div class="section" id="query">
<h3><a class="toc-backref" href="#id25">query （查询语句）</a><a class="headerlink" href="#query" title="永久链接至标题">¶</a></h3>
<p>你可以通过为 <code class="docutils literal notranslate"><span class="pre">query</span></code> 选项传递一个关联数组的方式来发送查询字符串信息:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// 发送一个 GET 请求来获取 /get?foo=bar 的结果</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/get&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;query&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]]);</span>
</pre></div>
</div>
</div>
<div class="section" id="timeout">
<h3><a class="toc-backref" href="#id26">timeout（超时）</a><a class="headerlink" href="#timeout" title="永久链接至标题">¶</a></h3>
<p>默认情况下， cURL 函数可以执行任意长的时间，不受时间限制。你可以通过 <code class="docutils literal notranslate"><span class="pre">timeout</span></code> 选项来修改这一过程。选项值是你需要这个函数运行的时间。使用0来无限等待:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="verify">
<h3><a class="toc-backref" href="#id27">verify（鉴权）</a><a class="headerlink" href="#verify" title="永久链接至标题">¶</a></h3>
<p>该选项描述了 SSL 验证鉴权行为。
如果 <code class="docutils literal notranslate"><span class="pre">verify</span></code> 选项被设为 <code class="docutils literal notranslate"><span class="pre">true</span></code> ，就开始 SSL 鉴权操作并使用系统提供默认的 CA 包文件。如果设为 <code class="docutils literal notranslate"><span class="pre">false</span></code> ，就会禁用鉴权操作（这一行为不安全，并可能导致中间人攻击！）。
你可以将该参数设为一个 CA 包文件所在的路径，从而进行自定义的鉴权操作。该选项默认值为 true</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用系统的 CA 包文件（默认设置）</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;verify&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>

<span class="c1">// 使用硬盘上的一个自定义的 SSL 鉴权文件</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;verify&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/path/to/cert.pem&#39;</span><span class="p">]);</span>

<span class="c1">// 完全禁用鉴权（不安全！）</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;verify&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="version">
<h3><a class="toc-backref" href="#id28">version（版本）</a><a class="headerlink" href="#version" title="永久链接至标题">¶</a></h3>
<p>你可以通过为版本参数传递一个字符串或者浮点数（特别是1.0，或1.1，尚未支持2.0）的方式来设置协议版本:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// 强制使用 HTTP/1.0</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;version&#39;</span> <span class="o">=&gt;</span> <span class="mf">1.0</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="email.html" class="btn btn-neutral float-right" title="Email Class" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="caching.html" class="btn btn-neutral float-left" title="缓存驱动器" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> 上一页</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 版权所有 2019-2020 CodeIgniter 基金会
      <span class="lastupdated">
        最后更新于 2020-09-11.
      </span>

    </p>
  </div>
    
    
    
    利用 <a href="http://sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
  <p></p>
  <p>由 <a href="https://codeigniter.org.cn">CodeIgniter 中国开发者社区</a>翻译并制作</p>
  <p>
    <a href="https://github.com/CodeIgniter-Chinese/codeigniter4-user-guide" target="_blank">Github 简体中文翻译</a>
    ·
    <a href="https://codeigniter-chinese.github.io/codeigniter4-user-guide/codeigniter_user_guide.zip">离线版压缩包下载</a>
    ·
    <a href="https://codeigniter-chinese.github.io/codeigniter4-user-guide/CodeIgniter.pdf">PDF 版下载</a>
    <!--·
    <a href="https://codeigniter-chinese.github.io/codeigniter4-user-guide/CodeIgniter4.epub">EPUB 版下载</a>-->
  </p>


</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>