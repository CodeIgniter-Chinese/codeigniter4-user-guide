################
页面缓存
################

CodeIgniter 支持页面缓存，助你实现极致性能。

尽管 CodeIgniter 本身运行迅速，但页面中包含的动态内容越多，所消耗的服务器资源、内存和 CPU 处理时间就越多，页面加载速度也会随之下降。启用页面缓存后，系统会将页面以完全渲染后的形式保存下来，从而获得接近静态网页的性能表现。

.. contents::
    :local:
    :depth: 2

缓存如何工作？
======================

缓存可以按页面启用，你可以设置页面在刷新前应保持缓存的时间长度。

.. note:: 按页面是指按 URI。自 v4.5.0 起，请求的 HTTP 方法也被考虑在内。这意味着如果 HTTP 方法不同，相同的 URI 将被分别缓存。

当页面首次加载时，页面将使用当前配置的缓存引擎进行缓存。在后续的页面加载中，缓存将被检索并发送到请求用户的浏览器。

如果缓存已过期，它将在发送到浏览器之前被删除并刷新。

.. note:: Benchmark 标签不会被缓存，因此即使在启用缓存时，你仍然可以查看页面加载速度。

配置缓存
===================

设置缓存引擎
--------------------

在使用页面缓存之前，你必须通过编辑 **app/Config/Cache.php** 来设置缓存引擎。详情请参阅 :ref:`libraries-caching-configuring-the-cache`。

设置 $cacheQueryString
-------------------------

你可以通过 ``Config\Cache::$cacheQueryString`` 设置在生成缓存时是否包含查询字符串。

有效选项有：

- ``false``：（默认）禁用。不考虑查询字符串；对于具有相同 URI 路径但不同查询字符串的请求，返回相同的缓存。
- ``true``：启用，考虑所有查询参数。请注意，这可能会导致为同一页面反复生成大量缓存。
- **array**：启用，但只考虑指定的查询参数列表。例如，``['q', 'page']``。

启用缓存
================

要启用缓存，请在任何控制器方法中放置以下标签：

.. literalinclude:: caching/001.php

其中 ``$n`` 是你希望页面在刷新之间保持缓存的 **秒数**。

上述标签可以放置在方法中的任何位置。它的出现顺序不会影响其功能，因此你可以将其放在你认为最合理的位置。一旦标签放置到位，你的页面将开始被缓存。

.. important:: 如果你更改了可能影响输出的配置选项，则必须手动删除缓存。

删除缓存
===============

如果你不再希望缓存某个页面，可以移除缓存标签，这样当缓存过期时，它将不会再被刷新。

.. note:: 移除标签不会立即删除缓存。它必须正常过期。
