###########################
连接数据库
###########################

.. contents::
    :local:
    :depth: 2

连接数据库
========================

连接到默认组
-------------------------------

你可以在需要的任何函数中，或在类构造函数中添加以下代码，使数据库在整个类中全局可用。

.. literalinclude:: connecting/001.php
    :lines: 2-

如果上述函数的第一个参数中**不**包含任何信息，它将连接到数据库配置文件中指定的默认组。对大多数人来说，这是首选的使用方法。

存在一个便利方法，它纯粹是上述代码行的包装器，为你的使用提供便利：

.. literalinclude:: connecting/002.php
    :lines: 2-

可用参数
--------------------

**\\Config\\Database::connect($group = null, bool $getShared = true): BaseConnection**

#. ``$group``: 数据库组名称，一个必须与配置类属性名称匹配的字符串。默认值为 ``Config\\Database::$defaultGroup``。
#. ``$getShared``: true/false (布尔值)。是否返回共享连接（参见下面的“连接多个数据库”）。

连接到特定组
----------------------------

此函数的第一个参数可以**选择性地**用于指定配置文件中的特定数据库组。例如：

要从配置文件中选择特定组，你可以这样做：

.. literalinclude:: connecting/003.php
    :lines: 2-

其中 ``group_name`` 是配置文件中连接组的名称。

同一个数据库的多个连接
-------------------------------------

默认情况下，``connect()`` 方法每次都会返回数据库连接的同一个实例。如果你需要对同一个数据库建立一个独立的连接，请将 ``false`` 作为第二个参数传入：

.. literalinclude:: connecting/004.php
    :lines: 2-

连接多个数据库
================================

如果你需要同时连接到多个数据库，可以这样做：

.. literalinclude:: connecting/005.php
    :lines: 2-

注意：将 ``group_one`` 和 ``group_two`` 这些词替换为你正在连接的特定组名称。

.. note:: 如果你只需要在同一连接上使用不同的数据库，则无需创建单独的数据库配置。你可以在需要时切换到不同的数据库，就像这样：
    ``$db->setDatabase($database2_name);``

使用自定义设置连接
===============================

你可以传入一个数据库设置数组而不是组名，以获取使用你自定义设置的连接。传入的数组必须遵循与配置文件中数据库组相同的结构：

.. literalinclude:: connecting/006.php
    :lines: 2-

重新连接 / 保持连接活跃
===========================================

当你在执行一些繁重的 PHP 操作（例如处理图像）时，如果超过了数据库服务器的空闲超时时间，你应该考虑在发送后续查询之前使用 ``reconnect()`` 方法来 ping 服务器，这可以优雅地保持连接活跃或重新建立连接。

.. important:: 如果你使用的是 MySQLi 数据库驱动，``reconnect()`` 方法不会 ping 服务器，而是会关闭连接然后重新连接。

.. literalinclude:: connecting/007.php
    :lines: 2-

手动关闭连接
===============================

虽然 CodeIgniter 会智能地处理关闭数据库连接，但你也可以显式地关闭连接。

.. literalinclude:: connecting/008.php
    :lines: 2-
