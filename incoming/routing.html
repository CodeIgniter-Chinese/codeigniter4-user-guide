<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>URI 路由 &mdash; CodeIgniter 4.6.0 中文手册|用户手册|用户指南|中文文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/citheme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/citheme_dark.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
        <script src="../_static/js/citheme.js"></script>
        <script src="../_static/js/carbon.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="控制器" href="controllers.html" />
    <link rel="prev" title="控制器和路由" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/ci-logo-text.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">欢迎使用 CodeIgniter4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/index.html">欢迎使用 CodeIgniter4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/requirements.html">服务器要求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/credits.html">致谢</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/psr.html">PSR 兼容性</a></li>
<li class="toctree-l2"><a class="reference internal" href="../license.html">许可协议</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">安装</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation/installing_composer.html">Composer 安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/installing_manual.html">手动安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/running.html">运行你的应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/troubleshooting.html">故障排除</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/deployment.html">部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelogs/index.html">变更记录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/upgrading.html">从前一版本升级</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/repositories.html">CodeIgniter 仓库</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">构建你的第一个应用程序</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/static_pages.html">静态页面</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/news_section.html">新闻部分</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/create_news_items.html">创建新闻</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/conclusion.html">结束语</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">CodeIgniter4 概览</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/structure.html">应用程序结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/mvc.html">模型、视图和控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/autoloader.html">自动加载文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/services.html">服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/factories.html">工厂</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/http.html">处理 HTTP 请求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/security.html">安全指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/goals.html">设计与架构目标</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general/index.html">常规主题</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../general/configuration.html">配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/urls.html">CodeIgniter URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/helpers.html">辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/common_functions.html">全局函数和常量</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/logging.html">记录信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/errors.html">错误处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/caching.html">网页缓存</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/ajax.html">AJAX 请求</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/modules.html">代码模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/managing_apps.html">管理应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general/environments.html">处理多个环境</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">控制器和路由</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">URI 路由</a></li>
<li class="toctree-l2"><a class="reference internal" href="controllers.html">控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html">控制器过滤器</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_routing_improved.html">自动路由（改进版）</a></li>
<li class="toctree-l2"><a class="reference internal" href="message.html">HTTP 消息</a></li>
<li class="toctree-l2"><a class="reference internal" href="request.html">请求类</a></li>
<li class="toctree-l2"><a class="reference internal" href="incomingrequest.html">IncomingRequest 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="content_negotiation.html">内容协商</a></li>
<li class="toctree-l2"><a class="reference internal" href="methodspoofing.html">HTTP 方法欺骗</a></li>
<li class="toctree-l2"><a class="reference internal" href="restful.html">RESTful 资源处理</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../outgoing/index.html">构建响应</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/views.html">视图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_renderer.html">视图渲染器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_layouts.html">视图布局</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_cells.html">视图单元</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_parser.html">视图解析器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/view_decorators.html">视图装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/table.html">HTML 表格类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/response.html">HTTP 响应</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/api_responses.html">API 响应特性</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/csp.html">内容安全策略</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/localization.html">本地化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../outgoing/alternative_php.html">在视图文件中使用 PHP 替代语法</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../database/index.html">使用数据库</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/examples.html">快速入门:使用示例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/configuration.html">数据库配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/connecting.html">连接数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/queries.html">运行查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/results.html">生成查询结果</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/helpers.html">查询辅助方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/query_builder.html">查询构建器类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/transactions.html">事务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/metadata.html">获取元数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/call_function.html">自定义函数调用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/events.html">数据库事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/utilities.html">数据库实用工具</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/index.html">数据建模</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/model.html">使用 CodeIgniter 的模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/entities.html">使用实体类</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dbmgmt/index.html">管理数据库</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/forge.html">数据库 Forge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/migration.html">数据库迁移</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/seeds.html">数据库填充</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dbmgmt/db_commands.html">数据库命令</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../libraries/index.html">类库参考</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../libraries/caching.html">缓存驱动</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/cookies.html">Cookie</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/cors.html">跨域资源共享 (CORS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/curlrequest.html">CURLRequest 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/email.html">Email 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/encryption.html">加密服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/files.html">文件处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/file_collections.html">文件集合</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/honeypot.html">蜜罐类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/images.html">图像处理类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/pagination.html">分页</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/publisher.html">Publisher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/security.html">安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/sessions.html">Session 库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/throttler.html">限速器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/time.html">时间与日期</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/typography.html">排版</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/uploaded_files.html">处理上传的文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/uri.html">使用 URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/user_agent.html">User Agent 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libraries/validation.html">数据验证</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../helpers/index.html">辅助函数</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../helpers/array_helper.html">数组辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/cookie_helper.html">Cookie 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/date_helper.html">日期辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/filesystem_helper.html">文件系统辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/form_helper.html">表单辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/html_helper.html">HTML 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/inflector_helper.html">Inflector 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/number_helper.html">数字辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/security_helper.html">安全辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/test_helper.html">测试辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/text_helper.html">文本辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/url_helper.html">URL 辅助函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/xml_helper.html">XML 辅助函数</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">测试</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing/overview.html">入门指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/database.html">数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/fabricator.html">生成数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/controllers.html">测试控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/feature.html">HTTP 测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/response.html">测试响应</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/cli.html">测试 CLI 命令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/mocking.html">模拟</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/benchmark.html">基准测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/debugging.html">调试应用程序</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">命令行使用</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_overview.html">CLI 概览</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_controllers.html">通过 CLI 运行控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/spark_commands.html">Spark 命令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_commands.html">创建 Spark 命令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_generators.html">CLI 生成器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_library.html">CLI 库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/cli_request.html">CLIRequest 类</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extending/index.html">扩展 CodeIgniter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../extending/core_classes.html">创建核心系统类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/common.html">替换通用函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/events.html">事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/basecontroller.html">扩展控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/authentication.html">身份验证</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/composer_packages.html">创建 Composer 包</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending/contributing.html">为 CodeIgniter 做贡献</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../libraries/official_packages.html">官方包</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CodeIgniter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">控制器和路由</a></li>
      <li class="breadcrumb-item active">URI 路由</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="uri">
<h1>URI 路由<a class="headerlink" href="#uri" title="此标题的永久链接"></a></h1>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#id2" id="id66">什么是 URI 路由？</a></p></li>
<li><p><a class="reference internal" href="#defined-route-routing" id="id67">设置路由规则</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id68">示例</a></p></li>
<li><p><a class="reference internal" href="#http" id="id69">HTTP 方法路由</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id70">指定路由处理器</a></p>
<ul>
<li><p><a class="reference internal" href="#controllers-namespace" id="id71">控制器的命名空间</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id72">数组可调用语法</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id73">使用闭包</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id10" id="id74">指定路由路径</a></p>
<ul>
<li><p><a class="reference internal" href="#id11" id="id75">占位符</a></p></li>
<li><p><a class="reference internal" href="#id13" id="id76">自定义占位符</a></p></li>
<li><p><a class="reference internal" href="#id14" id="id77">正则表达式</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#view-routes" id="id78">视图路由</a></p></li>
<li><p><a class="reference internal" href="#redirecting-routes" id="id79">重定向路由</a></p></li>
<li><p><a class="reference internal" href="#id17" id="id80">环境限制</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id81">任意 HTTP 方法路由</a></p></li>
<li><p><a class="reference internal" href="#id19" id="id82">批量映射路由</a></p></li>
<li><p><a class="reference internal" href="#command-line-only-routes" id="id83">仅命令行路由</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id21" id="id84">全局选项</a></p>
<ul>
<li><p><a class="reference internal" href="#applying-filters" id="id85">应用过滤器</a></p>
<ul>
<li><p><a class="reference internal" href="#id23" id="id86">别名过滤器</a></p></li>
<li><p><a class="reference internal" href="#id24" id="id87">类名过滤器</a></p></li>
<li><p><a class="reference internal" href="#multiple-filters" id="id88">多重过滤器</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#assigning-namespace" id="id89">分配命名空间</a></p></li>
<li><p><a class="reference internal" href="#id28" id="id90">限制主机名</a></p>
<ul>
<li><p><a class="reference internal" href="#id29" id="id91">多主机名限制</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id30" id="id92">限制子域</a></p></li>
<li><p><a class="reference internal" href="#id31" id="id93">偏移匹配参数</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reverse-routing" id="id94">反向路由</a></p></li>
<li><p><a class="reference internal" href="#using-named-routes" id="id95">命名路由</a></p></li>
<li><p><a class="reference internal" href="#id34" id="id96">分组路由</a></p>
<ul>
<li><p><a class="reference internal" href="#id35" id="id97">设置命名空间</a></p></li>
<li><p><a class="reference internal" href="#id36" id="id98">设置过滤器</a></p></li>
<li><p><a class="reference internal" href="#id37" id="id99">设置其他选项</a></p></li>
<li><p><a class="reference internal" href="#routing-nesting-groups" id="id100">嵌套分组</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#routing-priority" id="id101">路由优先级</a></p>
<ul>
<li><p><a class="reference internal" href="#id40" id="id102">调整路由优先级</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#routes-configuration-options" id="id103">路由配置选项</a></p>
<ul>
<li><p><a class="reference internal" href="#routing-default-namespace" id="id104">默认命名空间</a></p></li>
<li><p><a class="reference internal" href="#routing-default-method" id="id105">默认方法</a></p></li>
<li><p><a class="reference internal" href="#id44" id="id106">转换 URI 短横线</a></p></li>
<li><p><a class="reference internal" href="#use-defined-routes-only" id="id107">仅使用定义路由</a></p></li>
<li><p><a class="reference internal" href="#override" id="id108">404 重写</a></p></li>
<li><p><a class="reference internal" href="#id47" id="id109">按优先级处理路由</a></p></li>
<li><p><a class="reference internal" href="#multiple-uri-segments-as-one-parameter" id="id110">多 URI 段作为单一参数</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id49" id="id111">自动路由（改进版）</a></p></li>
<li><p><a class="reference internal" href="#auto-routing-legacy" id="id112">自动路由（传统版）</a></p>
<ul>
<li><p><a class="reference internal" href="#id51" id="id113">启用传统自动路由</a></p></li>
<li><p><a class="reference internal" href="#id52" id="id114">URI 分段（传统版）</a></p></li>
<li><p><a class="reference internal" href="#routing-auto-routing-legacy-configuration-options" id="id115">配置选项（传统版）</a></p>
<ul>
<li><p><a class="reference internal" href="#id54" id="id116">默认控制器(传统版)</a></p></li>
<li><p><a class="reference internal" href="#routing-auto-routing-legacy-default-method" id="id117">默认方法（传统版）</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#id58" id="id118">验证路由</a></p>
<ul>
<li><p><a class="reference internal" href="#spark" id="id119">spark 路由</a></p>
<ul>
<li><p><a class="reference internal" href="#id59" id="id120">自动路由(改进版)</a></p></li>
<li><p><a class="reference internal" href="#id60" id="id121">自动路由(传统)</a></p></li>
<li><p><a class="reference internal" href="#routing-spark-routes-sort-by-handler" id="id122">按处理程序排序</a></p></li>
<li><p><a class="reference internal" href="#routing-spark-routes-specify-host" id="id123">指定主机</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#id63" id="id124">获取路由信息</a></p>
<ul>
<li><p><a class="reference internal" href="#id64" id="id125">检索当前控制器/方法名称</a></p></li>
<li><p><a class="reference internal" href="#id65" id="id126">获取当前路由的活动过滤器</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="id2">
<h2><a class="toc-backref" href="#id66" role="doc-backlink">什么是 URI 路由？</a><a class="headerlink" href="#id2" title="此标题的永久链接"></a></h2>
<p>URI 路由将 URI 与控制器的方法关联起来。</p>
<p>CodeIgniter 有两种路由方式。一种是 <strong>定义式路由</strong>，另一种是 <strong>自动路由</strong>。通过定义式路由，你可以手动定义路由规则，这种方式允许更灵活的 URL 结构。自动路由则基于约定自动映射 HTTP 请求到对应的控制器方法，无需手动定义路由。</p>
<p>首先我们来看定义式路由。如需使用自动路由，请参阅 <a class="reference internal" href="auto_routing_improved.html#auto-routing-improved"><span class="std std-ref">自动路由（改进版）</span></a>。</p>
</section>
<section id="defined-route-routing">
<span id="id3"></span><h2><a class="toc-backref" href="#id67" role="doc-backlink">设置路由规则</a><a class="headerlink" href="#defined-route-routing" title="此标题的永久链接"></a></h2>
<p>路由规则定义在 <strong>app/Config/Routes.php</strong> 文件中。在该文件中，你会看到创建了一个 RouteCollection 类的实例（<code class="docutils literal notranslate"><span class="pre">$routes</span></code>），用于指定自定义路由条件。可以使用占位符或正则表达式来定义路由。</p>
<p>当定义路由时，需选择与 HTTP 方法（请求方法）对应的路由方法。例如处理 GET 请求时使用 <code class="docutils literal notranslate"><span class="pre">get()</span></code> 方法：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;Home::index&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>路由左侧指定 <strong>路由路径</strong> （相对于 BaseURL 的 URI 路径，以 <code class="docutils literal notranslate"><span class="pre">/</span></code> 开头），右侧映射到 <strong>路由处理器</strong> （控制器和方法 <code class="docutils literal notranslate"><span class="pre">Home::index</span></code>），并可传递参数给控制器。</p>
<p>控制器和方法应按静态方法的形式列出，使用双冒号分隔类和方法，例如 <code class="docutils literal notranslate"><span class="pre">Users::list</span></code>。</p>
<p>若方法需要参数，可在方法名后使用斜杠分隔：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Calls $Users-&gt;list()</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;Users::list&#39;</span><span class="p">);</span>

<span class="c1">// Calls $Users-&gt;list(1, 23)</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users/1/23&#39;</span><span class="p">,</span> <span class="s1">&#39;Users::list/1/23&#39;</span><span class="p">);</span>
</pre></div>
</div>
<section id="id4">
<h3><a class="toc-backref" href="#id68" role="doc-backlink">示例</a><a class="headerlink" href="#id4" title="此标题的永久链接"></a></h3>
<p>以下是几个基础路由示例：</p>
<p>当 URL 第一段包含 <strong>journals</strong> 时，将映射到 <code class="docutils literal notranslate"><span class="pre">\App\Controllers\Blogs</span></code> 类，并调用 <a class="reference internal" href="#routing-default-method"><span class="std std-ref">默认方法</span></a> （通常为 <code class="docutils literal notranslate"><span class="pre">index()</span></code>）：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;journals&#39;</span><span class="p">,</span> <span class="s1">&#39;Blogs&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>当 URL 包含 <strong>blog/joe</strong> 时，映射到 <code class="docutils literal notranslate"><span class="pre">\App\Controllers\Blogs</span></code> 类的 <code class="docutils literal notranslate"><span class="pre">users()</span></code> 方法，ID 参数设为 <code class="docutils literal notranslate"><span class="pre">34</span></code>：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;blog/joe&#39;</span><span class="p">,</span> <span class="s1">&#39;Blogs::users/34&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>当 URL 第一段为 <strong>product</strong>，第二段为任意内容时，映射到 <code class="docutils literal notranslate"><span class="pre">\App\Controllers\Catalog</span></code> 类的 <code class="docutils literal notranslate"><span class="pre">productLookup()</span></code> 方法：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;product/(:segment)&#39;</span><span class="p">,</span> <span class="s1">&#39;Catalog::productLookup&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>当 URL 第一段为 <strong>product</strong>，第二段为数字时，映射到 <code class="docutils literal notranslate"><span class="pre">\App\Controllers\Catalog</span></code> 类的 <code class="docutils literal notranslate"><span class="pre">productLookupByID()</span></code> 方法，并将匹配值作为参数传递：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;product/(:num)&#39;</span><span class="p">,</span> <span class="s1">&#39;Catalog::productLookupByID/$1&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="http">
<span id="routing-http-verb-routes"></span><h3><a class="toc-backref" href="#id69" role="doc-backlink">HTTP 方法路由</a><a class="headerlink" href="#http" title="此标题的永久链接"></a></h3>
<p>可以使用任意标准 HTTP 方法（GET、POST、PUT、DELETE、OPTIONS 等）：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="s1">&#39;Product::feature&#39;</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;products/1&#39;</span><span class="p">,</span> <span class="s1">&#39;Product::feature&#39;</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;products/1&#39;</span><span class="p">,</span> <span class="s1">&#39;Product::feature&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>通过 <code class="docutils literal notranslate"><span class="pre">match()</span></code> 方法传入方法数组，可匹配多个 HTTP 方法：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">([</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">],</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="s1">&#39;Product::feature&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id70" role="doc-backlink">指定路由处理器</a><a class="headerlink" href="#id5" title="此标题的永久链接"></a></h3>
<section id="controllers-namespace">
<span id="id6"></span><h4><a class="toc-backref" href="#id71" role="doc-backlink">控制器的命名空间</a><a class="headerlink" href="#controllers-namespace" title="此标题的永久链接"></a></h4>
<p>当以字符串形式指定控制器和方法名时，若控制器名称未以 <code class="docutils literal notranslate"><span class="pre">\</span></code> 开头，系统会自动添加 <a class="reference internal" href="#routing-default-namespace"><span class="std std-ref">默认命名空间</span></a>：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Routes to \App\Controllers\Api\Users::update()</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;api/users&#39;</span><span class="p">,</span> <span class="s1">&#39;Api\Users::update&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>若以 <code class="docutils literal notranslate"><span class="pre">\</span></code> 开头，则视为完全限定类名：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Routes to \Acme\Blog\Controllers\Home::list()</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;blog&#39;</span><span class="p">,</span> <span class="s1">&#39;\Acme\Blog\Controllers\Home::list&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>也可通过 <code class="docutils literal notranslate"><span class="pre">namespace</span></code> 选项指定命名空间：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Routes to \Admin\Users::index()</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;admin/users&#39;</span><span class="p">,</span> <span class="s1">&#39;Users::index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Admin&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>详见 <a class="reference internal" href="#assigning-namespace"><span class="std std-ref">分配命名空间</span></a>。</p>
</section>
<section id="id7">
<h4><a class="toc-backref" href="#id72" role="doc-backlink">数组可调用语法</a><a class="headerlink" href="#id7" title="此标题的永久链接"></a></h4>
<div class="versionadded">
<p><span class="versionmodified added">在 4.2.0 版本加入.</span></p>
</div>
<p>从 v4.2.0 开始，可使用数组可调用语法指定控制器：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">\App\Controllers\Home</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>或使用 <code class="docutils literal notranslate"><span class="pre">use</span></code> 关键字：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">App\Controllers\Home</span><span class="p">;</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">Home</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>若忘记添加 <code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">App\Controllers\Home;</span></code>，控制器类名将被解析为 <code class="docutils literal notranslate"><span class="pre">\Home</span></code> 而非 <code class="docutils literal notranslate"><span class="pre">App\Controllers\Home</span></code>。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>使用数组可调用语法时，类名始终视为完全限定类名，因此 <a class="reference internal" href="#routing-default-namespace"><span class="std std-ref">默认命名空间</span></a> 和 <a class="reference internal" href="#assigning-namespace"><span class="std std-ref">namespace 选项</span></a> 将失效。</p>
</div>
<section id="id8">
<h5>数组可调用语法与占位符<a class="headerlink" href="#id8" title="此标题的永久链接"></a></h5>
<p>若存在占位符，参数将按指定顺序自动设置：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">App\Controllers\Product</span><span class="p">;</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;product/(:num)/(:num)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">Product</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>

<span class="c1">// The above code is the same as the following:</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;product/(:num)/(:num)&#39;</span><span class="p">,</span> <span class="s1">&#39;Product::index/$1/$2&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>但在路由中使用正则表达式时，自动配置的参数可能不正确。此时可手动指定参数：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">App\Controllers\Product</span><span class="p">;</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;product/(:num)/(:num)&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="nx">Product</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="s1">&#39;$2/$1&#39;</span><span class="p">]);</span>

<span class="c1">// The above code is the same as the following:</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;product/(:num)/(:num)&#39;</span><span class="p">,</span> <span class="s1">&#39;Product::index/$2/$1&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="id9">
<h4><a class="toc-backref" href="#id73" role="doc-backlink">使用闭包</a><a class="headerlink" href="#id9" title="此标题的永久链接"></a></h4>
<p>可使用匿名函数（闭包）作为路由目标。当用户访问对应 URI 时，该函数将被执行，适用于快速执行小任务或显示简单视图：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">use</span> <span class="nx">App\Libraries\RSSFeeder</span><span class="p">;</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;feed&#39;</span><span class="p">,</span> <span class="k">static</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nv">$rss</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RSSFeeder</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$rss</span><span class="o">-&gt;</span><span class="na">feed</span><span class="p">(</span><span class="s1">&#39;general&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
</section>
<section id="id10">
<h3><a class="toc-backref" href="#id74" role="doc-backlink">指定路由路径</a><a class="headerlink" href="#id10" title="此标题的永久链接"></a></h3>
<section id="id11">
<h4><a class="toc-backref" href="#id75" role="doc-backlink">占位符</a><a class="headerlink" href="#id11" title="此标题的永久链接"></a></h4>
<p>典型路由示例如下：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;product/(:num)&#39;</span><span class="p">,</span> <span class="s1">&#39;Catalog::productLookup&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>路由的第一个参数是待匹配的 URI，第二个参数是目标路由。当 URL 路径第一段为 “product” 且第二段为数字时，将使用 <code class="docutils literal notranslate"><span class="pre">Catalog</span></code> 类的 <code class="docutils literal notranslate"><span class="pre">productLookup</span></code> 方法。</p>
<p>占位符是代表正则表达式模式的字符串，在路由过程中会被替换为实际正则表达式，主要用于提升可读性。</p>
<p>可用占位符列表：</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>占位符</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>(:any)</p></td>
<td><p>匹配从该位置到 URI 末尾的所有字符，可能包含多个段</p></td>
</tr>
<tr class="row-odd"><td><p>(:segment)</p></td>
<td><p>匹配除斜杠（<code class="docutils literal notranslate"><span class="pre">/</span></code>）外的任意字符，限制为单个段</p></td>
</tr>
<tr class="row-even"><td><p>(:num)</p></td>
<td><p>匹配任意整数</p></td>
</tr>
<tr class="row-odd"><td><p>(:alpha)</p></td>
<td><p>匹配任意字母字符串</p></td>
</tr>
<tr class="row-even"><td><p>(:alphanum)</p></td>
<td><p>匹配任意字母数字组合字符串</p></td>
</tr>
<tr class="row-odd"><td><p>(:hash)</p></td>
<td><p>与 <code class="docutils literal notranslate"><span class="pre">(:segment)</span></code> 相同，便于识别使用哈希 ID 的路由</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><code class="docutils literal notranslate"><span class="pre">{locale}</span></code> 不能作为占位符或路由其他部分，保留用于 <a class="reference internal" href="../outgoing/localization.html"><span class="doc">本地化</span></a>。</p>
</div>
<section id="any">
<span id="routing-placeholder-any"></span><h5>(:any) 的行为<a class="headerlink" href="#any" title="此标题的永久链接"></a></h5>
<p>注意单个 <code class="docutils literal notranslate"><span class="pre">(:any)</span></code> 会匹配 URL 中的多个段（如果存在）。</p>
<p>例如路由：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;product/(:any)&#39;</span><span class="p">,</span> <span class="s1">&#39;Catalog::productLookup/$1&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>将匹配 <strong>product/123</strong>、<strong>product/123/456</strong>、<strong>product/123/456/789</strong> 等。</p>
<p>默认情况下，上述示例中若 <code class="docutils literal notranslate"><span class="pre">$1</span></code> 占位符包含斜杠（<code class="docutils literal notranslate"><span class="pre">/</span></code>），传递给 <code class="docutils literal notranslate"><span class="pre">Catalog::productLookup()</span></code> 时仍会分割为多个参数。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>自 v4.5.0 起，可通过配置选项修改此行为，详见 <a class="reference internal" href="#multiple-uri-segments-as-one-parameter"><span class="std std-ref">多 URI 段作为单一参数</span></a>。</p>
</div>
<p>控制器实现应考虑最大参数数量：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Controllers</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Catalog</span> <span class="k">extends</span> <span class="nx">BaseController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">productLookup</span><span class="p">(</span><span class="nv">$seg1</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$seg2</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$seg3</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$seg1</span><span class="p">;</span> <span class="c1">// Will be 123 in all examples</span>
        <span class="k">echo</span> <span class="nv">$seg2</span><span class="p">;</span> <span class="c1">// false in first, 456 in second and third example</span>
        <span class="k">echo</span> <span class="nv">$seg3</span><span class="p">;</span> <span class="c1">// false in first and second, 789 in third</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>或使用 <a class="reference external" href="https://www.php.net/manual/zh/functions.arguments.php#functions.variable-arg-list">可变数量的参数值列表</a>：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Controllers</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Catalog</span> <span class="k">extends</span> <span class="nx">BaseController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">productLookup</span><span class="p">(</span><span class="o">...</span><span class="nv">$params</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">??</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// Will be 123 in all examples</span>
        <span class="k">echo</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">??</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// null in first, 456 in second and third example</span>
        <span class="k">echo</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">??</span> <span class="k">null</span><span class="p">;</span> <span class="c1">// null in first and second, 789 in third</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>请勿在 <code class="docutils literal notranslate"><span class="pre">(:any)</span></code> 后放置其他占位符，因为传递给控制器方法的参数数量可能变化。</p>
</div>
<p>若不需要匹配多段，应在定义路由时使用 <code class="docutils literal notranslate"><span class="pre">(:segment)</span></code>：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;product/(:segment)&#39;</span><span class="p">,</span> <span class="s1">&#39;Catalog::productLookup/$1&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>该路由仅匹配 <strong>product/123</strong>，其他情况返回 404 错误。</p>
</section>
</section>
<section id="id13">
<h4><a class="toc-backref" href="#id76" role="doc-backlink">自定义占位符</a><a class="headerlink" href="#id13" title="此标题的永久链接"></a></h4>
<p>可创建自定义占位符来完全定制路由体验。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">addPlaceholder()</span></code> 方法添加新占位符，第一个参数是占位符字符串，第二个参数是替换的正则表达式。需在添加路由前调用：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">addPlaceholder</span><span class="p">(</span><span class="s1">&#39;uuid&#39;</span><span class="p">,</span> <span class="s1">&#39;[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}&#39;</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users/(:uuid)&#39;</span><span class="p">,</span> <span class="s1">&#39;Users::show/$1&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id14">
<h4><a class="toc-backref" href="#id77" role="doc-backlink">正则表达式</a><a class="headerlink" href="#id14" title="此标题的永久链接"></a></h4>
<p>可使用正则表达式定义路由规则。允许任何有效正则表达式及反向引用。</p>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>注意：使用反向引用时需使用美元符号语法而非双反斜杠语法。典型正则路由示例：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;products/([a-z]+)/(\d+)&#39;</span><span class="p">,</span> <span class="s1">&#39;Products::show/$1/id_$2&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>上述示例中，类似 <strong>products/shirts/123</strong> 的 URI 将调用 <code class="docutils literal notranslate"><span class="pre">Products</span></code> 控制器的 <code class="docutils literal notranslate"><span class="pre">show()</span></code> 方法，原始第一、二段作为参数传递。</p>
<p>通过正则表达式可捕获包含斜杠的段（通常用于分隔多个段）。例如用户访问受密码保护区域后重定向回原页面：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;login/(.+)&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth::login/$1&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>默认情况下，若 <code class="docutils literal notranslate"><span class="pre">$1</span></code> 占位符包含斜杠，传递给 <code class="docutils literal notranslate"><span class="pre">Auth::login()</span></code> 时仍会分割为多个参数。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>自 v4.5.0 起，可通过配置选项修改此行为，详见 <a class="reference internal" href="#multiple-uri-segments-as-one-parameter"><span class="std std-ref">多 URI 段作为单一参数</span></a>。</p>
</div>
<p>关于正则表达式学习，推荐访问 <a class="reference external" href="https://www.regular-expressions.info/">regular-expressions.info</a>。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>可混合使用占位符和正则表达式。</p>
</div>
</section>
</section>
<section id="view-routes">
<span id="id15"></span><h3><a class="toc-backref" href="#id78" role="doc-backlink">视图路由</a><a class="headerlink" href="#view-routes" title="此标题的永久链接"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">在 4.3.0 版本加入.</span></p>
</div>
<p>若只需渲染无逻辑视图，可使用 <code class="docutils literal notranslate"><span class="pre">view()</span></code> 方法（始终视为 GET 请求）。第二个参数指定视图名称：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Displays the view in /app/Views/pages/about.php</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s1">&#39;about&#39;</span><span class="p">,</span> <span class="s1">&#39;pages/about&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>若路由中使用占位符，可通过 <code class="docutils literal notranslate"><span class="pre">$segments</span></code> 数组在视图中访问：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Displays the view in /app/Views/map.php</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s1">&#39;map/(:segment)/(:segment)&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">);</span>

<span class="c1">// Within the view, you can access the segments with</span>
<span class="c1">// $segments[0] and $segments[1] respectively.</span>
</pre></div>
</div>
</section>
<section id="redirecting-routes">
<span id="id16"></span><h3><a class="toc-backref" href="#id79" role="doc-backlink">重定向路由</a><a class="headerlink" href="#redirecting-routes" title="此标题的永久链接"></a></h3>
<p>网站改版常需页面重定向。使用 <code class="docutils literal notranslate"><span class="pre">addRedirect()</span></code> 方法指定旧路由重定向到新路由。第一个参数是旧路由 URI 模式，第二个参数是新 URI 或命名路由名称，第三个参数是 HTTP 状态码（默认 302 临时重定向）：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users/profile&#39;</span><span class="p">,</span> <span class="s1">&#39;Users::profile&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;as&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;profile&#39;</span><span class="p">]);</span>

<span class="c1">// Redirect to a named route</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">addRedirect</span><span class="p">(</span><span class="s1">&#39;users/about&#39;</span><span class="p">,</span> <span class="s1">&#39;profile&#39;</span><span class="p">);</span>
<span class="c1">// Redirect to a URI</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">addRedirect</span><span class="p">(</span><span class="s1">&#39;users/about&#39;</span><span class="p">,</span> <span class="s1">&#39;users/profile&#39;</span><span class="p">);</span>

<span class="c1">// Redirect with placeholder</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;post/(:num)/comment/(:num)&#39;</span><span class="p">,</span> <span class="s1">&#39;PostsComments::index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;as&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;post.comment&#39;</span><span class="p">]);</span>

<span class="c1">// Redirect to a URI</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">addRedirect</span><span class="p">(</span><span class="s1">&#39;article/(:num)/(:num)&#39;</span><span class="p">,</span> <span class="s1">&#39;post/$1/comment/$2&#39;</span><span class="p">);</span>
<span class="c1">// Redirect to a named route</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">addRedirect</span><span class="p">(</span><span class="s1">&#39;article/(:num)/(:num)&#39;</span><span class="p">,</span> <span class="s1">&#39;post.comment&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>自 v4.2.0 起，<code class="docutils literal notranslate"><span class="pre">addRedirect()</span></code> 支持占位符。</p>
</div>
<p>匹配重定向路由时，用户将在控制器加载前立即跳转。</p>
</section>
<section id="id17">
<h3><a class="toc-backref" href="#id80" role="doc-backlink">环境限制</a><a class="headerlink" href="#id17" title="此标题的永久链接"></a></h3>
<p>可创建仅特定环境可见的路由（如开发者本地工具）。使用 <code class="docutils literal notranslate"><span class="pre">environment()</span></code> 方法，参数为环境名称，闭包内定义的路由仅在该环境下可用：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">environment</span><span class="p">(</span><span class="s1">&#39;development&#39;</span><span class="p">,</span> <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$routes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;builder&#39;</span><span class="p">,</span> <span class="s1">&#39;Tools\Builder::index&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="id18">
<h3><a class="toc-backref" href="#id81" role="doc-backlink">任意 HTTP 方法路由</a><a class="headerlink" href="#id18" title="此标题的永久链接"></a></h3>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>此方法仅为向后兼容保留，新项目请勿使用。建议使用更合适的 HTTP 方法路由。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>使用 <a class="reference internal" href="../libraries/security.html"><span class="doc">CSRF 保护</span></a> 时，不会保护 <strong>GET</strong> 请求。若 <code class="docutils literal notranslate"><span class="pre">add()</span></code> 方法指定的 URI 可通过 GET 访问，CSRF 保护将失效。</p>
</div>
<p>使用 <code class="docutils literal notranslate"><span class="pre">add()</span></code> 方法定义支持任意 HTTP 方法的路由：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="s1">&#39;Product::feature&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>使用 HTTP 方法路由可提升性能，因为仅存储匹配当前请求方法的路由。</p>
</div>
</section>
<section id="id19">
<h3><a class="toc-backref" href="#id82" role="doc-backlink">批量映射路由</a><a class="headerlink" href="#id19" title="此标题的永久链接"></a></h3>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>此方法仅为向后兼容保留，新项目请勿使用。建议使用更合适的方法。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>由于 <code class="docutils literal notranslate"><span class="pre">map()</span></code> 内部调用 <code class="docutils literal notranslate"><span class="pre">add()</span></code>，同样不推荐使用。</p>
</div>
<p>使用 <code class="docutils literal notranslate"><span class="pre">map()</span></code> 方法批量定义路由数组：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$multipleRoutes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;product/(:num)&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;Catalog::productLookupById&#39;</span><span class="p">,</span>
    <span class="s1">&#39;product/(:alphanum)&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Catalog::productLookupByName&#39;</span><span class="p">,</span>
<span class="p">];</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="nv">$multipleRoutes</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="command-line-only-routes">
<span id="id20"></span><h3><a class="toc-backref" href="#id83" role="doc-backlink">仅命令行路由</a><a class="headerlink" href="#command-line-only-routes" title="此标题的永久链接"></a></h3>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>建议使用 Spark 命令处理 CLI 脚本，而非通过 CLI 调用控制器。详见 <a class="reference internal" href="../cli/cli_commands.html"><span class="doc">创建 Spark 命令</span></a>。</p>
</div>
<p>通过 HTTP 方法创建的路由 CLI 不可访问，但 <code class="docutils literal notranslate"><span class="pre">add()</span></code> 创建的路由仍可在命令行使用。使用 <code class="docutils literal notranslate"><span class="pre">cli()</span></code> 方法创建仅 CLI 可用的路由：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">cli</span><span class="p">(</span><span class="s1">&#39;migrate&#39;</span><span class="p">,</span> <span class="s1">&#39;App\Database::migrate&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>若启用 <a class="reference internal" href="#auto-routing-legacy"><span class="std std-ref">自动路由（传统版）</span></a> 并将命令文件置于 <strong>app/Controllers</strong>，他人可能通过自动路由（传统）HTTP 访问该命令。</p>
</div>
</section>
</section>
<section id="id21">
<h2><a class="toc-backref" href="#id84" role="doc-backlink">全局选项</a><a class="headerlink" href="#id21" title="此标题的永久链接"></a></h2>
<p>所有路由创建方法（<code class="docutils literal notranslate"><span class="pre">get()</span></code>、<code class="docutils literal notranslate"><span class="pre">post()</span></code>、<a class="reference internal" href="restful.html"><span class="doc">resource()</span></a> 等）均可接受选项数组作为最后一个参数，用于修改或限制生成的路由：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">head</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">options</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">patch</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">([</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">],</span> <span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">resource</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">,</span> <span class="k">static</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{});</span>
</pre></div>
</div>
<section id="applying-filters">
<span id="id22"></span><h3><a class="toc-backref" href="#id85" role="doc-backlink">应用过滤器</a><a class="headerlink" href="#applying-filters" title="此标题的永久链接"></a></h3>
<p>可通过为路由添加过滤器来修改特定路由行为（如身份验证或 API 日志记录）。过滤器值可以是字符串或字符串数组：</p>
<ul class="simple">
<li><p>匹配 <strong>app/Config/Filters.php</strong> 中定义的别名</p></li>
<li><p>过滤器类名</p></li>
</ul>
<p>详见 <a class="reference internal" href="filters.html#filters-aliases"><span class="std std-ref">控制器过滤器</span></a>。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>若在 <strong>app/Config/Routes.php</strong> 设置路由过滤器（非 <strong>app/Config/Filters.php</strong>），建议禁用自动路由（传统）。启用 <a class="reference internal" href="#auto-routing-legacy"><span class="std std-ref">自动路由（传统版）</span></a> 时，控制器可能通过不同 URL 访问，导致路由过滤器未生效。详见 <a class="reference internal" href="#use-defined-routes-only"><span class="std std-ref">仅使用定义路由</span></a>。</p>
</div>
<section id="id23">
<h4><a class="toc-backref" href="#id86" role="doc-backlink">别名过滤器</a><a class="headerlink" href="#id23" title="此标题的永久链接"></a></h4>
<p>你可以为过滤器值指定一个 <a class="reference internal" href="filters.html#filters-aliases"><span class="std std-ref">在 app/Config/Filters.php 中定义</span></a> 的别名。</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39; AdminController::index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin-auth&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>可为别名过滤器的 <code class="docutils literal notranslate"><span class="pre">before()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">after()</span></code> 方法传递参数：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;users/delete/(:segment)&#39;</span><span class="p">,</span> <span class="s1">&#39;AdminController::index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin-auth:dual,noreturn&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</section>
<section id="id24">
<h4><a class="toc-backref" href="#id87" role="doc-backlink">类名过滤器</a><a class="headerlink" href="#id24" title="此标题的永久链接"></a></h4>
<div class="versionadded">
<p><span class="versionmodified added">在 4.1.5 版本加入.</span></p>
</div>
<p>直接指定过滤器类名：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39; AdminController::index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Filters\SomeFilter</span><span class="o">::</span><span class="na">class</span><span class="p">]);</span>
</pre></div>
</div>
</section>
<section id="multiple-filters">
<span id="id25"></span><h4><a class="toc-backref" href="#id88" role="doc-backlink">多重过滤器</a><a class="headerlink" href="#multiple-filters" title="此标题的永久链接"></a></h4>
<div class="versionadded">
<p><span class="versionmodified added">在 4.1.5 版本加入.</span></p>
</div>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>自 v4.5.0 起始终启用 <em>多重过滤器</em> ，v4.5.0 之前默认禁用，如需使用请参考 <a class="reference internal" href="../installation/upgrade_415.html#upgrade-415-multiple-filters-for-a-route"><span class="std std-ref">从 4.1.4 升级到 4.1.5</span></a>。</p>
</div>
<p>指定过滤器数组：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39; AdminController::index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;admin-auth&#39;</span><span class="p">,</span> <span class="nx">\App\Filters\SomeFilter</span><span class="o">::</span><span class="na">class</span><span class="p">]]);</span>
</pre></div>
</div>
<section id="id26">
<h5>过滤器参数<a class="headerlink" href="#id26" title="此标题的永久链接"></a></h5>
<p>可向过滤器传递额外参数：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;users/delete/(:segment)&#39;</span><span class="p">,</span> <span class="s1">&#39;AdminController::index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin-auth:dual,noreturn&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>此例中数组 <code class="docutils literal notranslate"><span class="pre">['dual',</span> <span class="pre">'noreturn']</span></code> 将作为 <code class="docutils literal notranslate"><span class="pre">$arguments</span></code> 传递给过滤器的 <code class="docutils literal notranslate"><span class="pre">before()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">after()</span></code> 方法。</p>
</section>
</section>
</section>
<section id="assigning-namespace">
<span id="id27"></span><h3><a class="toc-backref" href="#id89" role="doc-backlink">分配命名空间</a><a class="headerlink" href="#assigning-namespace" title="此标题的永久链接"></a></h3>
<p>虽然系统会自动添加 <a class="reference internal" href="#routing-default-namespace"><span class="std std-ref">默认命名空间</span></a> 到生成的控制器，但可通过 <code class="docutils literal notranslate"><span class="pre">namespace</span></code> 选项指定不同命名空间：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Routes to \Admin\Users::index()</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;admin/users&#39;</span><span class="p">,</span> <span class="s1">&#39;Users::index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Admin&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>新命名空间仅作用于单路由创建方法（如 get、post 等）。对于创建多路由的方法（如 <code class="docutils literal notranslate"><span class="pre">group()</span></code>），新命名空间将附加到所有生成的路由。</p>
</section>
<section id="id28">
<h3><a class="toc-backref" href="#id90" role="doc-backlink">限制主机名</a><a class="headerlink" href="#id28" title="此标题的永久链接"></a></h3>
<p>通过“hostname”选项限制路由组仅在特定域名或子域生效：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;hostname&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;accounts.example.com&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>此示例仅允许 <strong>accounts.example.com</strong> 域名访问，主域 <strong>example.com</strong> 不可用。</p>
<section id="id29">
<h4><a class="toc-backref" href="#id91" role="doc-backlink">多主机名限制</a><a class="headerlink" href="#id29" title="此标题的永久链接"></a></h4>
<div class="versionadded">
<p><span class="versionmodified added">在 4.6.0 版本加入.</span></p>
</div>
<p>支持多个主机名限制：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;hostname&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;s1.example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;s2.example.com&#39;</span><span class="p">]]);</span>
</pre></div>
</div>
</section>
</section>
<section id="id30">
<h3><a class="toc-backref" href="#id92" role="doc-backlink">限制子域</a><a class="headerlink" href="#id30" title="此标题的永久链接"></a></h3>
<p>通过 <code class="docutils literal notranslate"><span class="pre">subdomain</span></code> 选项限制路由仅在特定子域可用：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Limit to media.example.com</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;subdomain&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;media&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>设置值为星号（<code class="docutils literal notranslate"><span class="pre">*</span></code>）可匹配任意子域，但无子域的 URL 不匹配：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Limit to any sub-domain</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;subdomain&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>此功能并非完美，生产环境前需充分测试。某些含点的域名可能导致误判。</p>
</div>
</section>
<section id="id31">
<h3><a class="toc-backref" href="#id93" role="doc-backlink">偏移匹配参数</a><a class="headerlink" href="#id31" title="此标题的永久链接"></a></h3>
<p>通过 <code class="docutils literal notranslate"><span class="pre">offset</span></code> 选项数值偏移匹配参数。适用于 API 版本号或语言字符串作为首段的情况：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users/(:num)&#39;</span><span class="p">,</span> <span class="s1">&#39;users/show/$1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;offset&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>

<span class="c1">// Creates:</span>
<span class="nv">$routes</span><span class="p">[</span><span class="s1">&#39;users/(:num)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;users/show/$2&#39;</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="reverse-routing">
<span id="id32"></span><h2><a class="toc-backref" href="#id94" role="doc-backlink">反向路由</a><a class="headerlink" href="#reverse-routing" title="此标题的永久链接"></a></h2>
<p>反向路由允许通过控制器、方法及参数定义链接，由路由器查找当前路由。这使得修改路由定义无需更新应用代码，常用于视图创建链接。</p>
<p>使用 <a class="reference internal" href="../helpers/url_helper.html#url_to" title="url_to"><code class="xref php php-func docutils literal notranslate"><span class="pre">url_to()</span></code></a> 辅助函数获取路由。第一个参数是完全限定的控制器和方法（用双冒号分隔），后续参数传递路由参数：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The route is defined as:</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users/(:num)/gallery/(:num)&#39;</span><span class="p">,</span> <span class="s1">&#39;Galleries::showUserGallery/$1/$2&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span>

<span class="cm">&lt;!-- Generate the URI to link to user ID 15, gallery 12: --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">url_to</span><span class="p">(</span><span class="s1">&#39;Galleries::showUserGallery&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="p">&gt;</span>View Gallery<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cm">&lt;!-- Result: &#39;http://example.com/users/15/gallery/12&#39; --&gt;</span>
</pre></div>
</div>
</section>
<section id="using-named-routes">
<span id="id33"></span><h2><a class="toc-backref" href="#id95" role="doc-backlink">命名路由</a><a class="headerlink" href="#using-named-routes" title="此标题的永久链接"></a></h2>
<p>你可以为路由命名以使你的应用更健壮。这为路由应用一个名称，之后可以被调用，即使路由定义发生变化，应用中所有使用 <a class="reference internal" href="../helpers/url_helper.html#url_to" title="url_to"><code class="xref php php-func docutils literal notranslate"><span class="pre">url_to()</span></code></a> 构建的链接仍能正常工作，而无需你做任何修改。通过传递 <code class="docutils literal notranslate"><span class="pre">as</span></code> 选项并指定路由名称来为路由命名：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The route is defined as:</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users/(:num)/gallery/(:num)&#39;</span><span class="p">,</span> <span class="s1">&#39;Galleries::showUserGallery/$1/$2&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;as&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_gallery&#39;</span><span class="p">]);</span>

<span class="cp">?&gt;</span>

<span class="cm">&lt;!-- Generate the URI to link to user ID 15, gallery 12: --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">url_to</span><span class="p">(</span><span class="s1">&#39;user_gallery&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="p">&gt;</span>View Gallery<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cm">&lt;!-- Result: &#39;http://example.com/users/15/gallery/12&#39; --&gt;</span>
</pre></div>
</div>
<p>这样做还有一个额外的好处，就是让视图更具可读性。</p>
</section>
<section id="id34">
<h2><a class="toc-backref" href="#id96" role="doc-backlink">分组路由</a><a class="headerlink" href="#id34" title="此标题的永久链接"></a></h2>
<p>你可以使用 <code class="docutils literal notranslate"><span class="pre">group()</span></code> 方法将路由分组到一个共用名称下。分组名称会成为出现在组内定义路由之前的一个路径段。这允许你减少构建大量共享相同开头字符串的路由所需的输入量，例如在构建管理区域时：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$routes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin\Users::index&#39;</span><span class="p">);</span>
    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;blog&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin\Blog::index&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>这将会为 <strong>users</strong> 和 <strong>blog</strong> URI 添加 <strong>admin</strong> 前缀，处理如 <strong>admin/users</strong> 和 <strong>admin/blog</strong> 的 URL。</p>
<section id="id35">
<h3><a class="toc-backref" href="#id97" role="doc-backlink">设置命名空间</a><a class="headerlink" href="#id35" title="此标题的永久链接"></a></h3>
<p>如果你需要为分组分配选项，例如 <a class="reference internal" href="#assigning-namespace"><span class="std std-ref">分配命名空间</span></a>，请在回调函数之前进行设置：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;App\API\v1&#39;</span><span class="p">],</span> <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$routes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">resource</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>这将处理指向 <code class="docutils literal notranslate"><span class="pre">App\API\v1\Users</span></code> 控制器的资源路由，对应的 URI 为 <strong>api/users</strong>。</p>
</section>
<section id="id36">
<h3><a class="toc-backref" href="#id98" role="doc-backlink">设置过滤器</a><a class="headerlink" href="#id36" title="此标题的永久链接"></a></h3>
<p>你也可以为一组路由使用特定的 <a class="reference internal" href="filters.html"><span class="doc">过滤器</span></a>。这将在控制器之前或之后始终运行该过滤器。这在身份验证或 API 日志记录场景中特别有用：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;api-auth&#39;</span><span class="p">],</span> <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$routes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">resource</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>过滤器的值必须与 <strong>app/Config/Filters.php</strong> 中定义的别名之一匹配。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>在 v4.5.4 之前的版本中，由于存在 bug，传递给 <code class="docutils literal notranslate"><span class="pre">group()</span></code> 的过滤器不会合并到传递给内部路由的过滤器中。</p>
</div>
</section>
<section id="id37">
<h3><a class="toc-backref" href="#id99" role="doc-backlink">设置其他选项</a><a class="headerlink" href="#id37" title="此标题的永久链接"></a></h3>
<p>有时可能需要为路由组应用过滤器或其他配置选项（如命名空间、子域等），而无需添加前缀。此时可将前缀设为空字符串：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Myth\Auth\Controllers&#39;</span><span class="p">],</span> <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$routes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;AuthController::login&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;as&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;login&#39;</span><span class="p">]);</span>
    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;AuthController::attemptLogin&#39;</span><span class="p">);</span>
    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="s1">&#39;AuthController::logout&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="routing-nesting-groups">
<span id="id38"></span><h3><a class="toc-backref" href="#id100" role="doc-backlink">嵌套分组</a><a class="headerlink" href="#routing-nesting-groups" title="此标题的永久链接"></a></h3>
<p>支持多层级分组以实现更精细的组织结构：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;myfilter1:config&#39;</span><span class="p">],</span> <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$routes</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin\Admin::index&#39;</span><span class="p">);</span>

    <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;myfilter2:region&#39;</span><span class="p">],</span> <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$routes</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin\Users::list&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>此例将处理 <strong>admin/users/list</strong> URL。外层 <code class="docutils literal notranslate"><span class="pre">group()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">filter</span></code> 选项会与内层 <code class="docutils literal notranslate"><span class="pre">group()</span></code> 的选项合并。上述代码中，<code class="docutils literal notranslate"><span class="pre">admin</span></code> 路由运行 <code class="docutils literal notranslate"><span class="pre">myfilter1:config</span></code> 过滤器，<code class="docutils literal notranslate"><span class="pre">admin/users/list</span></code> 路由运行 <code class="docutils literal notranslate"><span class="pre">myfilter1:config</span></code> 和 <code class="docutils literal notranslate"><span class="pre">myfilter2:region</span></code> 过滤器。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>v4.6.0 之前，同一过滤器无法使用不同参数多次运行。</p>
</div>
<p>内层 <code class="docutils literal notranslate"><span class="pre">group()</span></code> 的选项会覆盖外层同名选项。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>v4.5.0 之前存在 bug，外层 <code class="docutils literal notranslate"><span class="pre">group()</span></code> 的选项不会与内层合并。</p>
</div>
</section>
</section>
<section id="routing-priority">
<span id="id39"></span><h2><a class="toc-backref" href="#id101" role="doc-backlink">路由优先级</a><a class="headerlink" href="#routing-priority" title="此标题的永久链接"></a></h2>
<p>路由按定义顺序注册到路由表中。当访问 URI 时，将执行首个匹配的路由。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>若同一路由路径被多次定义且处理器不同，仅首个定义的路由生效。</p>
</div>
<p>可通过运行 <a class="reference internal" href="#routing-spark-routes"><span class="std std-ref">spark routes</span></a> 命令查看路由表。</p>
<section id="id40">
<h3><a class="toc-backref" href="#id102" role="doc-backlink">调整路由优先级</a><a class="headerlink" href="#id40" title="此标题的永久链接"></a></h3>
<p>处理模块路由时，若应用路由包含通配符可能导致模块路由无法正确处理。通过 <code class="docutils literal notranslate"><span class="pre">priority</span></code> 选项可降低路由处理优先级（数值越大优先级越低）：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// First you need to enable processing of the routes queue by priority.</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">setPrioritize</span><span class="p">();</span>

<span class="c1">// Config\Routes</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;(.*)&#39;</span><span class="p">,</span> <span class="s1">&#39;Posts::index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;priority&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>

<span class="c1">// Modules\Acme\Config\Routes</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin::index&#39;</span><span class="p">);</span>

<span class="c1">// The &quot;admin&quot; route will now be processed before the wildcard route.</span>
</pre></div>
</div>
<p>要禁用此功能，传入 <code class="docutils literal notranslate"><span class="pre">false</span></code> 参数：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">setPrioritize</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>默认所有路由优先级为 0，负值将转为绝对值。</p>
</div>
</section>
</section>
<section id="routes-configuration-options">
<span id="id41"></span><h2><a class="toc-backref" href="#id103" role="doc-backlink">路由配置选项</a><a class="headerlink" href="#routes-configuration-options" title="此标题的永久链接"></a></h2>
<p>RouteCollection 类提供多个全局配置选项（位于 <strong>app/Config/Routing.php</strong>），可根据需求调整。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><strong>app/Config/Routing.php</strong> 配置文件自 v4.4.0 起新增，旧版本需在 <strong>app/Config/Routes.php</strong> 使用 setter 方法修改设置。</p>
</div>
<section id="routing-default-namespace">
<span id="id42"></span><h3><a class="toc-backref" href="#id104" role="doc-backlink">默认命名空间</a><a class="headerlink" href="#routing-default-namespace" title="此标题的永久链接"></a></h3>
<p>匹配控制器时，系统会将默认命名空间值添加到控制器名称前（默认 <code class="docutils literal notranslate"><span class="pre">App\Controllers</span></code>）。设为空字符串（<code class="docutils literal notranslate"><span class="pre">''</span></code>）则需每个路由指定完全限定命名空间：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// In app/Config/Routing.php</span>
<span class="k">use</span> <span class="nx">CodeIgniter\Config\Routing</span> <span class="k">as</span> <span class="nx">BaseRouting</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">class</span> <span class="nc">Routing</span> <span class="k">extends</span> <span class="nx">BaseRouting</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$defaultNamespace</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// In app/Config/Routes.php</span>
<span class="c1">// Controller is \Users</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;Users::index&#39;</span><span class="p">);</span>

<span class="c1">// Controller is \Admin\Users</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin\Users::index&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>若控制器已命名空间化，可修改此值减少输入：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This can be overridden in app/Config/Routes.php</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">setDefaultNamespace</span><span class="p">(</span><span class="s1">&#39;App&#39;</span><span class="p">);</span>

<span class="c1">// Controller is \App\Users</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;Users::index&#39;</span><span class="p">);</span>

<span class="c1">// Controller is \App\Admin\Users</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin\Users::index&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="routing-default-method">
<span id="id43"></span><h3><a class="toc-backref" href="#id105" role="doc-backlink">默认方法</a><a class="headerlink" href="#routing-default-method" title="此标题的永久链接"></a></h3>
<p>当路由处理器仅指定控制器名时，使用此设置的方法（默认 <code class="docutils literal notranslate"><span class="pre">index</span></code>）：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="c1">// In app/Config/Routing.php</span>
<span class="k">public</span> <span class="nx">string</span> <span class="nv">$defaultMethod</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><code class="docutils literal notranslate"><span class="pre">$defaultMethod</span></code> 也常用于自动路由。
请参见 <a class="reference internal" href="auto_routing_improved.html#routing-auto-routing-improved-default-method"><span class="std std-ref">自动路由（改进版）</span></a>
或 <a class="reference internal" href="#routing-auto-routing-legacy-default-method"><span class="std std-ref">自动路由（传统版）</span></a>。</p>
</div>
<p>如果你定义了以下路由:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;Home&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>当路由匹配时，将执行 <code class="docutils literal notranslate"><span class="pre">App\Controllers\Home</span></code> 控制器的 <code class="docutils literal notranslate"><span class="pre">index()</span></code> 方法。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>方法名称以 <code class="docutils literal notranslate"><span class="pre">_</span></code> 开头时不能用作默认方法。
但是，从 v4.5.0 开始，允许使用 <code class="docutils literal notranslate"><span class="pre">__invoke</span></code> 方法。</p>
</div>
</section>
<section id="id44">
<h3><a class="toc-backref" href="#id106" role="doc-backlink">转换 URI 短横线</a><a class="headerlink" href="#id44" title="此标题的永久链接"></a></h3>
<p>此选项在自动路由中将短横线（<code class="docutils literal notranslate"><span class="pre">-</span></code>）自动转为下划线（因短横线非有效类/方法名字符）：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// In app/Config/Routing.php</span>
<span class="k">use</span> <span class="nx">CodeIgniter\Config\Routing</span> <span class="k">as</span> <span class="nx">BaseRouting</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">class</span> <span class="nc">Routing</span> <span class="k">extends</span> <span class="nx">BaseRouting</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">public</span> <span class="nx">bool</span> <span class="nv">$translateURIDashes</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// This can be overridden in app/Config/Routes.php</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">setTranslateURIDashes</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>在使用自动路由（改进版）时，在 v4.4.0 之前，如果 <code class="docutils literal notranslate"><span class="pre">$translateURIDashes</span></code> 为 true，两个 URI 对应一个控制器方法，一个 URI 用于破折号（例如 <strong>foo-bar</strong>），另一个 URI 用于下划线（例如 <strong>foo_bar</strong>）。这是错误的行为。从 v4.4.0 开始，下划线的 URI（<strong>foo_bar</strong>）不可访问。</p>
</div>
</section>
<section id="use-defined-routes-only">
<span id="id45"></span><h3><a class="toc-backref" href="#id107" role="doc-backlink">仅使用定义路由</a><a class="headerlink" href="#use-defined-routes-only" title="此标题的永久链接"></a></h3>
<p>v4.2.0 起默认禁用自动路由。</p>
<p>当未找到与当前 URI 匹配的定义路由时，系统尝试通过自动路由匹配控制器方法。将 <code class="docutils literal notranslate"><span class="pre">$autoRoute</span></code> 设为 <code class="docutils literal notranslate"><span class="pre">false</span></code> 可完全禁用自动路由：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// In app/Config/Routing.php</span>
<span class="k">use</span> <span class="nx">CodeIgniter\Config\Routing</span> <span class="k">as</span> <span class="nx">BaseRouting</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">class</span> <span class="nc">Routing</span> <span class="k">extends</span> <span class="nx">BaseRouting</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">public</span> <span class="nx">bool</span> <span class="nv">$autoRoute</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// This can be overridden in app/Config/Routes.php</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">setAutoRoute</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>启用 <a class="reference internal" href="../libraries/security.html"><span class="doc">CSRF 保护</span></a> 时，<strong>GET</strong> 请求不受保护。若 URI 可通过 GET 访问，CSRF 保护将失效。</p>
</div>
</section>
<section id="override">
<span id="id46"></span><h3><a class="toc-backref" href="#id108" role="doc-backlink">404 重写</a><a class="headerlink" href="#override" title="此标题的永久链接"></a></h3>
<p>当找不到与当前 URI 匹配的页面时，系统将显示一个通用的 404 页面。通过在路由配置文件中使用 <code class="docutils literal notranslate"><span class="pre">$override404</span></code> 属性，你可以为 404 路由定义控制器类/方法。</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// In app/Config/Routing.php</span>
<span class="k">use</span> <span class="nx">CodeIgniter\Config\Routing</span> <span class="k">as</span> <span class="nx">BaseRouting</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">class</span> <span class="nc">Routing</span> <span class="k">extends</span> <span class="nx">BaseRouting</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">public</span> <span class="o">?</span><span class="nx">string</span> <span class="nv">$override404</span> <span class="o">=</span> <span class="s1">&#39;App\Errors::show404&#39;</span><span class="p">;</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>你还可以在路由配置文件中使用 <code class="docutils literal notranslate"><span class="pre">set404Override()</span></code> 方法指定在发生 404 错误时执行的操作。该值可以是一个有效的类/方法对，或者是一个闭包：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// In app/Config/Routes.php</span>
<span class="c1">// Would execute the show404 method of the App\Errors class</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">set404Override</span><span class="p">(</span><span class="s1">&#39;App\Errors::show404&#39;</span><span class="p">);</span>

<span class="c1">// Will display a custom view.</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">set404Override</span><span class="p">(</span><span class="k">static</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// If you want to get the URI segments.</span>
    <span class="nv">$segments</span> <span class="o">=</span> <span class="nx">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getUri</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getSegments</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;my_errors/not_found.html&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>从 v4.5.0 开始，404 覆盖功能默认将响应状态代码设置为 <code class="docutils literal notranslate"><span class="pre">404</span></code>。在之前的版本中，状态代码是 <code class="docutils literal notranslate"><span class="pre">200</span></code>。
如果你想在控制器中更改状态代码，请参见 <a class="reference internal" href="../outgoing/response.html#CodeIgniter\HTTP\Response::setStatusCode" title="CodeIgniter\HTTP\Response::setStatusCode"><code class="xref php php-meth docutils literal notranslate"><span class="pre">CodeIgniter\HTTP\Response::setStatusCode()</span></code></a> 获取有关如何设置状态代码的信息。</p>
</div>
</section>
<section id="id47">
<h3><a class="toc-backref" href="#id109" role="doc-backlink">按优先级处理路由</a><a class="headerlink" href="#id47" title="此标题的永久链接"></a></h3>
<p>启用或禁用按优先级处理路由队列。在路由选项中降低优先级。默认禁用。
此功能影响所有路由。有关降低优先级的示例用法，请参阅 <a class="reference internal" href="#routing-priority"><span class="std std-ref">路由优先级</span></a>：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// In app/Config/Routing.php</span>
<span class="k">use</span> <span class="nx">CodeIgniter\Config\Routing</span> <span class="k">as</span> <span class="nx">BaseRouting</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">class</span> <span class="nc">Routing</span> <span class="k">extends</span> <span class="nx">BaseRouting</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">public</span> <span class="nx">bool</span> <span class="nv">$prioritize</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// In app/Config/Routes.php</span>
<span class="c1">// to enable</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">setPrioritize</span><span class="p">();</span>

<span class="c1">// to disable</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">setPrioritize</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="multiple-uri-segments-as-one-parameter">
<span id="id48"></span><h3><a class="toc-backref" href="#id110" role="doc-backlink">多 URI 段作为单一参数</a><a class="headerlink" href="#multiple-uri-segments-as-one-parameter" title="此标题的永久链接"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">在 4.5.0 版本加入.</span></p>
</div>
<p>启用此选项后，匹配多段的占位符（如 <code class="docutils literal notranslate"><span class="pre">(:any)</span></code>）将作为单一参数传递（即使包含斜杠）：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// In app/Config/Routing.php</span>
<span class="k">use</span> <span class="nx">CodeIgniter\Config\Routing</span> <span class="k">as</span> <span class="nx">BaseRouting</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Routing</span> <span class="k">extends</span> <span class="nx">BaseRouting</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">public</span> <span class="nx">bool</span> <span class="nv">$multipleSegmentsOneParam</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>例如路由：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;product/(:any)&#39;</span><span class="p">,</span> <span class="s1">&#39;Catalog::productLookup/$1&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>将匹配 <strong>product/123</strong>、<strong>product/123/456</strong>、<strong>product/123/456/789</strong> 等等。
如果 URI 是 <strong>product/123/456</strong>，<code class="docutils literal notranslate"><span class="pre">123/456</span></code> 将被传递给 <code class="docutils literal notranslate"><span class="pre">Catalog::productLookup()</span></code> 方法的第一个参数。</p>
</section>
</section>
<section id="id49">
<h2><a class="toc-backref" href="#id111" role="doc-backlink">自动路由（改进版）</a><a class="headerlink" href="#id49" title="此标题的永久链接"></a></h2>
<div class="versionadded">
<p><span class="versionmodified added">在 4.2.0 版本加入.</span></p>
</div>
<p>这是更安全的新自动路由系统，详见 <a class="reference internal" href="auto_routing_improved.html"><span class="doc">自动路由（改进版）</span></a>。</p>
</section>
<section id="auto-routing-legacy">
<span id="id50"></span><h2><a class="toc-backref" href="#id112" role="doc-backlink">自动路由（传统版）</a><a class="headerlink" href="#auto-routing-legacy" title="此标题的永久链接"></a></h2>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>这个功能只为了向后兼容而存在。在新项目中不要使用它。即使你已经在使用它，我们也推荐你使用 <a class="reference internal" href="auto_routing_improved.html#auto-routing-improved"><span class="std std-ref">自动路由（改进版）</span></a> 替代。</p>
</div>
<p>自动路由(传统)是来自 CodeIgniter 3 的路由系统。它可以根据约定自动路由 HTTP 请求,并执行相应的控制器方法。</p>
<p>推荐在 <strong>app/Config/Routes.php</strong> 文件中定义所有路由,或者使用 <a class="reference internal" href="auto_routing_improved.html#auto-routing-improved"><span class="std std-ref">自动路由（改进版）</span></a>。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>为了防止配置错误和编码错误,我们建议你不要使用自动路由(传统)功能。很容易创建容易受攻击的应用程序,其中控制器过滤器或 CSRF 保护被绕过。</p>
</div>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>自动路由(传统)会将任何 HTTP 方法的 HTTP 请求路由到控制器方法。</p>
</div>
<section id="id51">
<h3><a class="toc-backref" href="#id113" role="doc-backlink">启用传统自动路由</a><a class="headerlink" href="#id51" title="此标题的永久链接"></a></h3>
<p>自 v4.2.0 起，默认禁用自动路由。</p>
<p>要使用它,你需要在 <strong>app/Config/Routing.php</strong> 中将 <code class="docutils literal notranslate"><span class="pre">$autoRoute</span></code> 选项设置为 <code class="docutils literal notranslate"><span class="pre">true</span></code>:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nx">bool</span> <span class="nv">$autoRoute</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</pre></div>
</div>
<p>并且在 <strong>app/Config/Feature.php</strong> 中，将属性 <code class="docutils literal notranslate"><span class="pre">$autoRoutesImproved</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">false</span></code>:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nx">bool</span> <span class="nv">$autoRoutesImproved</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="id52">
<h3><a class="toc-backref" href="#id114" role="doc-backlink">URI 分段（传统版）</a><a class="headerlink" href="#id52" title="此标题的永久链接"></a></h3>
<p>遵循模型-视图-控制器（MVC）模式，URL 中的各段通常表示:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nx">example</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">class</span><span class="o">/</span><span class="nx">method</span><span class="o">/</span><span class="nx">ID</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>第一段表示应被调用的控制器 <strong>class</strong></p></li>
<li><p>第二段表示应被调用的类 <strong>method</strong></p></li>
<li><p>第三段及后续各段表示将传递给控制器的 ID 和其他变量</p></li>
</ol>
<p>考虑以下 URI:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="nx">example</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">index</span><span class="o">.</span><span class="nx">php</span><span class="o">/</span><span class="nx">helloworld</span><span class="o">/</span><span class="nx">index</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
<p>在上述示例中，CodeIgniter 将尝试查找名为 <strong>Helloworld.php</strong> 的控制器，并执行 <code class="docutils literal notranslate"><span class="pre">index()</span></code> 方法，同时传递 <code class="docutils literal notranslate"><span class="pre">'1'</span></code> 作为第一个参数。</p>
<p>更多信息请参阅 <a class="reference internal" href="controllers.html#controller-auto-routing-legacy"><span class="std std-ref">控制器中的自动路由(传统模式)</span></a>。</p>
</section>
<section id="routing-auto-routing-legacy-configuration-options">
<span id="id53"></span><h3><a class="toc-backref" href="#id115" role="doc-backlink">配置选项（传统版）</a><a class="headerlink" href="#routing-auto-routing-legacy-configuration-options" title="此标题的永久链接"></a></h3>
<p>这些选项在 <strong>app/Config/Routing.php</strong> 文件中可用。</p>
<section id="id54">
<h4><a class="toc-backref" href="#id116" role="doc-backlink">默认控制器(传统版)</a><a class="headerlink" href="#id54" title="此标题的永久链接"></a></h4>
<section id="id55">
<h5>针对网站根 URI(传统版)<a class="headerlink" href="#id55" title="此标题的永久链接"></a></h5>
<p>当用户访问你网站的根（例如，<strong>example.com</strong>）时，除非存在明确的路由，否则将根据 <code class="docutils literal notranslate"><span class="pre">$defaultController</span></code> 属性设定的值来确定要使用的控制器。</p>
<p>对于这个属性，默认值是 <code class="docutils literal notranslate"><span class="pre">Home</span></code>，它匹配在 <strong>app/Controllers/Home.php</strong> 的控制器:</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="nx">string</span> <span class="nv">$defaultController</span> <span class="o">=</span> <span class="s1">&#39;Home&#39;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="id56">
<h5>针对目录 URI(传统版)<a class="headerlink" href="#id56" title="此标题的永久链接"></a></h5>
<p>默认控制器也在未找到匹配的路由且 URI 指向控制器目录中的目录时使用。例如,如果用户访问 <strong>example.com/admin</strong>,如果在 <strong>app/Controllers/Admin/Home.php</strong> 中找到了一个控制器,则会使用它。</p>
<p>更多信息请参阅 <a class="reference internal" href="controllers.html#controller-auto-routing-legacy"><span class="std std-ref">控制器中的自动路由(传统)</span></a>。</p>
</section>
</section>
<section id="routing-auto-routing-legacy-default-method">
<span id="id57"></span><h4><a class="toc-backref" href="#id117" role="doc-backlink">默认方法（传统版）</a><a class="headerlink" href="#routing-auto-routing-legacy-default-method" title="此标题的永久链接"></a></h4>
<p>这与默认控制器设置类似,但用于在找到与 URI 匹配的控制器但不存在方法段时确定使用的默认方法。默认值为 <code class="docutils literal notranslate"><span class="pre">index</span></code>。</p>
<p>在此示例中,如果用户访问 <strong>example.com/products</strong>,且存在 <code class="docutils literal notranslate"><span class="pre">Products</span></code> 控制器,将执行 <code class="docutils literal notranslate"><span class="pre">Products::listAll()</span></code> 方法:</p>
<blockquote>
<div><p>public string $defaultMethod = ‘listAll’;</p>
</div></blockquote>
</section>
</section>
</section>
<section id="id58">
<h2><a class="toc-backref" href="#id118" role="doc-backlink">验证路由</a><a class="headerlink" href="#id58" title="此标题的永久链接"></a></h2>
<p>通过 <a class="reference internal" href="../cli/spark_commands.html"><span class="doc">spark 命令</span></a> 查看所有路由：</p>
<section id="spark">
<span id="routing-spark-routes"></span><h3><a class="toc-backref" href="#id119" role="doc-backlink">spark 路由</a><a class="headerlink" href="#spark" title="此标题的永久链接"></a></h3>
<p>显示所有路由及过滤器：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">php spark routes</span>
</pre></div>
</div>
<p>输出示例：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+---------+---------+---------------+-------------------------------+----------------+---------------+
| Method  | Route   | Name          | Handler                       | Before Filters | After Filters |
+---------+---------+---------------+-------------------------------+----------------+---------------+
| GET     | /       | »             | \App\Controllers\Home::index  |                | toolbar       |
| GET     | feed    | »             | (Closure)                     |                | toolbar       |
+---------+---------+---------------+-------------------------------+----------------+---------------+
</pre></div>
</div>
<p><em>Method</em> 列显示路由监听的 HTTP 方法。</p>
<p><em>Route</em> 列显示要匹配的路由路径。定义路由的路由以正则表达式表示。</p>
<p>自 v4.3.0 起, <em>Name</em> 列显示路由名称。<code class="docutils literal notranslate"><span class="pre">»</span></code> 表示名称与路由路径相同。</p>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>系统并非完美。对于包含如 <code class="docutils literal notranslate"><span class="pre">([^/]+)</span></code> 或 <code class="docutils literal notranslate"><span class="pre">{locale}</span></code> 的正则表达式模式的路由，显示的 <em>Filters</em> 可能不正确（如果你在 <strong>app/Config/Filters.php</strong> 中为过滤器设置了复杂的 URI 模式），或者它显示为 <code class="docutils literal notranslate"><span class="pre">&lt;unknown&gt;</span></code>。</p>
<p><a class="reference internal" href="filters.html#spark-filter-check"><span class="std std-ref">spark filter:check</span></a> 命令可以用来检查 100% 准确的过滤器。</p>
</div>
<section id="id59">
<h4><a class="toc-backref" href="#id120" role="doc-backlink">自动路由(改进版)</a><a class="headerlink" href="#id59" title="此标题的永久链接"></a></h4>
<p>当你使用自动路由(改进版)时,输出类似以下内容:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+-----------+-------------------------+---------------+-----------------------------------+----------------+---------------+
| Method    | Route                   | Name          | Handler                           | Before Filters | After Filters |
+-----------+-------------------------+---------------+-----------------------------------+----------------+---------------+
| GET(auto) | product/list/../..[/..] |               | \App\Controllers\Product::getList |                | toolbar       |
+-----------+-------------------------+---------------+-----------------------------------+----------------+---------------+
</pre></div>
</div>
<p><em>Method</em> 将显示为 <code class="docutils literal notranslate"><span class="pre">GET(auto)</span></code>。</p>
<p><em>Route</em> 列中的 <code class="docutils literal notranslate"><span class="pre">/..</span></code> 表示一个段。<code class="docutils literal notranslate"><span class="pre">[/..]</span></code> 表示可选。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>当启用自动路由并且你有 <code class="docutils literal notranslate"><span class="pre">home</span></code> 路由时,它也可以通过 <code class="docutils literal notranslate"><span class="pre">Home</span></code> 访问,或者通过 <code class="docutils literal notranslate"><span class="pre">hOme</span></code>、<code class="docutils literal notranslate"><span class="pre">hoMe</span></code>、<code class="docutils literal notranslate"><span class="pre">HOME</span></code> 等访问,但是该命令只会显示 <code class="docutils literal notranslate"><span class="pre">home</span></code>。</p>
</div>
<p>如果你看到以 <code class="docutils literal notranslate"><span class="pre">x</span></code> 开头的路由,如下所示,这表示一个无效路由,不会路由,但是控制器有公共方法进行路由。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+-----------+----------------+------+-------------------------------------+----------------+---------------+
| Method    | Route          | Name | Handler                             | Before Filters | After Filters |
+-----------+----------------+------+-------------------------------------+----------------+---------------+
| GET(auto) | x home/foo     |      | \App\Controllers\Home::getFoo       | &lt;unknown&gt;      | &lt;unknown&gt;     |
+-----------+----------------+------+-------------------------------------+----------------+---------------+
</pre></div>
</div>
<p>上面的示例显示你有 <code class="docutils literal notranslate"><span class="pre">\App\Controllers\Home::getFoo()</span></code> 方法,但是它没有路由,因为它是默认控制器(默认为 <code class="docutils literal notranslate"><span class="pre">Home</span></code>),默认控制器名称必须在 URI 中省略。你应该删除 <code class="docutils literal notranslate"><span class="pre">getFoo()</span></code> 方法。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>在 v4.3.4 之前,由于一个错误,无效路由会显示为正常路由。</p>
</div>
</section>
<section id="id60">
<h4><a class="toc-backref" href="#id121" role="doc-backlink">自动路由(传统)</a><a class="headerlink" href="#id60" title="此标题的永久链接"></a></h4>
<p>当你使用自动路由(传统)时,输出类似以下内容:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+--------+--------------------+---------------+-----------------------------------+----------------+---------------+
| Method | Route              | Name          | Handler                           | Before Filters | After Filters |
+--------+--------------------+---------------+-----------------------------------+----------------+---------------+
| auto   | product/list[/...] |               | \App\Controllers\Product::getList |                | toolbar       |
+--------+--------------------+---------------+-----------------------------------+----------------+---------------+
</pre></div>
</div>
<p><em>Method</em> 将显示为 <code class="docutils literal notranslate"><span class="pre">auto</span></code>。</p>
<p><em>Route</em> 列中的 <code class="docutils literal notranslate"><span class="pre">[/...]</span></code> 表示任意数量的段。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>当启用自动路由并且你有 <code class="docutils literal notranslate"><span class="pre">home</span></code> 路由时,它也可以通过 <code class="docutils literal notranslate"><span class="pre">Home</span></code> 访问,或者通过 <code class="docutils literal notranslate"><span class="pre">hOme</span></code>、<code class="docutils literal notranslate"><span class="pre">hoMe</span></code>、<code class="docutils literal notranslate"><span class="pre">HOME</span></code> 等访问,但是该命令只会显示 <code class="docutils literal notranslate"><span class="pre">home</span></code>。</p>
</div>
</section>
<section id="routing-spark-routes-sort-by-handler">
<span id="id61"></span><h4><a class="toc-backref" href="#id122" role="doc-backlink">按处理程序排序</a><a class="headerlink" href="#routing-spark-routes-sort-by-handler" title="此标题的永久链接"></a></h4>
<div class="versionadded">
<p><span class="versionmodified added">在 4.3.0 版本加入.</span></p>
</div>
<p>你可以按 <em>Handler</em> 对路由进行排序:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">php spark routes -h</span>
</pre></div>
</div>
</section>
<section id="routing-spark-routes-specify-host">
<span id="id62"></span><h4><a class="toc-backref" href="#id123" role="doc-backlink">指定主机</a><a class="headerlink" href="#routing-spark-routes-specify-host" title="此标题的永久链接"></a></h4>
<div class="versionadded">
<p><span class="versionmodified added">在 4.4.0 版本加入.</span></p>
</div>
<p>通过 <code class="docutils literal notranslate"><span class="pre">--host</span></code> 指定请求主机：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">php spark routes --host accounts.example.com</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="id63">
<h2><a class="toc-backref" href="#id124" role="doc-backlink">获取路由信息</a><a class="headerlink" href="#id63" title="此标题的永久链接"></a></h2>
<p>在 CodeIgniter 4 中，理解和管理路由信息对于有效处理 HTTP 请求至关重要。这涉及到检索有关活动控制器和方法的详细信息，以及应用于特定路由的过滤器。下面，我们探讨如何访问这些路由信息，以帮助完成诸如日志记录、调试或实现条件逻辑等任务。</p>
<section id="id64">
<h3><a class="toc-backref" href="#id125" role="doc-backlink">检索当前控制器/方法名称</a><a class="headerlink" href="#id64" title="此标题的永久链接"></a></h3>
<p>在某些情况下，你可能需要确定当前 HTTP 请求触发了哪个控制器和方法。这对于日志记录、调试或基于活动控制器方法的条件逻辑非常有用。</p>
<p>CodeIgniter 4 提供了一种简单的方法来使用 <code class="docutils literal notranslate"><span class="pre">Router</span></code> 类访问当前路由的控制器和方法名称。以下是一个示例：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Get the router instance.</span>
<span class="sd">/** @var \CodeIgniter\Router\Router $router */</span>
<span class="nv">$router</span> <span class="o">=</span> <span class="nx">service</span><span class="p">(</span><span class="s1">&#39;router&#39;</span><span class="p">);</span>

<span class="c1">// Retrieve the fully qualified class name of the controller handling the current request.</span>
<span class="nv">$controller</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">controllerName</span><span class="p">();</span>

<span class="c1">// Retrieve the method name being executed in the controller for the current request.</span>
<span class="nv">$method</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">methodName</span><span class="p">();</span>

<span class="k">echo</span> <span class="s1">&#39;Current Controller: &#39;</span> <span class="o">.</span> <span class="nv">$controller</span> <span class="o">.</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;Current Method: &#39;</span> <span class="o">.</span> <span class="nv">$method</span><span class="p">;</span>
</pre></div>
</div>
<p>当你需要动态地与控制器交互或记录处理特定请求的方法时，这个功能特别有用。</p>
</section>
<section id="id65">
<h3><a class="toc-backref" href="#id126" role="doc-backlink">获取当前路由的活动过滤器</a><a class="headerlink" href="#id65" title="此标题的永久链接"></a></h3>
<p><a class="reference internal" href="filters.html"><span class="doc">过滤器</span></a> 是一个强大的功能，使你能够在处理 HTTP 请求之前或之后执行诸如身份验证、日志记录和安全检查等操作。要访问特定路由的活动过滤器，你可以使用 <code class="docutils literal notranslate"><span class="pre">Router</span></code> 类中的 <code class="xref php php-meth docutils literal notranslate"><span class="pre">CodeIgniter\Router\Router::getFilters()</span></code> 方法。</p>
<p>此方法返回当前正在处理的路由的活动过滤器列表：</p>
<div class="highlight-html+php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Get the router instance.</span>
<span class="sd">/** @var \CodeIgniter\Router\Router $router */</span>
<span class="nv">$router</span>  <span class="o">=</span> <span class="nx">service</span><span class="p">(</span><span class="s1">&#39;router&#39;</span><span class="p">);</span>
<span class="nv">$filters</span> <span class="o">=</span> <span class="nv">$router</span><span class="o">-&gt;</span><span class="na">getFilters</span><span class="p">();</span>

<span class="k">echo</span> <span class="s1">&#39;Active Filters for the Route: &#39;</span> <span class="o">.</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nv">$filters</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><code class="docutils literal notranslate"><span class="pre">getFilters()</span></code> 方法仅返回为特定路由定义的过滤器。
它不包括全局过滤器或在 <strong>app/Config/Filters.php</strong> 文件中指定的过滤器。</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="index.html" class="btn btn-neutral float-left" title="控制器和路由" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="controllers.html" class="btn btn-neutral float-right" title="控制器" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2019-2025 CodeIgniter 基金会.
      <span class="lastupdated">最后更新于 2025-02-19.
      </span></p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
  
<jinja2.runtime.BlockReference object at 0x7f29861da790>

<div style="margin-top: 16px;">
  <p>由 <a href="https://codeigniter.org.cn">CodeIgniter 中国开发者社区</a>翻译并制作</p>
  <p style="margin-bottom: 0;">
    <a href="https://github.com/CodeIgniter-Chinese/codeigniter4-user-guide" target="_blank">Github 简体中文翻译</a>
    ·
    <a href="https://codeigniter-chinese.github.io/codeigniter4-user-guide/codeigniter_user_guide.zip">离线版压缩包下载</a>
    ·
    <a href="https://codeigniter-chinese.github.io/codeigniter4-user-guide/CodeIgniter.pdf">PDF 版下载</a>
  </p>
</div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>